<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Principle Components | SGS</title>
  <meta name="description" content="Principle Components | SGS" />
  <meta name="generator" content="bookdown 0.21.5 and GitBook 2.6.7" />

  <meta property="og:title" content="Principle Components | SGS" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Principle Components | SGS" />
  
  
  

<meta name="author" content="Tristan Goodbody" />


<meta name="date" content="2021-03-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataprep.html"/>
<link rel="next" href="strat.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="SGS.html"><a href="SGS.html"><i class="fa fa-check"></i>Structurally Guided Sampling Review</a><ul>
<li class="chapter" data-level="" data-path="SGS.html"><a href="SGS.html#stratapp"><i class="fa fa-check"></i>Stratification approaches</a><ul>
<li><a href="SGS.html#hawbaker2009"><span class="citation">(Hawbaker et al. <span>2009</span>)</span></a></li>
<li><a href="SGS.html#dalponte2011"><span class="citation">(Dalponte et al. <span>2011</span>)</span></a></li>
<li><a href="SGS.html#maltamo2011"><span class="citation">(Maltamo et al. <span>2011</span>)</span></a></li>
<li><a href="SGS.html#junttila2013"><span class="citation">(Junttila et al. <span>2013</span>)</span></a></li>
<li><a href="SGS.html#valbuena2013"><span class="citation">(Valbuena et al. <span>2013</span>)</span></a></li>
<li><a href="SGS.html#grafstrom2013"><span class="citation">(Grafström and Ringvall <span>2013</span>)</span></a></li>
<li><a href="SGS.html#grafstrom2014"><span class="citation">(Grafström, Saarela, and Ene <span>2014</span>)</span></a></li>
<li><a href="SGS.html#niemi2016"><span class="citation">(Niemi and Vauhkonen <span>2016</span>)</span></a></li>
<li><a href="SGS.html#valbuena2017"><span class="citation">(Valbuena et al. <span>2017</span>)</span></a></li>
<li><a href="SGS.html#mcroberts2017"><span class="citation">(McRoberts, Chen, and Walters <span>2017</span>)</span></a></li>
<li><a href="SGS.html#malone2019"><span class="citation">(Malone, Minansy, and Brungard <span>2019</span>)</span></a></li>
<li><a href="SGS.html#papa2020"><span class="citation">(Papa et al. <span>2020</span>)</span></a></li>
<li><a href="SGS.html#ma2020"><span class="citation">(Ma et al. <span>2020</span>)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html"><i class="fa fa-check"></i>Data Preparation</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html"><i class="fa fa-check"></i>Principle Components</a><ul>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#use-pca-model-to-get-pca-values-of-an-existing-set-of-plots"><i class="fa fa-check"></i>Use PCA model to get PCA values of an existing set of plots</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#stratification"><i class="fa fa-check"></i>Stratification</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#select-new-plots"><i class="fa fa-check"></i>Select new plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html"><i class="fa fa-check"></i>Stratification methods</a><ul>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#kmeans"><i class="fa fa-check"></i>K-means</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#clusterchallenge"><i class="fa fa-check"></i>How many clusters??</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#OSB"><i class="fa fa-check"></i>Optimum stratum boundaries</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#srs"><i class="fa fa-check"></i>Simple Random Sampling</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#using-2-variables-to-stratify"><i class="fa fa-check"></i>Using 2 variables to stratify</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#balanced-sampling"><i class="fa fa-check"></i>Balanced Sampling</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#lhs"><i class="fa fa-check"></i>Latin Hypercube Sampling</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html"><i class="fa fa-check"></i>Discussion points</a><ul>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#methods"><i class="fa fa-check"></i>Methods</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#need-to-integrate-already-established-samples"><i class="fa fa-check"></i>Need to integrate already established samples</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#algorithm-creation"><i class="fa fa-check"></i>Algorithm creation</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#agenda-for-future"><i class="fa fa-check"></i>Agenda for future</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SGS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="princomp" class="section level1 unnumbered">
<h1>Principle Components</h1>
<p>The first method we outline is using principle components analysis and sample selection from the <span class="citation">(it <a href="#ref-R-RMFinventory" role="doc-biblioref">2021</a>)</span> package. This vignette is mostly replicated from the one within that package by Martin Queinnec.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="princomp.html#cb15-1"></a>PCA &lt;-<span class="st"> </span>RStoolbox<span class="op">::</span><span class="kw">rasterPCA</span>(wall_poly_roads, <span class="dt">nComp =</span> <span class="dv">2</span>, <span class="dt">spca =</span> <span class="ot">TRUE</span>, <span class="dt">maskCheck =</span> <span class="ot">FALSE</span>)</span>
<span id="cb15-2"><a href="princomp.html#cb15-2"></a><span class="co"># nComp = 2, we return the two first principal components</span></span>
<span id="cb15-3"><a href="princomp.html#cb15-3"></a><span class="co"># spca = TRUE, since metrics have different ranges of values the fucntion will center and scale the metrics</span></span>
<span id="cb15-4"><a href="princomp.html#cb15-4"></a><span class="co"># maskCheck = FALSE, we don&#39;t check if some pixels have NA value in one or more layers. If not sure, set to TRUE</span></span>
<span id="cb15-5"><a href="princomp.html#cb15-5"></a></span>
<span id="cb15-6"><a href="princomp.html#cb15-6"></a><span class="co"># The output of rasterPCA is a list with an element model which contains the PCA model and an element map which contains the map of PCA values</span></span>
<span id="cb15-7"><a href="princomp.html#cb15-7"></a></span>
<span id="cb15-8"><a href="princomp.html#cb15-8"></a>PCA_wall &lt;-<span class="st"> </span>PCA<span class="op">$</span>map</span>
<span id="cb15-9"><a href="princomp.html#cb15-9"></a><span class="kw">plot</span>(PCA_wall)</span></code></pre></div>
<p><img src="SGS_files/figure-html/Get%20PCA%20model-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="princomp.html#cb16-1"></a>PCA_model &lt;-<span class="st"> </span>PCA<span class="op">$</span>model</span></code></pre></div>
<p>We can check the proportion of variance contained in each principal component:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="princomp.html#cb17-1"></a><span class="kw">summary</span>(PCA_model)</span></code></pre></div>
<pre><code>## Importance of components:
##                          Comp.1    Comp.2     Comp.3     Comp.4     Comp.5
## Standard deviation     2.983183 1.2064618 1.13300103 0.85484659 0.51901897
## Proportion of Variance 0.684568 0.1119654 0.09874549 0.05621252 0.02072159
## Cumulative Proportion  0.684568 0.7965334 0.89527885 0.95149136 0.97221296
##                            Comp.6      Comp.7     Comp.8      Comp.9
## Standard deviation     0.41358876 0.325794942 0.21689690 0.140456117
## Proportion of Variance 0.01315813 0.008164796 0.00361879 0.001517532
## Cumulative Proportion  0.98537108 0.993535880 0.99715467 0.998672202
##                             Comp.10      Comp.11      Comp.12      Comp.13
## Standard deviation     0.0969461455 0.0732846305 0.0427731550 2.574170e-02
## Proportion of Variance 0.0007229658 0.0004131259 0.0001407341 5.097195e-05
## Cumulative Proportion  0.9993951681 0.9998082940 0.9999490281 1.000000e+00</code></pre>
<div id="use-pca-model-to-get-pca-values-of-an-existing-set-of-plots" class="section level2 unnumbered">
<h2>Use PCA model to get PCA values of an existing set of plots</h2>
<p>A network of 182 plots was already established in RMF. The objective of the structural guided sampling was to check if the existing plot network was covering the entire range of structural variability and if not, selecting new plots in underrepresented forest types.</p>
<p>We load the existing set of plots. All the ALS metrics that were calculated to make the PCA model have also been calculated at the plot-level.</p>
<p>Note: Make sure that the name of metrics used to get the PCA model correspond to the name of the plot-level metrics</p>
<p>We can use the <code>predict</code> function to get PCA values of the existing set of plots and off the candidate cells</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="princomp.html#cb19-1"></a><span class="co"># Plot-level</span></span>
<span id="cb19-2"><a href="princomp.html#cb19-2"></a>plots_metrics &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;plots_metrics.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;RMFinventory&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `plots_metrics&#39; from data source `G:\Programs\R-4.0.3\library\RMFinventory\extdata\plots_metrics.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 5 features and 14 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 432109.8 ymin: 5337921 xmax: 437372.2 ymax: 5342820
## projected CRS:  UTM_Zone_17_Northern_Hemisphere</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="princomp.html#cb21-1"></a>plots_metrics_coords &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(plots_metrics)</span>
<span id="cb21-2"><a href="princomp.html#cb21-2"></a>plots_metrics_df &lt;-<span class="st"> </span>plots_metrics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_drop_geometry</span>()</span>
<span id="cb21-3"><a href="princomp.html#cb21-3"></a></span>
<span id="cb21-4"><a href="princomp.html#cb21-4"></a>plots_PCA &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(PCA_model, plots_metrics_df))[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span>
<span id="cb21-5"><a href="princomp.html#cb21-5"></a><span class="kw">colnames</span>(plots_PCA) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="princomp.html#cb22-1"></a><span class="co">#Candidate cells</span></span>
<span id="cb22-2"><a href="princomp.html#cb22-2"></a></span>
<span id="cb22-3"><a href="princomp.html#cb22-3"></a><span class="co"># This is the sricpt that would be ran. Since candidates are just a subset of the wall to wall cells, we could also just mask the PCA_wall layer cells tha are not part of the candidate cells. </span></span>
<span id="cb22-4"><a href="princomp.html#cb22-4"></a>PCA_candidates &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">predict</span>(wall_poly_roads, <span class="dt">model =</span> PCA_model, <span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),  <span class="dt">filename =</span> <span class="st">&quot;dat/PCA_candidates.tif&quot;</span>)</span></code></pre></div>
<p>Once PCA values of all forested cells, candidate cells and existing plots have been calculated, it is useful to plot them to visualize their distribution.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="princomp.html#cb23-1"></a><span class="co"># In the following steps we get raster cells values in a data.frame</span></span>
<span id="cb23-2"><a href="princomp.html#cb23-2"></a><span class="co"># With large raster object it can creates very large objects in memory</span></span>
<span id="cb23-3"><a href="princomp.html#cb23-3"></a>df_PCA_wall &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(PCA_wall, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">xy =</span> <span class="ot">FALSE</span>)</span>
<span id="cb23-4"><a href="princomp.html#cb23-4"></a>df_PCA_candidates &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(PCA_candidates, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">xy =</span> <span class="ot">FALSE</span>)</span>
<span id="cb23-5"><a href="princomp.html#cb23-5"></a></span>
<span id="cb23-6"><a href="princomp.html#cb23-6"></a><span class="co">## Function to calculate point density in scatterplot</span></span>
<span id="cb23-7"><a href="princomp.html#cb23-7"></a>get_density &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, ...) {</span>
<span id="cb23-8"><a href="princomp.html#cb23-8"></a>  dens &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">kde2d</span>(x, y, ...)</span>
<span id="cb23-9"><a href="princomp.html#cb23-9"></a>  ix &lt;-<span class="st"> </span><span class="kw">findInterval</span>(x, dens<span class="op">$</span>x)</span>
<span id="cb23-10"><a href="princomp.html#cb23-10"></a>  iy &lt;-<span class="st"> </span><span class="kw">findInterval</span>(y, dens<span class="op">$</span>y)</span>
<span id="cb23-11"><a href="princomp.html#cb23-11"></a>  ii &lt;-<span class="st"> </span><span class="kw">cbind</span>(ix, iy)</span>
<span id="cb23-12"><a href="princomp.html#cb23-12"></a>  <span class="kw">return</span>(dens<span class="op">$</span>z[ii])</span>
<span id="cb23-13"><a href="princomp.html#cb23-13"></a>}</span>
<span id="cb23-14"><a href="princomp.html#cb23-14"></a></span>
<span id="cb23-15"><a href="princomp.html#cb23-15"></a><span class="co">#Calculate point density for scatterplot visualization</span></span>
<span id="cb23-16"><a href="princomp.html#cb23-16"></a>df_PCA_candidates &lt;-<span class="st"> </span>df_PCA_candidates <span class="op">%&gt;%</span></span>
<span id="cb23-17"><a href="princomp.html#cb23-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dens =</span> <span class="kw">get_density</span>(PC1, PC2, <span class="dt">n =</span> <span class="dv">300</span>))</span>
<span id="cb23-18"><a href="princomp.html#cb23-18"></a></span>
<span id="cb23-19"><a href="princomp.html#cb23-19"></a><span class="co"># Get convex hulls </span></span>
<span id="cb23-20"><a href="princomp.html#cb23-20"></a></span>
<span id="cb23-21"><a href="princomp.html#cb23-21"></a>hulls_wall_idx &lt;-<span class="st"> </span><span class="kw">chull</span>(df_PCA_wall<span class="op">$</span>PC1, df_PCA_wall<span class="op">$</span>PC2)</span>
<span id="cb23-22"><a href="princomp.html#cb23-22"></a>hulls_wall &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">slice</span>(df_PCA_wall[,<span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>,<span class="st">&quot;PC2&quot;</span>)],hulls_wall_idx)</span>
<span id="cb23-23"><a href="princomp.html#cb23-23"></a></span>
<span id="cb23-24"><a href="princomp.html#cb23-24"></a>hulls_cand_idx &lt;-<span class="st"> </span><span class="kw">chull</span>(df_PCA_candidates<span class="op">$</span>PC1, df_PCA_candidates<span class="op">$</span>PC2)</span>
<span id="cb23-25"><a href="princomp.html#cb23-25"></a>hulls_cand &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">slice</span>(df_PCA_candidates[,<span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>,<span class="st">&quot;PC2&quot;</span>)],hulls_cand_idx)</span>
<span id="cb23-26"><a href="princomp.html#cb23-26"></a></span>
<span id="cb23-27"><a href="princomp.html#cb23-27"></a><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-28"><a href="princomp.html#cb23-28"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_wall, <span class="dt">colour =</span> <span class="st">&quot;#440154FF&quot;</span>, <span class="dt">fill =</span><span class="st">&quot;#440154FF&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb23-29"><a href="princomp.html#cb23-29"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_cand, <span class="dt">colour =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-30"><a href="princomp.html#cb23-30"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_PCA_candidates, <span class="kw">aes</span>(<span class="dt">color =</span> dens)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-31"><a href="princomp.html#cb23-31"></a><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-32"><a href="princomp.html#cb23-32"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plots_PCA) <span class="op">+</span><span class="st"> </span></span>
<span id="cb23-33"><a href="princomp.html#cb23-33"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb23-34"><a href="princomp.html#cb23-34"></a><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></span>
<span id="cb23-35"><a href="princomp.html#cb23-35"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb23-36"><a href="princomp.html#cb23-36"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="princomp.html#cb24-1"></a><span class="co">#Function to calculate point density in scatterplot</span></span>
<span id="cb24-2"><a href="princomp.html#cb24-2"></a>get_density &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, ...) {</span>
<span id="cb24-3"><a href="princomp.html#cb24-3"></a>  dens &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">kde2d</span>(x, y, ...)</span>
<span id="cb24-4"><a href="princomp.html#cb24-4"></a>  ix &lt;-<span class="st"> </span><span class="kw">findInterval</span>(x, dens<span class="op">$</span>x)</span>
<span id="cb24-5"><a href="princomp.html#cb24-5"></a>  iy &lt;-<span class="st"> </span><span class="kw">findInterval</span>(y, dens<span class="op">$</span>y)</span>
<span id="cb24-6"><a href="princomp.html#cb24-6"></a>  ii &lt;-<span class="st"> </span><span class="kw">cbind</span>(ix, iy)</span>
<span id="cb24-7"><a href="princomp.html#cb24-7"></a>  <span class="kw">return</span>(dens<span class="op">$</span>z[ii])</span>
<span id="cb24-8"><a href="princomp.html#cb24-8"></a>}</span></code></pre></div>
</div>
<div id="stratification" class="section level2 unnumbered">
<h2>Stratification</h2>
<p>Once PCA values have been calculated we can stratify the PC1 / PC2 feature space. The approach chosen for the RMF was to stratify using equal intervals.</p>
<p>From the previous plot, we can decide to stratify the feature space into 7 equal interval on the PC1 axis and 5 intervals on the PC2 axis (7 x 5 grid). We can use the function <code>getPCAstrata</code> to automatically create the stratification:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="princomp.html#cb25-1"></a><span class="co"># Determine the number of breaks for the first and second features (PC1 and PC2) </span></span>
<span id="cb25-2"><a href="princomp.html#cb25-2"></a>strata &lt;-<span class="st"> </span>RMFinventory<span class="op">::</span><span class="kw">getPCAstrata</span>(<span class="dt">PCA_layer =</span> PCA_candidates,</span>
<span id="cb25-3"><a href="princomp.html#cb25-3"></a>                                  <span class="dt">nbreaks =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">6</span>), <span class="co">#Since we want a 7 x 5 grid we need 8 x 6 breaks</span></span>
<span id="cb25-4"><a href="princomp.html#cb25-4"></a>                                  <span class="dt">summary =</span> <span class="ot">TRUE</span>)</span>
<span id="cb25-5"><a href="princomp.html#cb25-5"></a></span>
<span id="cb25-6"><a href="princomp.html#cb25-6"></a></span>
<span id="cb25-7"><a href="princomp.html#cb25-7"></a><span class="co">#getPCAstrata returns a list of three objects</span></span>
<span id="cb25-8"><a href="princomp.html#cb25-8"></a></span>
<span id="cb25-9"><a href="princomp.html#cb25-9"></a>strata_candidates &lt;-<span class="st"> </span>strata<span class="op">$</span>strata_layer</span>
<span id="cb25-10"><a href="princomp.html#cb25-10"></a>strata_candidates</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 277, 373, 103321  (nrow, ncol, ncell)
## resolution : 20, 20  (x, y)
## extent     : 431100, 438560, 5337700, 5343240  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=17 +ellps=GRS80 +units=m +no_defs 
## source     : memory
## names      : strata 
## values     : 12, 75  (min, max)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="princomp.html#cb27-1"></a><span class="kw">plot</span>(strata_candidates)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="princomp.html#cb28-1"></a>breaks &lt;-<span class="st"> </span>strata<span class="op">$</span>breaks</span>
<span id="cb28-2"><a href="princomp.html#cb28-2"></a>breaks</span></code></pre></div>
<pre><code>## $PC1
## [1] -5.3840455 -3.4519431 -1.5198408  0.4122616  2.3443639  4.2764663
## [7]  6.2085686  8.1406710
## 
## $PC2
## [1] -4.1297172 -1.8145574  0.5006024  2.8157622  5.1309220  7.4460818</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="princomp.html#cb30-1"></a>strata<span class="op">$</span>summary</span></code></pre></div>
<pre><code>## # A tibble: 35 x 3
##    strata count    frac
##    &lt;ord&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 11         0 0      
##  2 12      5467 0.183  
##  3 13       130 0.00435
##  4 14         0 0      
##  5 15         0 0      
##  6 21         0 0      
##  7 22      3183 0.106  
##  8 23      1619 0.0541 
##  9 24         0 0      
## 10 25         0 0      
## # ... with 25 more rows</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="princomp.html#cb32-1"></a>strata<span class="op">$</span>matrix</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7]
## [1,]   11   21   31   41   51   61   71
## [2,]   12   22   32   42   52   62   72
## [3,]   13   23   33   43   53   63   73
## [4,]   14   24   34   44   54   64   74
## [5,]   15   25   35   45   55   65   75</code></pre>
<p>We can use the breaks returned by the <code>getPCAstrata</code> function to get the strata of the existing set of plots:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="princomp.html#cb34-1"></a>strata &lt;-<span class="st"> </span><span class="kw">getPCAstrata</span>(<span class="dt">PCA_layer =</span> plots_PCA,</span>
<span id="cb34-2"><a href="princomp.html#cb34-2"></a>                             <span class="dt">breaks =</span> breaks, <span class="co"># From the precedent call to getPCAstrata</span></span>
<span id="cb34-3"><a href="princomp.html#cb34-3"></a>                             <span class="dt">summary =</span> <span class="ot">TRUE</span>)</span>
<span id="cb34-4"><a href="princomp.html#cb34-4"></a></span>
<span id="cb34-5"><a href="princomp.html#cb34-5"></a>strata_plots &lt;-<span class="st"> </span>strata<span class="op">$</span>strata_layer</span>
<span id="cb34-6"><a href="princomp.html#cb34-6"></a>strata_plots</span></code></pre></div>
<pre><code>## [1] 42 12 54 52 54
## 35 Levels: 11 &lt; 12 &lt; 13 &lt; 14 &lt; 15 &lt; 21 &lt; 22 &lt; 23 &lt; 24 &lt; 25 &lt; 31 &lt; ... &lt; 75</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="princomp.html#cb36-1"></a>strata<span class="op">$</span>summary</span></code></pre></div>
<pre><code>## # A tibble: 35 x 3
##    strata count  frac
##    &lt;ord&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 11         0   0  
##  2 12         1   0.2
##  3 13         0   0  
##  4 14         0   0  
##  5 15         0   0  
##  6 21         0   0  
##  7 22         0   0  
##  8 23         0   0  
##  9 24         0   0  
## 10 25         0   0  
## # ... with 25 more rows</code></pre>
<p>Make a new plots with break lines between strata</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="princomp.html#cb38-1"></a><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-2"><a href="princomp.html#cb38-2"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_wall, <span class="dt">colour =</span> <span class="st">&quot;#440154FF&quot;</span>, <span class="dt">fill =</span><span class="st">&quot;#440154FF&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb38-3"><a href="princomp.html#cb38-3"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_cand, <span class="dt">colour =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-4"><a href="princomp.html#cb38-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_PCA_candidates, <span class="kw">aes</span>(<span class="dt">color =</span> dens)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-5"><a href="princomp.html#cb38-5"></a><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-6"><a href="princomp.html#cb38-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plots_PCA, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-7"><a href="princomp.html#cb38-7"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> breaks<span class="op">$</span>PC1, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-8"><a href="princomp.html#cb38-8"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> breaks<span class="op">$</span>PC2, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-9"><a href="princomp.html#cb38-9"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb38-10"><a href="princomp.html#cb38-10"></a><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></span>
<span id="cb38-11"><a href="princomp.html#cb38-11"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb38-12"><a href="princomp.html#cb38-12"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="select-new-plots" class="section level2 unnumbered">
<h2>Select new plots</h2>
<p>The function <code>sampleCells</code> that performs the sampling requires the number of cells to sample for each strata. This can be determined based on the previous feature space plots, total number of plots than can be selected, number of existing plots, how many of them should be re-measured etc.</p>
<p>The following figure illustrates the sampling process:</p>
<div class="figure"><span id="fig:unnamed-chunk-25"></span>
<img src="G:/Programs/R-4.0.3/library/RMFinventory/extdata/figures/Flow_RMF_sampling.png" alt="Sampling process diagram" width="100%" />
<p class="caption">
Figure 1: Sampling process diagram
</p>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="princomp.html#cb39-1"></a>toSample &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;cells_to_sample.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;RMFinventory&quot;</span>), <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb39-2"><a href="princomp.html#cb39-2"></a>toSample</span></code></pre></div>
<pre><code>##    strata toSample
## 1      13        1
## 2      14        2
## 3      22        1
## 4      23        3
## 5      24        3
## 6      25        0
## 7      31        1
## 8      32        1
## 9      33        5
## 10     34        3
## 11     35        0
## 12     41        1
## 13     42        2
## 14     43        5
## 15     44        3
## 16     45        1
## 17     51        1
## 18     52        2
## 19     53        4
## 20     54        5
## 21     55        2
## 22     61        0
## 23     62        1
## 24     63        2
## 25     64        2
## 26     65        2
## 27     72        0
## 28     73        1
## 29     74        1
## 30     75        0</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="princomp.html#cb41-1"></a>existing_plots &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">plotID =</span> plots_metrics<span class="op">$</span>plotID, </span>
<span id="cb41-2"><a href="princomp.html#cb41-2"></a>                             <span class="dt">x =</span> plots_metrics_coords[,<span class="dv">1</span>], </span>
<span id="cb41-3"><a href="princomp.html#cb41-3"></a>                             <span class="dt">y =</span> plots_metrics_coords[,<span class="dv">2</span>], </span>
<span id="cb41-4"><a href="princomp.html#cb41-4"></a>                             <span class="dt">strata =</span> strata_plots)</span>
<span id="cb41-5"><a href="princomp.html#cb41-5"></a>existing_plots</span></code></pre></div>
<pre><code>##   plotID        x       y strata
## 1      1 432109.8 5340150     42
## 2      2 434310.2 5342820     12
## 3      3 435506.5 5340228     54
## 4      4 435478.0 5337921     52
## 5      5 437372.2 5342478     54</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="princomp.html#cb43-1"></a>new_plots &lt;-<span class="st"> </span>RMFinventory <span class="op">::</span><span class="kw">sampleCells</span>(<span class="dt">strata_layer =</span> strata_candidates,</span>
<span id="cb43-2"><a href="princomp.html#cb43-2"></a>                         <span class="dt">matrix_strata =</span> strata<span class="op">$</span>matrix, </span>
<span id="cb43-3"><a href="princomp.html#cb43-3"></a>                         <span class="dt">existing_sample =</span> existing_plots, <span class="co"># You can provide a set of existing plots or output of previous call to sampleCells and these cells won&#39;t be sampled again.</span></span>
<span id="cb43-4"><a href="princomp.html#cb43-4"></a>                         <span class="dt">toSample =</span> toSample, </span>
<span id="cb43-5"><a href="princomp.html#cb43-5"></a>                         <span class="dt">mindist =</span> <span class="dv">150</span>, </span>
<span id="cb43-6"><a href="princomp.html#cb43-6"></a>                         <span class="dt">message =</span> T)</span>
<span id="cb43-7"><a href="princomp.html#cb43-7"></a></span>
<span id="cb43-8"><a href="princomp.html#cb43-8"></a><span class="co"># There might be a warning like this: </span></span>
<span id="cb43-9"><a href="princomp.html#cb43-9"></a><span class="co">#no non-missing arguments to min; returning Infno non-missing arguments to max; returning -Inf</span></span>
<span id="cb43-10"><a href="princomp.html#cb43-10"></a><span class="co"># If think safe to ignore but need to look more into that</span></span>
<span id="cb43-11"><a href="princomp.html#cb43-11"></a>new_plots </span></code></pre></div>
<pre><code>##            x       y strata          cluster     type plotID
## 1   438450.0 5339210     13 cluster extended      New     NA
## 2   438230.0 5339710     22          cluster      New     NA
## 3   438490.0 5339010     23          cluster      New     NA
## 4   435350.0 5338630     23          cluster      New     NA
## 5   434530.0 5339410     23          cluster      New     NA
## 6   437990.0 5341250     32          cluster      New     NA
## 7   434970.0 5339230     33 cluster extended      New     NA
## 8   435430.0 5340070     33 cluster extended      New     NA
## 9   438030.0 5338830     33 cluster extended      New     NA
## 10  433410.0 5342950     33 cluster extended      New     NA
## 11  432570.0 5339090     33 cluster extended      New     NA
## 12  434390.0 5339190     34         isolated      New     NA
## 13  435110.0 5339610     34         isolated      New     NA
## 14  437490.0 5342910     34         isolated      New     NA
## 15  433410.0 5342550     41 cluster extended      New     NA
## 16  432109.8 5340150     42             &lt;NA&gt; Existing      1
## 111 436490.0 5341690     42          cluster      New     NA
## 121 433450.0 5342030     42          cluster      New     NA
## 17  438250.0 5341310     43 cluster extended      New     NA
## 21  437250.0 5342150     43 cluster extended      New     NA
## 31  431230.0 5342710     43 cluster extended      New     NA
## 41  438370.0 5341070     43 cluster extended      New     NA
## 51  438290.0 5337930     43 cluster extended      New     NA
## 18  435030.0 5338950     44         isolated      New     NA
## 22  437410.0 5342590     44         isolated      New     NA
## 32  434390.0 5339510     44         isolated      New     NA
## 19  432510.0 5338850     51          cluster      New     NA
## 42  435478.0 5337921     52             &lt;NA&gt; Existing      4
## 110 436230.0 5341430     52          cluster      New     NA
## 112 432850.0 5340310     52          cluster      New     NA
## 113 431550.0 5342730     53          cluster      New     NA
## 23  432190.0 5343210     53          cluster      New     NA
## 33  433070.0 5339410     53 cluster extended      New     NA
## 43  434330.0 5342950     53 cluster extended      New     NA
## 34  435506.5 5340228     54             &lt;NA&gt; Existing      3
## 52  437372.2 5342478     54             &lt;NA&gt; Existing      5
## 114 432990.0 5339110     54 cluster extended      New     NA
## 115 437190.0 5342170     54 cluster extended      New     NA
## 122 437290.0 5342350     54 cluster extended      New     NA
## 131 438390.0 5340810     54 cluster extended      New     NA
## 141 432830.0 5338950     54 cluster extended      New     NA
## 116 437290.0 5342430     55 cluster extended      New     NA
## 24  435470.0 5340290     55 cluster extended      New     NA
## 117 438330.0 5341010     62 cluster extended      New     NA
## 118 431890.0 5338510     63 cluster extended      New     NA
## 25  432730.0 5340070     63 cluster extended      New     NA
## 119 432990.0 5339590     64 cluster extended      New     NA
## 26  438150.0 5341910     64 cluster extended      New     NA
## 120 437310.0 5342410     65 cluster extended      New     NA
## 27  437950.0 5341590     65 cluster extended      New     NA
## 123 432710.0 5341030     73 cluster extended      New     NA
## 124 438450.0 5338710     74 cluster extended      New     NA</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="princomp.html#cb45-1"></a><span class="co">#Assign plotID to sampled plots</span></span>
<span id="cb45-2"><a href="princomp.html#cb45-2"></a>new_plots &lt;-<span class="st"> </span>new_plots <span class="op">%&gt;%</span></span>
<span id="cb45-3"><a href="princomp.html#cb45-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">plotID =</span> <span class="kw">ifelse</span>(type <span class="op">==</span><span class="st"> &quot;New&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;S_&quot;</span>, <span class="kw">seq_len</span>(<span class="kw">n</span>())), plotID))</span>
<span id="cb45-4"><a href="princomp.html#cb45-4"></a></span>
<span id="cb45-5"><a href="princomp.html#cb45-5"></a><span class="co">#Convert to sf object</span></span>
<span id="cb45-6"><a href="princomp.html#cb45-6"></a>new_plots_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(new_plots, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</span>
<span id="cb45-7"><a href="princomp.html#cb45-7"></a></span>
<span id="cb45-8"><a href="princomp.html#cb45-8"></a><span class="kw">plot</span>(strata_candidates)</span>
<span id="cb45-9"><a href="princomp.html#cb45-9"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(new_plots_sf), <span class="dt">add =</span> T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="princomp.html#cb46-1"></a><span class="co">#Get metrics and PCA of new plots</span></span>
<span id="cb46-2"><a href="princomp.html#cb46-2"></a>new_plots_metrics &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extract</span>(wall_poly_roads, new_plots_sf) <span class="co">#could also get from point cloud directly</span></span>
<span id="cb46-3"><a href="princomp.html#cb46-3"></a>new_plots_PCA &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(PCA_model, new_plots_metrics))[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</span>
<span id="cb46-4"><a href="princomp.html#cb46-4"></a><span class="kw">colnames</span>(new_plots_PCA) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;PC2&quot;</span>)</span>
<span id="cb46-5"><a href="princomp.html#cb46-5"></a></span>
<span id="cb46-6"><a href="princomp.html#cb46-6"></a></span>
<span id="cb46-7"><a href="princomp.html#cb46-7"></a><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-8"><a href="princomp.html#cb46-8"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_wall, <span class="dt">colour =</span> <span class="st">&quot;#440154FF&quot;</span>, <span class="dt">fill =</span><span class="st">&quot;#440154FF&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></span>
<span id="cb46-9"><a href="princomp.html#cb46-9"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> hulls_cand, <span class="dt">colour =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-10"><a href="princomp.html#cb46-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df_PCA_candidates, <span class="kw">aes</span>(<span class="dt">color =</span> dens)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-11"><a href="princomp.html#cb46-11"></a><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-12"><a href="princomp.html#cb46-12"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> new_plots_PCA, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-13"><a href="princomp.html#cb46-13"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> breaks<span class="op">$</span>PC1, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-14"><a href="princomp.html#cb46-14"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> breaks<span class="op">$</span>PC2, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-15"><a href="princomp.html#cb46-15"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb46-16"><a href="princomp.html#cb46-16"></a><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></span>
<span id="cb46-17"><a href="princomp.html#cb46-17"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb46-18"><a href="princomp.html#cb46-18"></a>        <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>

<style type="text/css">
pre {
  max-height: 300px;
  overflow-y: auto;
}
pre[class] {
  max-height: 100px;
}
</style>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-RMFinventory">
<p>it, Who wrote. 2021. <em>RMFinventory: What the Package Does (Title Case)</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataprep.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="strat.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SGS.pdf", "SGS.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
