<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Other stratification methods | Structurally Guided Sampling</title>
  <meta name="description" content="Other stratification methods | Structurally Guided Sampling" />
  <meta name="generator" content="bookdown 0.21.5 and GitBook 2.6.7" />

  <meta property="og:title" content="Other stratification methods | Structurally Guided Sampling" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Other stratification methods | Structurally Guided Sampling" />
  
  
  

<meta name="author" content="Tristan Goodbody" />


<meta name="date" content="2021-03-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="princomp.html"/>
<link rel="next" href="disc.html"/>
<script src="libs/header-attrs-2.5.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Approaches to Structurally Guided Sampling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="SGS.html"><a href="SGS.html"><i class="fa fa-check"></i>Structurally Guided Sampling Review</a>
<ul>
<li class="chapter" data-level="" data-path="SGS.html"><a href="SGS.html#stratapp"><i class="fa fa-check"></i>Stratification approaches</a>
<ul>
<li><a href="SGS.html#hawbaker2009"><span class="citation">(<span>Hawbaker et al. 2009</span>)</span></a></li>
<li><a href="SGS.html#dalponte2011"><span class="citation">(<span>Dalponte et al. 2011</span>)</span></a></li>
<li><a href="SGS.html#maltamo2011"><span class="citation">(<span>Maltamo et al. 2011</span>)</span></a></li>
<li><a href="SGS.html#junttila2013"><span class="citation">(<span>Junttila et al. 2013</span>)</span></a></li>
<li><a href="SGS.html#valbuena2013"><span class="citation">(<span>Valbuena et al. 2013</span>)</span></a></li>
<li><a href="SGS.html#grafstrom2013"><span class="citation">(<span>Grafström and Ringvall 2013</span>)</span></a></li>
<li><a href="SGS.html#grafstrom2014"><span class="citation">(<span>Grafström, Saarela, and Ene 2014</span>)</span></a></li>
<li><a href="SGS.html#niemi2016"><span class="citation">(<span>Niemi and Vauhkonen 2016</span>)</span></a></li>
<li><a href="SGS.html#valbuena2017"><span class="citation">(<span>Valbuena et al. 2017</span>)</span></a></li>
<li><a href="SGS.html#mcroberts2017"><span class="citation">(<span>McRoberts, Chen, and Walters 2017</span>)</span></a></li>
<li><a href="SGS.html#malone2019"><span class="citation">(<span>Malone, Minansy, and Brungard 2019</span>)</span></a></li>
<li><a href="SGS.html#papa2020"><span class="citation">(<span>Papa et al. 2020</span>)</span></a></li>
<li><a href="SGS.html#ma2020"><span class="citation">(<span>Ma et al. 2020</span>)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html"><i class="fa fa-check"></i>Data Preparation</a>
<ul>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html#load-wall-to-wall-metrics"><i class="fa fa-check"></i>Load wall-to-wall metrics</a></li>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html#integrate-forest-inventory-layers"><i class="fa fa-check"></i>Integrate forest inventory layers</a></li>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html#prepare-road-buffers-for-future-masking"><i class="fa fa-check"></i>Prepare road buffers for future masking</a>
<ul>
<li class="chapter" data-level="" data-path="dataprep.html"><a href="dataprep.html#road-buffering-outputs"><i class="fa fa-check"></i>Road buffering outputs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html"><i class="fa fa-check"></i>Principal Components</a>
<ul>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#use-pca-model-to-get-pca-values-of-an-existing-set-of-plots"><i class="fa fa-check"></i>Use PCA model to get PCA values of an existing set of plots</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#candidate-cells"><i class="fa fa-check"></i>Candidate cells</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#stratification"><i class="fa fa-check"></i>Stratification</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#exist-plots"><i class="fa fa-check"></i>Derive strata for existing plots</a></li>
<li class="chapter" data-level="" data-path="princomp.html"><a href="princomp.html#select-new-plots"><i class="fa fa-check"></i>Select new plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html"><i class="fa fa-check"></i>Other stratification methods</a>
<ul>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#kmeans"><i class="fa fa-check"></i>K-means</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#clusterchallenge"><i class="fa fa-check"></i>How many clusters?</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#OSB"><i class="fa fa-check"></i>Optimum stratum boundaries</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#sampling-within-groupsstrata"><i class="fa fa-check"></i>Sampling within groups/strata</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#srs"><i class="fa fa-check"></i>Simple Random Sampling</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#using-2-variables-to-stratify"><i class="fa fa-check"></i>Using 2 variables to stratify</a>
<ul>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#variable-road-masked"><i class="fa fa-check"></i>2 Variable Road Masked</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#non-stratified-sampling-methods"><i class="fa fa-check"></i>Non-stratified sampling methods</a>
<ul>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#balanced-sampling"><i class="fa fa-check"></i>Balanced Sampling</a></li>
<li class="chapter" data-level="" data-path="strat.html"><a href="strat.html#lhs"><i class="fa fa-check"></i>Latin Hypercube Sampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html"><i class="fa fa-check"></i>Discussion points</a>
<ul>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#methods"><i class="fa fa-check"></i>Methods</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#need-to-integrate-already-established-samples"><i class="fa fa-check"></i>Need to integrate already established samples</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#algorithm-creation"><i class="fa fa-check"></i>Algorithm creation</a></li>
<li class="chapter" data-level="" data-path="disc.html"><a href="disc.html#agenda-for-future"><i class="fa fa-check"></i>Agenda for future</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structurally Guided Sampling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="strat" class="section level1 unnumbered">
<h1>Other stratification methods</h1>
<p>The second method we outline is using k means stratification for consequent stratified sampling.</p>
<div id="kmeans" class="section level2 unnumbered">
<h2>K-means</h2>
<p>Here is a standard way to apply unsupervised K-means and allocate each ALS cell to a cluster.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="strat.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">### K MEANS </span><span class="al">###</span></span>
<span id="cb43-2"><a href="strat.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-3"><a href="strat.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="strat.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract values for Kmeans</span></span>
<span id="cb43-5"><a href="strat.html#cb43-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> rast_dt_wall</span>
<span id="cb43-6"><a href="strat.html#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="strat.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="do">## determine index of each cell so to map values correctly without NA&#39;s</span></span>
<span id="cb43-8"><a href="strat.html#cb43-8" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(wall_poly)</span>
<span id="cb43-9"><a href="strat.html#cb43-9" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> idx[<span class="sc">-</span><span class="fu">unique</span>(<span class="fu">which</span>(<span class="fu">is.na</span>(v), <span class="at">arr.ind=</span><span class="cn">TRUE</span>)[,<span class="dv">1</span>])]  </span>
<span id="cb43-10"><a href="strat.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="strat.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="do">############################</span></span>
<span id="cb43-12"><a href="strat.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="do">#### K MEANS CLUSTERING ####</span></span>
<span id="cb43-13"><a href="strat.html#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="do">############################</span></span>
<span id="cb43-14"><a href="strat.html#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="strat.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="do">#### DETERMINE OPTIMAL NUMBER OF CLUSTERS?????</span></span>
<span id="cb43-16"><a href="strat.html#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply K means - center and scale values and remove NA&#39;s</span></span>
<span id="cb43-17"><a href="strat.html#cb43-17" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="fu">na.omit</span>(<span class="fu">scale</span>(v,<span class="at">center =</span> T,<span class="at">scale=</span>T)), <span class="dv">4</span>)</span>
<span id="cb43-18"><a href="strat.html#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="strat.html#cb43-19" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> E<span class="sc">$</span>cluster</span>
<span id="cb43-20"><a href="strat.html#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="strat.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create empty raster from original candidate dimentions</span></span>
<span id="cb43-22"><a href="strat.html#cb43-22" aria-hidden="true" tabindex="-1"></a>r.empty <span class="ot">&lt;-</span> wall_poly[[<span class="dv">1</span>]]</span>
<span id="cb43-23"><a href="strat.html#cb43-23" aria-hidden="true" tabindex="-1"></a>r.empty[] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb43-24"><a href="strat.html#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="strat.html#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add cluster values to corresponding index and re-name</span></span>
<span id="cb43-26"><a href="strat.html#cb43-26" aria-hidden="true" tabindex="-1"></a>r.empty[idx] <span class="ot">&lt;-</span> clusters</span>
<span id="cb43-27"><a href="strat.html#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(r.empty) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;clusters&quot;</span>)</span>
<span id="cb43-28"><a href="strat.html#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="strat.html#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="co">#combine clusters with original structural metrics</span></span>
<span id="cb43-30"><a href="strat.html#cb43-30" aria-hidden="true" tabindex="-1"></a>wall_poly[[<span class="dv">14</span>]] <span class="ot">&lt;-</span> r.empty</span>
<span id="cb43-31"><a href="strat.html#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="strat.html#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="strat.html#cb43-33" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">&quot;Spectral&quot;</span>)</span>
<span id="cb43-34"><a href="strat.html#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly<span class="sc">$</span>clusters,<span class="at">col=</span>pal)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div id="clusterchallenge" class="section level2 unnumbered">
<h2>How many clusters?</h2>
<p>This is a loaded questions. How many clusters to choose can depends on many reasons, and there are many ways to determine how many to use. A challenge with the K-means method is being objective about the number of strata to use and where to partition the data. I present a number of examples below. <span class="citation">(<a href="#ref-Papa2020" role="doc-biblioref">Papa et al. 2020</a>)</span> used k-means clustering and outlined that they used the <em>Elbow method</em> to determine the number of clusters.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="strat.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Elbow Method for finding the optimal number of clusters</span></span>
<span id="cb44-2"><a href="strat.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb44-3"><a href="strat.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="strat.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- as.data.frame(na.omit(scale(v)))</span></span>
<span id="cb44-5"><a href="strat.html#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="strat.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Elbow method</span></span>
<span id="cb44-7"><a href="strat.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(<span class="fu">as.data.frame</span>(<span class="fu">na.omit</span>(<span class="fu">scale</span>(v))), kmeans, <span class="at">method =</span> <span class="st">&quot;wss&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="strat.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co"># add line for better visualisation</span></span>
<span id="cb44-9"><a href="strat.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Elbow method&quot;</span>) <span class="co"># add subtitle</span></span></code></pre></div>
<p><img src="img/elbow_method.png" width="630" /></p>
<p>Based on the figure above we see that we can choose 4 clusters based on the elbow method. There are <strong><em>many</em></strong> methods that can be used. We see quickly that its not entirely cut and dry how to choose cluster numbers, but we have methods to decide that. <strong>This is likely something that the user will need to give input on.</strong></p>
<p>The <code>NbClust()</code> function from the <span class="citation">(<a href="#ref-R-NbClust" role="doc-biblioref">Charrad et al. 2015</a>)</span> package is an additional method, though it takes a long time to run (especially on large datasets). This function:</p>
<blockquote>
<p>provides 30 indices for determining the number of clusters and proposes to user the best clustering scheme from the different results obtained by varying all combinations of number of clusters, distance measures, and clustering methods.</p>
</blockquote>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="strat.html#cb45-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">NbClust</span>(data, <span class="at">diss=</span><span class="cn">NULL</span>, <span class="at">distance =</span> <span class="st">&quot;euclidean&quot;</span>, </span>
<span id="cb45-2"><a href="strat.html#cb45-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">min.nc=</span><span class="dv">2</span>, <span class="at">max.nc=</span><span class="dv">12</span>, <span class="at">method =</span> <span class="st">&quot;kmeans&quot;</span>, </span>
<span id="cb45-3"><a href="strat.html#cb45-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">index =</span> <span class="st">&quot;all&quot;</span>, <span class="at">alphaBeale =</span> <span class="fl">0.1</span>)</span></code></pre></div>
</div>
<div id="OSB" class="section level2 unnumbered">
<h2>Optimum stratum boundaries</h2>
<p>A method to address this is using optimal break methods like that of <code>strata.data()</code> from the <span class="citation">(<a href="#ref-R-stratifyR" role="doc-biblioref">Reddy and Khan 2019</a>)</span> package. This method takes the population of candidate cells <code>v</code> and a fixed sample size <code>100</code> to compute the optimum stratum boundaries (OSB) for a given number of strata. Along with OSB it also provides the optimum sample sizes within strata directly from the data.</p>
<p>In this example we specify that we would like data to be split into 4 strata and we iterate splits on the <code>avg</code> <code>cov</code> and <code>p99</code> variables. Some studies like <span class="citation">(<a href="#ref-Maltamo2011" role="doc-biblioref">Maltamo et al. 2011</a>)</span> and <span class="citation">(<a href="#ref-Hawbaker2009" role="doc-biblioref">Hawbaker et al. 2009</a>)</span> used multiple metrics to split on, while others like used only 1.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="strat.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare data</span></span>
<span id="cb46-2"><a href="strat.html#cb46-2" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="strat.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="strat.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="strat.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb47-2"><a href="strat.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="do">####### OPTIMAL CLUSTERING BREAKS ########</span></span>
<span id="cb47-3"><a href="strat.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb47-4"><a href="strat.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="do">##### Sampling within clusters</span></span>
<span id="cb47-5"><a href="strat.html#cb47-5" aria-hidden="true" tabindex="-1"></a>OSB <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb47-6"><a href="strat.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">10</span>)){</span>
<span id="cb47-7"><a href="strat.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1 - average height</span></span>
<span id="cb47-8"><a href="strat.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#2 - covariance</span></span>
<span id="cb47-9"><a href="strat.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#10 - p99 height</span></span>
<span id="cb47-10"><a href="strat.html#cb47-10" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">strata.data</span>(o_val[,i], <span class="at">h =</span> <span class="dv">4</span>, <span class="at">n=</span><span class="dv">100</span>) </span>
<span id="cb47-11"><a href="strat.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">names</span>(o_val[<span class="dv">1</span>])</span>
<span id="cb47-12"><a href="strat.html#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="strat.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  breaks <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res<span class="sc">$</span>OSB)</span>
<span id="cb47-14"><a href="strat.html#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(breaks)<span class="ot">=</span>k</span>
<span id="cb47-15"><a href="strat.html#cb47-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-16"><a href="strat.html#cb47-16" aria-hidden="true" tabindex="-1"></a>  OSB[[i]] <span class="ot">&lt;-</span> breaks</span>
<span id="cb47-17"><a href="strat.html#cb47-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-18"><a href="strat.html#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="strat.html#cb47-19" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(OSB[[<span class="dv">1</span>]]),<span class="fu">as.data.frame</span>(OSB[[<span class="dv">2</span>]]),<span class="fu">as.data.frame</span>(OSB[[<span class="dv">10</span>]]))</span>
<span id="cb47-20"><a href="strat.html#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(breaks) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;avg&quot;</span>,<span class="st">&quot;cov&quot;</span>,<span class="st">&quot;p99&quot;</span>)</span>
<span id="cb47-21"><a href="strat.html#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="strat.html#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(breaks,<span class="st">&quot;dat/breaks.RDS&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="strat.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(o_val,<span class="fu">aes</span>(avg))<span class="sc">+</span></span>
<span id="cb48-2"><a href="strat.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb48-3"><a href="strat.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> breaks<span class="sc">$</span>avg, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="sampling-within-groupsstrata" class="section level2 unnumbered">
<h2>Sampling within groups/strata</h2>
<p>Once OSB are defined we can associate the groups with the data themselves and perform statistical tests to determine wherther groups are significantly difference from one another. <span class="citation">(<a href="#ref-Papa2020" role="doc-biblioref">Papa et al. 2020</a>)</span> used ANOVA and Tukey post-hoc tests. First, we can change the resulting group labels from <code>cut()</code> to more understandable characters.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="strat.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define groups within splitting variable</span></span>
<span id="cb49-2"><a href="strat.html#cb49-2" aria-hidden="true" tabindex="-1"></a>split_osb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,breaks<span class="sc">$</span>avg[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],<span class="cn">Inf</span>)</span>
<span id="cb49-3"><a href="strat.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="strat.html#cb49-4" aria-hidden="true" tabindex="-1"></a>grps <span class="ot">&lt;-</span> <span class="fu">cut</span>(o_val<span class="sc">$</span>avg,split_osb)</span>
<span id="cb49-5"><a href="strat.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="strat.html#cb49-6" aria-hidden="true" tabindex="-1"></a>o_val<span class="sc">$</span>groups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(grps)</span>
<span id="cb49-7"><a href="strat.html#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="strat.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#convert groups to A | B | C | D</span></span>
<span id="cb49-9"><a href="strat.html#cb49-9" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(groups <span class="sc">==</span> <span class="st">&quot;(-Inf,5.1]&quot;</span><span class="sc">~</span><span class="st">&quot;A&quot;</span>,</span>
<span id="cb49-10"><a href="strat.html#cb49-10" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(5.1,9.33]&quot;</span><span class="sc">~</span><span class="st">&quot;B&quot;</span>,</span>
<span id="cb49-11"><a href="strat.html#cb49-11" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(9.33,14.4]&quot;</span><span class="sc">~</span><span class="st">&quot;C&quot;</span>,</span>
<span id="cb49-12"><a href="strat.html#cb49-12" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(14.4, Inf]&quot;</span><span class="sc">~</span><span class="st">&quot;D&quot;</span>))</span>
<span id="cb49-13"><a href="strat.html#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="strat.html#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical testing</span></span>
<span id="cb49-15"><a href="strat.html#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(avg<span class="sc">~</span>groups,<span class="at">data=</span>o_val))</span></code></pre></div>
<pre><code>##                Df  Sum Sq Mean Sq F value Pr(&gt;F)    
## groups          3 1290629  430210  266539 &lt;2e-16 ***
## Residuals   87230  140794       2                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="strat.html#cb51-1" aria-hidden="true" tabindex="-1"></a>o_val <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="strat.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(groups,avg,<span class="at">fill=</span>groups)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="strat.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_eye</span>()</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Once these strata are established we can begin to test a variety of sampling mechanisms.</p>
</div>
<div id="srs" class="section level2 unnumbered">
<h2>Simple Random Sampling</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="strat.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Without road masking</span></span>
<span id="cb52-2"><a href="strat.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="strat.html#cb52-3" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co">#total number of desired samples</span></span>
<span id="cb52-4"><a href="strat.html#cb52-4" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="strat.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="strat.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb52-7"><a href="strat.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="at">plot_tot =</span> <span class="fu">as.integer</span>(freq<span class="sc">*</span>ns))</span>
<span id="cb52-8"><a href="strat.html#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="strat.html#cb52-9" aria-hidden="true" tabindex="-1"></a>df_sample <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="strat.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb52-11"><a href="strat.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups) <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="strat.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb52-13"><a href="strat.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-14"><a href="strat.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> samples<span class="sc">$</span>plot_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb52-15"><a href="strat.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samp =</span> <span class="fu">map2</span>(data, n, sample_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-16"><a href="strat.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="strat.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(samp)</span>
<span id="cb52-18"><a href="strat.html#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="strat.html#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># sample summary statistics</span></span>
<span id="cb52-20"><a href="strat.html#cb52-20" aria-hidden="true" tabindex="-1"></a>df_sample <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(avg,groups) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb52-21"><a href="strat.html#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb52-22"><a href="strat.html#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb52-23"><a href="strat.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb52-24"><a href="strat.html#cb52-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   groups     n  mean    sd
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         41  3.34 1.00 
## 2 B         60  7.20 1.12 
## 3 C         79 11.7  1.39 
## 4 D         18 15.9  0.883</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="strat.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#population summary statistics</span></span>
<span id="cb54-2"><a href="strat.html#cb54-2" aria-hidden="true" tabindex="-1"></a>o_val <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="strat.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(avg,groups) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="strat.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-5"><a href="strat.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb54-6"><a href="strat.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb54-7"><a href="strat.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb54-8"><a href="strat.html#cb54-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   groups     n  mean    sd
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A      17933  3.30  1.05
## 2 B      26395  7.36  1.23
## 3 C      34626 11.8   1.41
## 4 D       8280 15.7   1.23</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="strat.html#cb56-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df_sample, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb56-2"><a href="strat.html#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="strat.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly<span class="sc">$</span>avg)</span>
<span id="cb56-4"><a href="strat.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="strat.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>avg,<span class="at">y=</span>std))<span class="sc">+</span></span>
<span id="cb57-2"><a href="strat.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> o_val, <span class="fu">aes</span>(<span class="at">color =</span> groups))<span class="sc">+</span></span>
<span id="cb57-3"><a href="strat.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sample, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb57-4"><a href="strat.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="strat.html#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb57-6"><a href="strat.html#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb57-7"><a href="strat.html#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-8"><a href="strat.html#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<pre><code>##                Df Sum Sq Mean Sq F value Pr(&gt;F)    
## groups          3 532594  177531  117528 &lt;2e-16 ***
## Residuals   29898  45162       2                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><img src="SGS_files/figure-html/unnamed-chunk-43-1.png" width="672" />
### SRS Road Masked {-}</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="strat.html#cb59-1" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co">#total number of desired samples</span></span>
<span id="cb59-2"><a href="strat.html#cb59-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="strat.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="strat.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="strat.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="at">plot_tot =</span> <span class="fu">as.integer</span>(freq<span class="sc">*</span>ns))</span>
<span id="cb59-6"><a href="strat.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="strat.html#cb59-7" aria-hidden="true" tabindex="-1"></a>df_sample <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="strat.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb59-9"><a href="strat.html#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups) <span class="sc">%&gt;%</span></span>
<span id="cb59-10"><a href="strat.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb59-11"><a href="strat.html#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-12"><a href="strat.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> samples<span class="sc">$</span>plot_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb59-13"><a href="strat.html#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samp =</span> <span class="fu">map2</span>(data, n, sample_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-14"><a href="strat.html#cb59-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb59-15"><a href="strat.html#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(samp)</span>
<span id="cb59-16"><a href="strat.html#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="strat.html#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co"># sample summary statistics</span></span>
<span id="cb59-18"><a href="strat.html#cb59-18" aria-hidden="true" tabindex="-1"></a>df_sample <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(avg,groups) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb59-19"><a href="strat.html#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb59-20"><a href="strat.html#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb59-21"><a href="strat.html#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb59-22"><a href="strat.html#cb59-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   groups     n  mean    sd
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         61  2.88 0.875
## 2 B         50  6.96 1.20 
## 3 C         69 11.8  1.44 
## 4 D         18 15.6  0.961</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="strat.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#population summary statistics</span></span>
<span id="cb61-2"><a href="strat.html#cb61-2" aria-hidden="true" tabindex="-1"></a>o_val <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="strat.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(avg,groups) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="strat.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb61-5"><a href="strat.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb61-6"><a href="strat.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb61-7"><a href="strat.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb61-8"><a href="strat.html#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   groups     n  mean    sd
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A       9126  3.15 0.992
## 2 B       7590  7.29 1.23 
## 3 C      10404 11.9  1.41 
## 4 D       2782 15.7  1.21</code></pre>
<p>Visualizing the samples</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="strat.html#cb63-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(df_sample, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb63-2"><a href="strat.html#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="strat.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly_roads<span class="sc">$</span>avg)</span>
<span id="cb63-4"><a href="strat.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="strat.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>avg,<span class="at">y=</span>std))<span class="sc">+</span></span>
<span id="cb64-2"><a href="strat.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> o_val, <span class="fu">aes</span>(<span class="at">color =</span> groups))<span class="sc">+</span></span>
<span id="cb64-3"><a href="strat.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_sample, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb64-4"><a href="strat.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb64-5"><a href="strat.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="strat.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb64-7"><a href="strat.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-8"><a href="strat.html#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-45-2.png" width="672" /></p>
</div>
<div id="using-2-variables-to-stratify" class="section level2 unnumbered">
<h2>Using 2 variables to stratify</h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="strat.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Without road masking</span></span>
<span id="cb65-2"><a href="strat.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract values for Kmeans</span></span>
<span id="cb65-3"><a href="strat.html#cb65-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> rast_dt_wall </span>
<span id="cb65-4"><a href="strat.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="strat.html#cb65-5" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> </span>
<span id="cb65-6"><a href="strat.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-7"><a href="strat.html#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb65-8"><a href="strat.html#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="strat.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">#define groups within splitting variable</span></span>
<span id="cb65-10"><a href="strat.html#cb65-10" aria-hidden="true" tabindex="-1"></a>split_osb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,breaks<span class="sc">$</span>avg[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],<span class="cn">Inf</span>)</span>
<span id="cb65-11"><a href="strat.html#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="strat.html#cb65-12" aria-hidden="true" tabindex="-1"></a>grps <span class="ot">&lt;-</span> <span class="fu">cut</span>(o_val<span class="sc">$</span>avg,split_osb)</span>
<span id="cb65-13"><a href="strat.html#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="strat.html#cb65-14" aria-hidden="true" tabindex="-1"></a>o_val<span class="sc">$</span>groups <span class="ot">&lt;-</span> <span class="fu">as.character</span>(grps)</span>
<span id="cb65-15"><a href="strat.html#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="strat.html#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">#convert groups to A | B | C | D</span></span>
<span id="cb65-17"><a href="strat.html#cb65-17" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(groups <span class="sc">==</span> <span class="st">&quot;(-Inf,5.1]&quot;</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb65-18"><a href="strat.html#cb65-18" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(5.1,9.33]&quot;</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb65-19"><a href="strat.html#cb65-19" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(9.33,14.4]&quot;</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb65-20"><a href="strat.html#cb65-20" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(14.4, Inf]&quot;</span><span class="sc">~</span><span class="dv">4</span>))</span>
<span id="cb65-21"><a href="strat.html#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="strat.html#cb65-22" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb65-23"><a href="strat.html#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb65-24"><a href="strat.html#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups2 =</span> <span class="fu">ntile</span>(std,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-25"><a href="strat.html#cb65-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;groups_m&quot;</span>,groups,groups2) <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="strat.html#cb65-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">group_indices</span>(., groups_m))</span>
<span id="cb65-27"><a href="strat.html#cb65-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-28"><a href="strat.html#cb65-28" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co">#total number of desired samples</span></span>
<span id="cb65-29"><a href="strat.html#cb65-29" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb65-30"><a href="strat.html#cb65-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb65-31"><a href="strat.html#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb65-32"><a href="strat.html#cb65-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),<span class="at">plot_tot =</span> <span class="fu">as.integer</span>(freq<span class="sc">*</span>ns))</span>
<span id="cb65-33"><a href="strat.html#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="strat.html#cb65-34" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb65-35"><a href="strat.html#cb65-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb65-36"><a href="strat.html#cb65-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups_m) <span class="sc">%&gt;%</span></span>
<span id="cb65-37"><a href="strat.html#cb65-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb65-38"><a href="strat.html#cb65-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-39"><a href="strat.html#cb65-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> samples<span class="sc">$</span>plot_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb65-40"><a href="strat.html#cb65-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samp =</span> <span class="fu">map2</span>(data, n, sample_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-41"><a href="strat.html#cb65-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb65-42"><a href="strat.html#cb65-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(samp)</span>
<span id="cb65-43"><a href="strat.html#cb65-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-44"><a href="strat.html#cb65-44" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(samp, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb65-45"><a href="strat.html#cb65-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-46"><a href="strat.html#cb65-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly<span class="sc">$</span>avg)</span>
<span id="cb65-47"><a href="strat.html#cb65-47" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="strat.html#cb66-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>avg,<span class="at">y=</span>std))<span class="sc">+</span></span>
<span id="cb66-2"><a href="strat.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> o_val, <span class="fu">aes</span>(<span class="at">color =</span> groups_m))<span class="sc">+</span></span>
<span id="cb66-3"><a href="strat.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> samp, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb66-4"><a href="strat.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-5"><a href="strat.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb66-6"><a href="strat.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-7"><a href="strat.html#cb66-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb66-8"><a href="strat.html#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="strat.html#cb66-9" aria-hidden="true" tabindex="-1"></a>coordsgrps <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="strat.html#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb66-11"><a href="strat.html#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups_m) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="strat.html#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb66-13"><a href="strat.html#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb66-14"><a href="strat.html#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="strat.html#cb66-15" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">1</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-16"><a href="strat.html#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">2</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-17"><a href="strat.html#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">3</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-18"><a href="strat.html#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">4</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-19"><a href="strat.html#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">5</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-20"><a href="strat.html#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">6</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-21"><a href="strat.html#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">7</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-22"><a href="strat.html#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">8</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-23"><a href="strat.html#cb66-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">9</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-24"><a href="strat.html#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">10</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-25"><a href="strat.html#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">11</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb66-26"><a href="strat.html#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">12</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-46-2.png" width="672" /></p>
<div id="variable-road-masked" class="section level3 unnumbered">
<h3>2 Variable Road Masked</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="strat.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## With road masking</span></span>
<span id="cb67-2"><a href="strat.html#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="strat.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract values for Kmeans</span></span>
<span id="cb67-4"><a href="strat.html#cb67-4" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> rast_dt</span>
<span id="cb67-5"><a href="strat.html#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="strat.html#cb67-6" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> </span>
<span id="cb67-7"><a href="strat.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-8"><a href="strat.html#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb67-9"><a href="strat.html#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="strat.html#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#define groups within splitting variable</span></span>
<span id="cb67-11"><a href="strat.html#cb67-11" aria-hidden="true" tabindex="-1"></a>split_osb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,breaks<span class="sc">$</span>avg[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],<span class="cn">Inf</span>)</span>
<span id="cb67-12"><a href="strat.html#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="strat.html#cb67-13" aria-hidden="true" tabindex="-1"></a>grps <span class="ot">&lt;-</span> <span class="fu">cut</span>(o_val<span class="sc">$</span>avg,split_osb)</span>
<span id="cb67-14"><a href="strat.html#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="strat.html#cb67-15" aria-hidden="true" tabindex="-1"></a>o_val<span class="sc">$</span>groups <span class="ot">&lt;-</span> <span class="fu">as.character</span>(grps)</span>
<span id="cb67-16"><a href="strat.html#cb67-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-17"><a href="strat.html#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co">#convert groups to A | B | C | D</span></span>
<span id="cb67-18"><a href="strat.html#cb67-18" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(groups <span class="sc">==</span> <span class="st">&quot;(-Inf,5.1]&quot;</span><span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb67-19"><a href="strat.html#cb67-19" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(5.1,9.33]&quot;</span><span class="sc">~</span><span class="dv">2</span>,</span>
<span id="cb67-20"><a href="strat.html#cb67-20" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(9.33,14.4]&quot;</span><span class="sc">~</span><span class="dv">3</span>,</span>
<span id="cb67-21"><a href="strat.html#cb67-21" aria-hidden="true" tabindex="-1"></a>                 groups <span class="sc">==</span> <span class="st">&quot;(14.4, Inf]&quot;</span><span class="sc">~</span><span class="dv">4</span>))</span>
<span id="cb67-22"><a href="strat.html#cb67-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-23"><a href="strat.html#cb67-23" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb67-24"><a href="strat.html#cb67-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups) <span class="sc">%&gt;%</span> </span>
<span id="cb67-25"><a href="strat.html#cb67-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups2 =</span> <span class="fu">ntile</span>(std,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-26"><a href="strat.html#cb67-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;groups_m&quot;</span>,groups,groups2) <span class="sc">%&gt;%</span></span>
<span id="cb67-27"><a href="strat.html#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">group_indices</span>(., groups_m))</span>
<span id="cb67-28"><a href="strat.html#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="strat.html#cb67-29" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co">#total number of desired samples</span></span>
<span id="cb67-30"><a href="strat.html#cb67-30" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span> </span>
<span id="cb67-31"><a href="strat.html#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb67-32"><a href="strat.html#cb67-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb67-33"><a href="strat.html#cb67-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),<span class="at">plot_tot =</span> <span class="fu">as.integer</span>(freq<span class="sc">*</span>ns))</span>
<span id="cb67-34"><a href="strat.html#cb67-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-35"><a href="strat.html#cb67-35" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb67-36"><a href="strat.html#cb67-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb67-37"><a href="strat.html#cb67-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups_m) <span class="sc">%&gt;%</span></span>
<span id="cb67-38"><a href="strat.html#cb67-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb67-39"><a href="strat.html#cb67-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-40"><a href="strat.html#cb67-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> samples<span class="sc">$</span>plot_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb67-41"><a href="strat.html#cb67-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samp =</span> <span class="fu">map2</span>(data, n, sample_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-42"><a href="strat.html#cb67-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb67-43"><a href="strat.html#cb67-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(samp)</span>
<span id="cb67-44"><a href="strat.html#cb67-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-45"><a href="strat.html#cb67-45" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(samp, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb67-46"><a href="strat.html#cb67-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-47"><a href="strat.html#cb67-47" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly_roads<span class="sc">$</span>avg)</span>
<span id="cb67-48"><a href="strat.html#cb67-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="strat.html#cb68-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>avg,<span class="at">y=</span>std))<span class="sc">+</span></span>
<span id="cb68-2"><a href="strat.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> o_val, <span class="fu">aes</span>(<span class="at">color =</span> groups_m))<span class="sc">+</span></span>
<span id="cb68-3"><a href="strat.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> samp, <span class="at">pch=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb68-4"><a href="strat.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-5"><a href="strat.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb68-6"><a href="strat.html#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-7"><a href="strat.html#cb68-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb68-8"><a href="strat.html#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="strat.html#cb68-9" aria-hidden="true" tabindex="-1"></a>coordsgrps <span class="ot">&lt;-</span> o_val <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="strat.html#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(groups_m) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="strat.html#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(groups_m) <span class="sc">%&gt;%</span></span>
<span id="cb68-12"><a href="strat.html#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span>            </span>
<span id="cb68-13"><a href="strat.html#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb68-14"><a href="strat.html#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="strat.html#cb68-15" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">1</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-16"><a href="strat.html#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">2</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-17"><a href="strat.html#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">3</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-18"><a href="strat.html#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">4</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-19"><a href="strat.html#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">5</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-20"><a href="strat.html#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">6</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-21"><a href="strat.html#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">7</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-22"><a href="strat.html#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">8</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-23"><a href="strat.html#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">9</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-24"><a href="strat.html#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">10</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-25"><a href="strat.html#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">11</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb68-26"><a href="strat.html#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data=</span>coordsgrps<span class="sc">$</span>data[[<span class="dv">12</span>]],<span class="fu">aes</span>(<span class="at">xmin=</span><span class="fu">min</span>(avg),<span class="at">xmax=</span><span class="fu">max</span>(avg),<span class="at">ymin=</span><span class="fu">min</span>(std),<span class="at">ymax=</span><span class="fu">max</span>(std)),<span class="at">colour=</span><span class="st">&quot;black&quot;</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-47-2.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="strat.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dataframe back to raster to show classes</span></span>
<span id="cb69-2"><a href="strat.html#cb69-2" aria-hidden="true" tabindex="-1"></a>spg <span class="ot">&lt;-</span> o_val</span>
<span id="cb69-3"><a href="strat.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(spg) <span class="ot">&lt;-</span> <span class="er">~</span> x <span class="sc">+</span> y</span>
<span id="cb69-4"><a href="strat.html#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="strat.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce to SpatialPixelsDataFrame</span></span>
<span id="cb69-6"><a href="strat.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(spg) <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb69-7"><a href="strat.html#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="strat.html#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co"># coerce to raster</span></span>
<span id="cb69-9"><a href="strat.html#cb69-9" aria-hidden="true" tabindex="-1"></a>rasterDF <span class="ot">&lt;-</span> <span class="fu">raster</span>(spg, <span class="st">&quot;id&quot;</span>)</span>
<span id="cb69-10"><a href="strat.html#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="strat.html#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb69-12"><a href="strat.html#cb69-12" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">name =</span> <span class="st">&quot;Spectral&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in brewer.pal(n = 12, name = &quot;Spectral&quot;): n too large, allowed maximum for palette Spectral is 11
## Returning the palette you asked for with that many colors</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="strat.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rasterDF,<span class="at">col=</span>pal)</span>
<span id="cb71-2"><a href="strat.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
</div>
<div id="non-stratified-sampling-methods" class="section level2 unnumbered">
<h2>Non-stratified sampling methods</h2>
<p>Some sampling methods such as the BalancedSampling approaches and Latin Hypercube Sampling do not require prior stratification. In order to sample these we present these methods on only candidate samples within the road buffer subsets.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="strat.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#prepare data</span></span>
<span id="cb72-2"><a href="strat.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb72-3"><a href="strat.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="strat.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract values for Kmeans</span></span>
<span id="cb72-5"><a href="strat.html#cb72-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> rast_dt</span>
<span id="cb72-6"><a href="strat.html#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="strat.html#cb72-7" aria-hidden="true" tabindex="-1"></a>o_val <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="strat.html#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb72-9"><a href="strat.html#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<div id="balanced-sampling" class="section level3 unnumbered">
<h3>Balanced Sampling</h3>
<p><span class="citation">(<a href="#ref-Grafstrom2013" role="doc-biblioref">Grafström and Ringvall 2013</a>)</span> described the <span class="citation">(<a href="#ref-R-BalancedSampling" role="doc-biblioref">Grafström and Lisic 2019</a>)</span> package, which implements a number of sampling methods that balance samples spatially and within auxilary variable space. The spatial balance is important given that we</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="strat.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BalancedSampling)</span>
<span id="cb73-2"><a href="strat.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1</span></span>
<span id="cb73-3"><a href="strat.html#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="strat.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>);</span>
<span id="cb73-5"><a href="strat.html#cb73-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">nrow</span>(o_val); <span class="co"># population size</span></span>
<span id="cb73-6"><a href="strat.html#cb73-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">200</span>; <span class="co"># sample size</span></span>
<span id="cb73-7"><a href="strat.html#cb73-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">rep</span>(n<span class="sc">/</span>N,N);<span class="co"># inclusion probabilities</span></span>
<span id="cb73-8"><a href="strat.html#cb73-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(o_val) <span class="co"># matrix of auxiliary variables</span></span>
<span id="cb73-9"><a href="strat.html#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="strat.html#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="strat.html#cb73-11" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">=</span> <span class="fu">lpm1</span>(p,X); <span class="co"># select sample </span></span>
<span id="cb73-12"><a href="strat.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">3</span>],X[,<span class="dv">5</span>]); <span class="co"># plot population</span></span>
<span id="cb73-13"><a href="strat.html#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s1,<span class="dv">3</span>],X[s1,<span class="dv">5</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="strat.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">1</span>],X[,<span class="dv">2</span>]); <span class="co"># plot population</span></span>
<span id="cb74-2"><a href="strat.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s1,<span class="dv">1</span>],X[s1,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-2.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="strat.html#cb75-1" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">=</span> <span class="fu">lpm2</span>(p,X); <span class="co"># select sample </span></span>
<span id="cb75-2"><a href="strat.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">3</span>],X[,<span class="dv">5</span>]); <span class="co"># plot population</span></span>
<span id="cb75-3"><a href="strat.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s2,<span class="dv">3</span>],X[s2,<span class="dv">5</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-3.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="strat.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">1</span>],X[,<span class="dv">2</span>]); <span class="co"># plot population</span></span>
<span id="cb76-2"><a href="strat.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s2,<span class="dv">1</span>],X[s2,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-4.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="strat.html#cb77-1" aria-hidden="true" tabindex="-1"></a>s3 <span class="ot">=</span> <span class="fu">lcube</span>(p,X,<span class="fu">cbind</span>(p));</span>
<span id="cb77-2"><a href="strat.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">1</span>],X[,<span class="dv">2</span>]); <span class="co"># plot population</span></span>
<span id="cb77-3"><a href="strat.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s3,<span class="dv">1</span>],X[s3,<span class="dv">2</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-5.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="strat.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[,<span class="dv">3</span>],X[,<span class="dv">5</span>]); <span class="co"># plot population</span></span>
<span id="cb78-2"><a href="strat.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(X[s3,<span class="dv">3</span>],X[s3,<span class="dv">5</span>], <span class="at">pch=</span><span class="dv">19</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>); <span class="co"># plot sample</span></span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-50-6.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="strat.html#cb79-1" aria-hidden="true" tabindex="-1"></a>sampls1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X[s1,]) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">alg =</span> <span class="st">&quot;lmp1&quot;</span>)</span>
<span id="cb79-2"><a href="strat.html#cb79-2" aria-hidden="true" tabindex="-1"></a>sampls2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X[s2,]) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">alg =</span> <span class="st">&quot;lmp2&quot;</span>)</span>
<span id="cb79-3"><a href="strat.html#cb79-3" aria-hidden="true" tabindex="-1"></a>sampls3 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X[s3,]) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">alg =</span> <span class="st">&quot;lcube&quot;</span>)</span>
<span id="cb79-4"><a href="strat.html#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="strat.html#cb79-5" aria-hidden="true" tabindex="-1"></a>samps <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sampls1,sampls2,sampls3)</span>
<span id="cb79-6"><a href="strat.html#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="strat.html#cb79-7" aria-hidden="true" tabindex="-1"></a>samps <span class="sc">%&gt;%</span> </span>
<span id="cb79-8"><a href="strat.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(alg) <span class="sc">%&gt;%</span></span>
<span id="cb79-9"><a href="strat.html#cb79-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(avg) <span class="sc">%&gt;%</span> </span>
<span id="cb79-10"><a href="strat.html#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb79-11"><a href="strat.html#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb79-12"><a href="strat.html#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb79-13"><a href="strat.html#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb79-14"><a href="strat.html#cb79-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   alg       n  mean    sd
##   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 lcube   200  8.26  4.32
## 2 lmp1    200  8.26  4.51
## 3 lmp2    200  8.22  4.50</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="strat.html#cb81-1" aria-hidden="true" tabindex="-1"></a>o_val <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(avg) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb81-2"><a href="strat.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb81-3"><a href="strat.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(avg),</span>
<span id="cb81-4"><a href="strat.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fu">sd</span>(avg)</span>
<span id="cb81-5"><a href="strat.html#cb81-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##       n     mean       sd
## 1 29902 8.396322 4.395713</code></pre>
</div>
<div id="lhs" class="section level3 unnumbered">
<h3>Latin Hypercube Sampling</h3>
<p>There are a number of different approaches to take with Latin Hypercube Sampling. The following code was derived from <span class="citation">(<a href="#ref-Malone2019" role="doc-biblioref">Malone, Minansy, and Brungard 2019</a>)</span>, who present a method to boostrap sample number for hypercube sampling, followed by a few testing options to determine optimal sample numbers. This code was provided by the authors at <a href="https://bitbucket.org/brendo1001/clhc_sampling/downloads/" class="uri">https://bitbucket.org/brendo1001/clhc_sampling/downloads/</a> which i have manipulated to work with our dataset.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="strat.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb83-2"><a href="strat.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data analysis for the population data</span></span>
<span id="cb83-3"><a href="strat.html#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="strat.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Principal components of the population (the is for tests 1 and 2)</span></span>
<span id="cb83-5"><a href="strat.html#cb83-5" aria-hidden="true" tabindex="-1"></a>pca1 <span class="ot">=</span> <span class="fu">prcomp</span>(df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>],<span class="at">scale=</span><span class="cn">TRUE</span>, <span class="at">center=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-6"><a href="strat.html#cb83-6" aria-hidden="true" tabindex="-1"></a>scores_pca1 <span class="ot">=</span> <span class="fu">as.data.frame</span>(pca1<span class="sc">$</span>x)</span>
<span id="cb83-7"><a href="strat.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(pca1) <span class="do">## plot the variances explained by each component</span></span>
<span id="cb83-8"><a href="strat.html#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(pca1)</span>
<span id="cb83-9"><a href="strat.html#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca1)</span>
<span id="cb83-10"><a href="strat.html#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="strat.html#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="co"># retreive the loadings</span></span>
<span id="cb83-12"><a href="strat.html#cb83-12" aria-hidden="true" tabindex="-1"></a>pca1.load<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">nrow=</span><span class="dv">4</span> )</span>
<span id="cb83-13"><a href="strat.html#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb83-14"><a href="strat.html#cb83-14" aria-hidden="true" tabindex="-1"></a>  pca1.load[i,]<span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">t</span>(pca1<span class="sc">$</span>rotation[i,]))}</span>
<span id="cb83-15"><a href="strat.html#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="strat.html#cb83-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-17"><a href="strat.html#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Quantiles of the population (this is for test 3)</span></span>
<span id="cb83-18"><a href="strat.html#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of bins</span></span>
<span id="cb83-19"><a href="strat.html#cb83-19" aria-hidden="true" tabindex="-1"></a>nb<span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb83-20"><a href="strat.html#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="strat.html#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="co">#quantile matrix (of the covariate data)</span></span>
<span id="cb83-22"><a href="strat.html#cb83-22" aria-hidden="true" tabindex="-1"></a>q.mat<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>(nb<span class="sc">+</span><span class="dv">1</span>), <span class="at">ncol=</span> <span class="dv">4</span>)</span>
<span id="cb83-23"><a href="strat.html#cb83-23" aria-hidden="true" tabindex="-1"></a>j<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb83-24"><a href="strat.html#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(df)){ <span class="co">#note the index start here</span></span>
<span id="cb83-25"><a href="strat.html#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get a quantile matrix together of the covariates</span></span>
<span id="cb83-26"><a href="strat.html#cb83-26" aria-hidden="true" tabindex="-1"></a>  ran1<span class="ot">&lt;-</span> <span class="fu">max</span>(df[,i]) <span class="sc">-</span> <span class="fu">min</span>(df[,i])</span>
<span id="cb83-27"><a href="strat.html#cb83-27" aria-hidden="true" tabindex="-1"></a>  step1<span class="ot">&lt;-</span> ran1<span class="sc">/</span>nb </span>
<span id="cb83-28"><a href="strat.html#cb83-28" aria-hidden="true" tabindex="-1"></a>  q.mat[,j]<span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df[,i]), <span class="at">to =</span> <span class="fu">max</span>(df[,i]), <span class="at">by =</span>step1)</span>
<span id="cb83-29"><a href="strat.html#cb83-29" aria-hidden="true" tabindex="-1"></a>  j<span class="ot">&lt;-</span> j<span class="sc">+</span><span class="dv">1</span>}</span>
<span id="cb83-30"><a href="strat.html#cb83-30" aria-hidden="true" tabindex="-1"></a>q.mat</span>
<span id="cb83-31"><a href="strat.html#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="strat.html#cb83-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-33"><a href="strat.html#cb83-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-34"><a href="strat.html#cb83-34" aria-hidden="true" tabindex="-1"></a><span class="co">#covariate data hypercube (this is for test 4)</span></span>
<span id="cb83-35"><a href="strat.html#cb83-35" aria-hidden="true" tabindex="-1"></a><span class="do">## This takes a while to do so only do it once if you can </span></span>
<span id="cb83-36"><a href="strat.html#cb83-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-37"><a href="strat.html#cb83-37" aria-hidden="true" tabindex="-1"></a>cov.mat<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nrow=</span>nb, <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb83-38"><a href="strat.html#cb83-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)){ <span class="co"># the number of pixels</span></span>
<span id="cb83-39"><a href="strat.html#cb83-39" aria-hidden="true" tabindex="-1"></a>  cntj<span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb83-40"><a href="strat.html#cb83-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(df)){ <span class="co">#for each column</span></span>
<span id="cb83-41"><a href="strat.html#cb83-41" aria-hidden="true" tabindex="-1"></a>    dd<span class="ot">&lt;-</span> df[i,j]  </span>
<span id="cb83-42"><a href="strat.html#cb83-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb){  <span class="co">#for each quantile</span></span>
<span id="cb83-43"><a href="strat.html#cb83-43" aria-hidden="true" tabindex="-1"></a>      kl<span class="ot">&lt;-</span> q.mat[k, cntj] </span>
<span id="cb83-44"><a href="strat.html#cb83-44" aria-hidden="true" tabindex="-1"></a>      ku<span class="ot">&lt;-</span> q.mat[k<span class="sc">+</span><span class="dv">1</span>, cntj] </span>
<span id="cb83-45"><a href="strat.html#cb83-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (dd <span class="sc">&gt;=</span> kl <span class="sc">&amp;</span> dd <span class="sc">&lt;=</span> ku){cov.mat[k, cntj]<span class="ot">&lt;-</span> cov.mat[k, cntj] <span class="sc">+</span> <span class="dv">1</span>} </span>
<span id="cb83-46"><a href="strat.html#cb83-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-47"><a href="strat.html#cb83-47" aria-hidden="true" tabindex="-1"></a>    cntj<span class="ot">&lt;-</span> cntj<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb83-48"><a href="strat.html#cb83-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-49"><a href="strat.html#cb83-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-50"><a href="strat.html#cb83-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-51"><a href="strat.html#cb83-51" aria-hidden="true" tabindex="-1"></a>cov.mat</span>
<span id="cb83-52"><a href="strat.html#cb83-52" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb83-53"><a href="strat.html#cb83-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-54"><a href="strat.html#cb83-54" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata/roads&quot;</span>,<span class="st">&quot;roads.shp&quot;</span>, <span class="at">package =</span> <span class="st">&quot;RMFinventory&quot;</span>))</span>
<span id="cb83-55"><a href="strat.html#cb83-55" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(roads, wall_crs<span class="sc">@</span>projargs)</span>
<span id="cb83-56"><a href="strat.html#cb83-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-57"><a href="strat.html#cb83-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-58"><a href="strat.html#cb83-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-59"><a href="strat.html#cb83-59" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################################</span></span>
<span id="cb83-60"><a href="strat.html#cb83-60" aria-hidden="true" tabindex="-1"></a><span class="co">#How many samples do we need?</span></span>
<span id="cb83-61"><a href="strat.html#cb83-61" aria-hidden="true" tabindex="-1"></a><span class="co">#beginning of algorithm</span></span>
<span id="cb83-62"><a href="strat.html#cb83-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-63"><a href="strat.html#cb83-63" aria-hidden="true" tabindex="-1"></a><span class="co">#initial settings</span></span>
<span id="cb83-64"><a href="strat.html#cb83-64" aria-hidden="true" tabindex="-1"></a>cseq<span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">500</span>,<span class="dv">10</span>) <span class="co"># cLHC sample size</span></span>
<span id="cb83-65"><a href="strat.html#cb83-65" aria-hidden="true" tabindex="-1"></a>its<span class="ot">&lt;-</span><span class="dv">10</span>  <span class="co"># number internal iterations with each sample size number</span></span>
<span id="cb83-66"><a href="strat.html#cb83-66" aria-hidden="true" tabindex="-1"></a>mat.seq<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">ncol=</span><span class="dv">8</span>,<span class="at">nrow=</span><span class="fu">length</span>(cseq)) <span class="co">#empty matix for outputs</span></span>
<span id="cb83-67"><a href="strat.html#cb83-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-68"><a href="strat.html#cb83-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-69"><a href="strat.html#cb83-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cseq)){ <span class="co"># for every sample number configuration....</span></span>
<span id="cb83-70"><a href="strat.html#cb83-70" aria-hidden="true" tabindex="-1"></a>  s.size<span class="ot">=</span>cseq[w]  <span class="co"># sample size</span></span>
<span id="cb83-71"><a href="strat.html#cb83-71" aria-hidden="true" tabindex="-1"></a>  mat.f<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">ncol=</span><span class="dv">8</span>,<span class="at">nrow=</span>its ) <span class="co"># placement for iteration outputs</span></span>
<span id="cb83-72"><a href="strat.html#cb83-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-73"><a href="strat.html#cb83-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#internal loop</span></span>
<span id="cb83-74"><a href="strat.html#cb83-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>its){ <span class="co">#Note that this takes quite a while to run to completion</span></span>
<span id="cb83-75"><a href="strat.html#cb83-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">repeat</span>{</span>
<span id="cb83-76"><a href="strat.html#cb83-76" aria-hidden="true" tabindex="-1"></a>      ss <span class="ot">&lt;-</span> <span class="fu">clhs</span>(df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>], <span class="at">size =</span> s.size, <span class="at">progress =</span> T, <span class="at">iter =</span> <span class="dv">100</span>) <span class="co"># Do a conditioned latin hypercube sample</span></span>
<span id="cb83-77"><a href="strat.html#cb83-77" aria-hidden="true" tabindex="-1"></a>      s.df<span class="ot">&lt;-</span> df[ss,]</span>
<span id="cb83-78"><a href="strat.html#cb83-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">duplicated</span>(s.df) <span class="sc">|</span> <span class="fu">duplicated</span>(s.df[<span class="fu">nrow</span>(s.df)<span class="sc">:</span><span class="dv">1</span>, ])[<span class="fu">nrow</span>(s.df)<span class="sc">:</span><span class="dv">1</span>]) <span class="sc">&lt;</span> <span class="dv">2</span>)</span>
<span id="cb83-79"><a href="strat.html#cb83-79" aria-hidden="true" tabindex="-1"></a>        {<span class="cf">break</span>}}</span>
<span id="cb83-80"><a href="strat.html#cb83-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-81"><a href="strat.html#cb83-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">#principal component of sample</span></span>
<span id="cb83-82"><a href="strat.html#cb83-82" aria-hidden="true" tabindex="-1"></a>    pca.s <span class="ot">=</span> <span class="fu">prcomp</span>(s.df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>],<span class="at">scale=</span><span class="cn">TRUE</span>, <span class="at">center=</span><span class="cn">TRUE</span>)</span>
<span id="cb83-83"><a href="strat.html#cb83-83" aria-hidden="true" tabindex="-1"></a>    scores_pca1 <span class="ot">=</span> <span class="fu">as.data.frame</span>(pca.s<span class="sc">$</span>x)</span>
<span id="cb83-84"><a href="strat.html#cb83-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-85"><a href="strat.html#cb83-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the first 2 principal components and convex hull </span></span>
<span id="cb83-86"><a href="strat.html#cb83-86" aria-hidden="true" tabindex="-1"></a>    rand.tr<span class="ot">&lt;-</span><span class="fu">tri.mesh</span>(scores_pca1[,<span class="dv">1</span>],scores_pca1[,<span class="dv">2</span>])</span>
<span id="cb83-87"><a href="strat.html#cb83-87" aria-hidden="true" tabindex="-1"></a>    rand.ch<span class="ot">&lt;-</span><span class="fu">convex.hull</span>(rand.tr, <span class="at">plot.it=</span>F) <span class="co">#convex hull</span></span>
<span id="cb83-88"><a href="strat.html#cb83-88" aria-hidden="true" tabindex="-1"></a>    pr_poly <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">x=</span><span class="fu">c</span>(rand.ch<span class="sc">$</span>x),<span class="at">y=</span><span class="fu">c</span>(rand.ch<span class="sc">$</span>y)) <span class="co"># save the convext hull vertices</span></span>
<span id="cb83-89"><a href="strat.html#cb83-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot(scores_pca1[,1], scores_pca1[,2], xlab=&quot;PCA 1&quot;, ylab=&quot;PCA 2&quot;, xlim=c(min(scores_pca1[,1:2]), max(scores_pca1[,1:2])),ylim=c(min(scores_pca1[,1:2]), max(scores_pca1[,1:2])))</span></span>
<span id="cb83-90"><a href="strat.html#cb83-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">#lines(c(rand.ch$x,rand.ch$x[1]), c(rand.ch$y,rand.ch$y[1]),col=&quot;red&quot;,lwd=1) # draw the convex hull(domain of prediction)</span></span>
<span id="cb83-91"><a href="strat.html#cb83-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-92"><a href="strat.html#cb83-92" aria-hidden="true" tabindex="-1"></a>    <span class="do">#### First Test:</span></span>
<span id="cb83-93"><a href="strat.html#cb83-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">#points in polygons routine</span></span>
<span id="cb83-94"><a href="strat.html#cb83-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PCA prjection</span></span>
<span id="cb83-95"><a href="strat.html#cb83-95" aria-hidden="true" tabindex="-1"></a>    PCA_projection<span class="ot">&lt;-</span> <span class="fu">predict</span>(pca.s, df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>]) <span class="co"># Project population onto sample PC</span></span>
<span id="cb83-96"><a href="strat.html#cb83-96" aria-hidden="true" tabindex="-1"></a>    newScores <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">x=</span>PCA_projection[,<span class="dv">1</span>],<span class="at">y=</span>PCA_projection[,<span class="dv">2</span>]) <span class="co"># PC scores of projected population</span></span>
<span id="cb83-97"><a href="strat.html#cb83-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-98"><a href="strat.html#cb83-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot the polygon and all points to be checked</span></span>
<span id="cb83-99"><a href="strat.html#cb83-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot(newScores,xlab=&quot;PCA 1&quot;, ylab=&quot;PCA 2&quot;, xlim=c(min(newScores[,1:2]), max(newScores[,1:2])),ylim=c(min(newScores[,1:2]), max(newScores[,1:2])),col=&#39;black&#39;, main=&#39;convex hull of ss&#39;)</span></span>
<span id="cb83-100"><a href="strat.html#cb83-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># polygon(pr_poly,col=&#39;#99999990&#39;)</span></span>
<span id="cb83-101"><a href="strat.html#cb83-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-102"><a href="strat.html#cb83-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">#create check which points fall within the polygon</span></span>
<span id="cb83-103"><a href="strat.html#cb83-103" aria-hidden="true" tabindex="-1"></a>    specMatch <span class="ot">=</span> <span class="fu">pip2d</span>(pr_poly,newScores)</span>
<span id="cb83-104"><a href="strat.html#cb83-104" aria-hidden="true" tabindex="-1"></a>    specMatch <span class="ot">=</span> specMatch <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb83-105"><a href="strat.html#cb83-105" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">7</span>]<span class="ot">&lt;-</span> <span class="fu">sum</span>(specMatch)<span class="sc">/</span><span class="fu">length</span>(specMatch)<span class="sc">*</span><span class="dv">100</span> <span class="co"># propertion of new spectra the fall within the convex hull</span></span>
<span id="cb83-106"><a href="strat.html#cb83-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># points(specMatch[which(specMatch==0),1:2],pch=&#39;X&#39;, col=&#39;red&#39;)</span></span>
<span id="cb83-107"><a href="strat.html#cb83-107" aria-hidden="true" tabindex="-1"></a>    <span class="do">##</span><span class="re">END</span><span class="do"> points in polygons##</span></span>
<span id="cb83-108"><a href="strat.html#cb83-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-109"><a href="strat.html#cb83-109" aria-hidden="true" tabindex="-1"></a>    <span class="do">#### Second Test:</span></span>
<span id="cb83-110"><a href="strat.html#cb83-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">#similarity of the 2 matrices (PCA Similarity Factor; Krzanowski (1979))</span></span>
<span id="cb83-111"><a href="strat.html#cb83-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># retreive the loadings for the samples</span></span>
<span id="cb83-112"><a href="strat.html#cb83-112" aria-hidden="true" tabindex="-1"></a>    pca.s.load<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">nrow=</span><span class="dv">4</span> )</span>
<span id="cb83-113"><a href="strat.html#cb83-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb83-114"><a href="strat.html#cb83-114" aria-hidden="true" tabindex="-1"></a>      pca.s.load[i,]<span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">t</span>(pca.s<span class="sc">$</span>rotation[i,]))</span>
<span id="cb83-115"><a href="strat.html#cb83-115" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-116"><a href="strat.html#cb83-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-117"><a href="strat.html#cb83-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perfrom the Krznowski 1979 calculation</span></span>
<span id="cb83-118"><a href="strat.html#cb83-118" aria-hidden="true" tabindex="-1"></a>    ps1<span class="ot">&lt;-</span> pca1.load[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]  </span>
<span id="cb83-119"><a href="strat.html#cb83-119" aria-hidden="true" tabindex="-1"></a>    ps2<span class="ot">&lt;-</span> pca.s.load[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb83-120"><a href="strat.html#cb83-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-121"><a href="strat.html#cb83-121" aria-hidden="true" tabindex="-1"></a>    ps1.t<span class="ot">&lt;-</span> <span class="fu">t</span>(ps1) <span class="co">#transpose</span></span>
<span id="cb83-122"><a href="strat.html#cb83-122" aria-hidden="true" tabindex="-1"></a>    ps2.t<span class="ot">&lt;-</span> <span class="fu">t</span>(ps2) <span class="co">#transpose</span></span>
<span id="cb83-123"><a href="strat.html#cb83-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-124"><a href="strat.html#cb83-124" aria-hidden="true" tabindex="-1"></a>    S<span class="ot">&lt;-</span> ps1.t <span class="sc">%*%</span> ps2 <span class="sc">%*%</span> ps2.t <span class="sc">%*%</span> ps1</span>
<span id="cb83-125"><a href="strat.html#cb83-125" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">diag</span>(S))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb83-126"><a href="strat.html#cb83-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-127"><a href="strat.html#cb83-127" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Third Test:</span></span>
<span id="cb83-128"><a href="strat.html#cb83-128" aria-hidden="true" tabindex="-1"></a>    <span class="co">#comparison of quantiles</span></span>
<span id="cb83-129"><a href="strat.html#cb83-129" aria-hidden="true" tabindex="-1"></a>    df.q2<span class="fl">.1</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(s.df[,<span class="dv">3</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-130"><a href="strat.html#cb83-130" aria-hidden="true" tabindex="-1"></a>    df.q1<span class="fl">.1</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(df[,<span class="dv">3</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-131"><a href="strat.html#cb83-131" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="fu">sqrt</span>((df.q1<span class="fl">.1</span>[<span class="dv">1</span>]<span class="sc">-</span>df.q2<span class="fl">.1</span>[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.1</span>[<span class="dv">2</span>]<span class="sc">-</span>df.q2<span class="fl">.1</span>[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.1</span>[<span class="dv">3</span>]<span class="sc">-</span>df.q2<span class="fl">.1</span>[<span class="dv">3</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.1</span>[<span class="dv">4</span>]<span class="sc">-</span>df.q2<span class="fl">.1</span>[<span class="dv">4</span>])<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb83-132"><a href="strat.html#cb83-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-133"><a href="strat.html#cb83-133" aria-hidden="true" tabindex="-1"></a>    df.q2<span class="fl">.2</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(s.df[,<span class="dv">4</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-134"><a href="strat.html#cb83-134" aria-hidden="true" tabindex="-1"></a>    df.q1<span class="fl">.2</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(df[,<span class="dv">4</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-135"><a href="strat.html#cb83-135" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">sqrt</span>((df.q1<span class="fl">.2</span>[<span class="dv">1</span>]<span class="sc">-</span>df.q2<span class="fl">.2</span>[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.2</span>[<span class="dv">2</span>]<span class="sc">-</span>df.q2<span class="fl">.2</span>[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.2</span>[<span class="dv">3</span>]<span class="sc">-</span>df.q2<span class="fl">.2</span>[<span class="dv">3</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.2</span>[<span class="dv">4</span>]<span class="sc">-</span>df.q2<span class="fl">.2</span>[<span class="dv">4</span>])<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb83-136"><a href="strat.html#cb83-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-137"><a href="strat.html#cb83-137" aria-hidden="true" tabindex="-1"></a>    df.q2<span class="fl">.3</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(s.df[,<span class="dv">5</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-138"><a href="strat.html#cb83-138" aria-hidden="true" tabindex="-1"></a>    df.q1<span class="fl">.3</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(df[,<span class="dv">5</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-139"><a href="strat.html#cb83-139" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="fu">sqrt</span>((df.q1<span class="fl">.3</span>[<span class="dv">1</span>]<span class="sc">-</span>df.q2<span class="fl">.3</span>[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.3</span>[<span class="dv">2</span>]<span class="sc">-</span>df.q2<span class="fl">.3</span>[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.3</span>[<span class="dv">3</span>]<span class="sc">-</span>df.q2<span class="fl">.3</span>[<span class="dv">3</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.3</span>[<span class="dv">4</span>]<span class="sc">-</span>df.q2<span class="fl">.3</span>[<span class="dv">4</span>])<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb83-140"><a href="strat.html#cb83-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-141"><a href="strat.html#cb83-141" aria-hidden="true" tabindex="-1"></a>    df.q2<span class="fl">.4</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(s.df[,<span class="dv">6</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-142"><a href="strat.html#cb83-142" aria-hidden="true" tabindex="-1"></a>    df.q1<span class="fl">.4</span><span class="ot">&lt;-</span><span class="fu">quantile</span>(df[,<span class="dv">6</span>], <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>),<span class="at">names =</span> F, <span class="at">type =</span> <span class="dv">7</span>)</span>
<span id="cb83-143"><a href="strat.html#cb83-143" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="fu">sqrt</span>((df.q1<span class="fl">.4</span>[<span class="dv">1</span>]<span class="sc">-</span>df.q2<span class="fl">.4</span>[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.4</span>[<span class="dv">2</span>]<span class="sc">-</span>df.q2<span class="fl">.4</span>[<span class="dv">2</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.4</span>[<span class="dv">3</span>]<span class="sc">-</span>df.q2<span class="fl">.4</span>[<span class="dv">3</span>])<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (df.q1<span class="fl">.4</span>[<span class="dv">4</span>]<span class="sc">-</span>df.q2<span class="fl">.4</span>[<span class="dv">4</span>])<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb83-144"><a href="strat.html#cb83-144" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="fu">mean</span>(mat.f[j,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="co"># take the mean distance</span></span>
<span id="cb83-145"><a href="strat.html#cb83-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-146"><a href="strat.html#cb83-146" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fourth test: Kullback-Leibler (KL) divergence</span></span>
<span id="cb83-147"><a href="strat.html#cb83-147" aria-hidden="true" tabindex="-1"></a>    <span class="do">####Compare whole study area covariate space with the selected sample</span></span>
<span id="cb83-148"><a href="strat.html#cb83-148" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sample data hypercube (essentially the same script as for the grid data but just doing it on the sample data)</span></span>
<span id="cb83-149"><a href="strat.html#cb83-149" aria-hidden="true" tabindex="-1"></a>    h.mat<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nrow=</span>nb, <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb83-150"><a href="strat.html#cb83-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-151"><a href="strat.html#cb83-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(s.df)){ <span class="co"># the number of observations</span></span>
<span id="cb83-152"><a href="strat.html#cb83-152" aria-hidden="true" tabindex="-1"></a>      cntj<span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb83-153"><a href="strat.html#cb83-153" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(s.df)){ <span class="co">#for each column</span></span>
<span id="cb83-154"><a href="strat.html#cb83-154" aria-hidden="true" tabindex="-1"></a>        dd<span class="ot">&lt;-</span> s.df[ii,jj]  </span>
<span id="cb83-155"><a href="strat.html#cb83-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (kk <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb){  <span class="co">#for each quantile</span></span>
<span id="cb83-156"><a href="strat.html#cb83-156" aria-hidden="true" tabindex="-1"></a>          kl<span class="ot">&lt;-</span> q.mat[kk, cntj] </span>
<span id="cb83-157"><a href="strat.html#cb83-157" aria-hidden="true" tabindex="-1"></a>          ku<span class="ot">&lt;-</span> q.mat[kk<span class="sc">+</span><span class="dv">1</span>, cntj] </span>
<span id="cb83-158"><a href="strat.html#cb83-158" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (dd <span class="sc">&gt;=</span> kl <span class="sc">&amp;</span> dd <span class="sc">&lt;=</span> ku){h.mat[kk, cntj]<span class="ot">&lt;-</span> h.mat[kk, cntj] <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb83-159"><a href="strat.html#cb83-159" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb83-160"><a href="strat.html#cb83-160" aria-hidden="true" tabindex="-1"></a>        cntj<span class="ot">&lt;-</span> cntj<span class="sc">+</span><span class="dv">1</span>}}</span>
<span id="cb83-161"><a href="strat.html#cb83-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-162"><a href="strat.html#cb83-162" aria-hidden="true" tabindex="-1"></a>    <span class="co">#h.mat </span></span>
<span id="cb83-163"><a href="strat.html#cb83-163" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Kullback-Leibler (KL) divergence</span></span>
<span id="cb83-164"><a href="strat.html#cb83-164" aria-hidden="true" tabindex="-1"></a>    klo<span class="fl">.1</span><span class="ot">&lt;-</span> <span class="fu">KL.empirical</span>(<span class="fu">c</span>(cov.mat[,<span class="dv">1</span>]), <span class="fu">c</span>(h.mat[,<span class="dv">1</span>])) <span class="co">#1</span></span>
<span id="cb83-165"><a href="strat.html#cb83-165" aria-hidden="true" tabindex="-1"></a>    klo<span class="fl">.2</span><span class="ot">&lt;-</span> <span class="fu">KL.empirical</span>(<span class="fu">c</span>(cov.mat[,<span class="dv">2</span>]), <span class="fu">c</span>(h.mat[,<span class="dv">2</span>])) <span class="co">#2</span></span>
<span id="cb83-166"><a href="strat.html#cb83-166" aria-hidden="true" tabindex="-1"></a>    klo<span class="fl">.3</span><span class="ot">&lt;-</span> <span class="fu">KL.empirical</span>(<span class="fu">c</span>(cov.mat[,<span class="dv">3</span>]), <span class="fu">c</span>(h.mat[,<span class="dv">3</span>])) <span class="co">#3</span></span>
<span id="cb83-167"><a href="strat.html#cb83-167" aria-hidden="true" tabindex="-1"></a>    klo<span class="fl">.4</span><span class="ot">&lt;-</span> <span class="fu">KL.empirical</span>(<span class="fu">c</span>(cov.mat[,<span class="dv">4</span>]), <span class="fu">c</span>(h.mat[,<span class="dv">4</span>])) <span class="co">#4</span></span>
<span id="cb83-168"><a href="strat.html#cb83-168" aria-hidden="true" tabindex="-1"></a>    klo<span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(klo<span class="fl">.1</span>, klo<span class="fl">.2</span>,klo<span class="fl">.3</span>,klo<span class="fl">.4</span>))</span>
<span id="cb83-169"><a href="strat.html#cb83-169" aria-hidden="true" tabindex="-1"></a>    mat.f[j,<span class="dv">8</span>]<span class="ot">&lt;-</span> klo  <span class="co"># value of 0 means no divergence</span></span>
<span id="cb83-170"><a href="strat.html#cb83-170" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb83-171"><a href="strat.html#cb83-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-172"><a href="strat.html#cb83-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-173"><a href="strat.html#cb83-173" aria-hidden="true" tabindex="-1"></a>  <span class="co">#arrange outputs</span></span>
<span id="cb83-174"><a href="strat.html#cb83-174" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">mean</span>(mat.f[,<span class="dv">6</span>])</span>
<span id="cb83-175"><a href="strat.html#cb83-175" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="fu">sd</span>(mat.f[,<span class="dv">6</span>])</span>
<span id="cb83-176"><a href="strat.html#cb83-176" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">min</span>(mat.f[,<span class="dv">1</span>])</span>
<span id="cb83-177"><a href="strat.html#cb83-177" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="fu">max</span>(mat.f[,<span class="dv">1</span>])</span>
<span id="cb83-178"><a href="strat.html#cb83-178" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="fu">mean</span>(mat.f[,<span class="dv">7</span>])</span>
<span id="cb83-179"><a href="strat.html#cb83-179" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="fu">sd</span>(mat.f[,<span class="dv">7</span>])</span>
<span id="cb83-180"><a href="strat.html#cb83-180" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">7</span>]<span class="ot">&lt;-</span><span class="fu">mean</span>(mat.f[,<span class="dv">8</span>])</span>
<span id="cb83-181"><a href="strat.html#cb83-181" aria-hidden="true" tabindex="-1"></a>  mat.seq[w,<span class="dv">8</span>]<span class="ot">&lt;-</span><span class="fu">sd</span>(mat.f[,<span class="dv">8</span>])</span>
<span id="cb83-182"><a href="strat.html#cb83-182" aria-hidden="true" tabindex="-1"></a>  } <span class="do">## </span><span class="re">END</span><span class="do"> of LOOP</span></span>
<span id="cb83-183"><a href="strat.html#cb83-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-184"><a href="strat.html#cb83-184" aria-hidden="true" tabindex="-1"></a>  dat.seq<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(cseq,mat.seq))</span>
<span id="cb83-185"><a href="strat.html#cb83-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat.seq)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;samp_nos&quot;</span>, <span class="st">&quot;mean_dist&quot;</span>,<span class="st">&quot;sd_dist&quot;</span>, <span class="st">&quot;min_S&quot;</span>, <span class="st">&quot;max_S&quot;</span>, <span class="st">&quot;mean_PIP&quot;</span>,<span class="st">&quot;sd_PIP&quot;</span>, <span class="st">&quot;mean_KL&quot;</span>,<span class="st">&quot;sd_KL&quot;</span>)</span>
<span id="cb83-186"><a href="strat.html#cb83-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-187"><a href="strat.html#cb83-187" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################</span></span></code></pre></div>
<p>After the loop has finished we are able to plot the ouputs of the bootstrapping to outline how the sample size influenced the deviation of population and sample statistics.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="strat.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################################  </span></span>
<span id="cb84-2"><a href="strat.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot some outputs</span></span>
<span id="cb84-3"><a href="strat.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">1</span>], <span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;similarity between covariates (entire field) with covariates (sample)&quot;</span>,<span class="at">main=</span><span class="st">&quot;Population and sample similarity&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="strat.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">2</span>],<span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;standard deviation similarity between covariates (entire field) with covariates (sample)&quot;</span>,<span class="at">main=</span><span class="st">&quot;Population and sample similarity (sd)&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-2.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="strat.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">3</span>])</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-3.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="strat.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">4</span>])</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-4.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="strat.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">5</span>],<span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;percentage of total covariate variance of population account for in sample&quot;</span>,<span class="at">main=</span><span class="st">&quot;Population and sample similarity&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-5.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="strat.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">6</span>],<span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;standard deviation of percentage of total covariate variance of population account for in sample&quot;</span>,<span class="at">main=</span><span class="st">&quot;Population and sample similarity&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-6.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="strat.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">7</span>],<span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;KL divergence&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-7.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="strat.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cseq,mat.seq[,<span class="dv">8</span>],<span class="at">xlab=</span><span class="st">&quot;number of samples&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;standard deviation of percentage of total covariate variance of population account for in sample&quot;</span>,<span class="at">main=</span><span class="st">&quot;Population and sample similarity&quot;</span>)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-53-8.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="strat.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################</span></span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="strat.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################################</span></span>
<span id="cb93-2"><a href="strat.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># make an exponetial decay function (of the KL divergence)</span></span>
<span id="cb93-3"><a href="strat.html#cb93-3" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span> dat.seq<span class="sc">$</span>samp_nos</span>
<span id="cb93-4"><a href="strat.html#cb93-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span> (dat.seq<span class="sc">$</span>mean_PIP<span class="sc">-</span><span class="fu">min</span>(dat.seq<span class="sc">$</span>mean_PIP))<span class="sc">/</span>(<span class="fu">max</span>(dat.seq<span class="sc">$</span>mean_PIP)<span class="sc">-</span><span class="fu">min</span>(dat.seq<span class="sc">$</span>mean_PIP)) <span class="co">#PIP</span></span>
<span id="cb93-5"><a href="strat.html#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="strat.html#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="strat.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Parametise Exponential decay function</span></span>
<span id="cb93-8"><a href="strat.html#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;sample number&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;1 - PC similarity&quot;</span>)          <span class="co"># Initial plot of the data</span></span>
<span id="cb93-9"><a href="strat.html#cb93-9" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">list</span>()     <span class="co"># Initialize an empty list for the starting values</span></span>
<span id="cb93-10"><a href="strat.html#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="strat.html#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co">#fit 1</span></span>
<span id="cb93-12"><a href="strat.html#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="fu">manipulate</span>(</span>
<span id="cb93-13"><a href="strat.html#cb93-13" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb93-14"><a href="strat.html#cb93-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, y)</span>
<span id="cb93-15"><a href="strat.html#cb93-15" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> kk; b0 <span class="ot">&lt;-</span> b00; b1 <span class="ot">&lt;-</span> b10</span>
<span id="cb93-16"><a href="strat.html#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(k<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>b1<span class="sc">*</span>x) <span class="sc">+</span> b0, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb93-17"><a href="strat.html#cb93-17" aria-hidden="true" tabindex="-1"></a>  start <span class="ot">&lt;&lt;-</span> <span class="fu">list</span>(<span class="at">k=</span>k, <span class="at">b0=</span>b0, <span class="at">b1=</span>b1)</span>
<span id="cb93-18"><a href="strat.html#cb93-18" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb93-19"><a href="strat.html#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="at">kk=</span><span class="fu">slider</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">step =</span> <span class="fl">0.01</span>,  <span class="at">initial =</span> <span class="dv">2</span>),</span>
<span id="cb93-20"><a href="strat.html#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="at">b10=</span><span class="fu">slider</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">step =</span> <span class="fl">0.000001</span>, <span class="at">initial =</span> <span class="fl">0.01</span>),</span>
<span id="cb93-21"><a href="strat.html#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="at">b00=</span><span class="fu">slider</span>(<span class="dv">0</span>,<span class="dv">1</span> , <span class="at">step=</span><span class="fl">0.000001</span>,<span class="at">initial=</span> <span class="fl">0.01</span>))</span>
<span id="cb93-22"><a href="strat.html#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="strat.html#cb93-23" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">nls</span>(y <span class="sc">~</span> k<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>b1<span class="sc">*</span>x) <span class="sc">+</span> b0, <span class="at">start =</span> start)</span>
<span id="cb93-24"><a href="strat.html#cb93-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1) </span>
<span id="cb93-25"><a href="strat.html#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">fitted</span>(fit1), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="img/fitted.png" width="484" /></p>
<p>After determining the disparity between samples and population we can optimize the number of samples we use based on the cumulative frequency distribution. We determined that the optimum number of samples was 119.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="strat.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply fit</span></span>
<span id="cb94-2"><a href="strat.html#cb94-2" aria-hidden="true" tabindex="-1"></a>xx<span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">500</span>,<span class="dv">1</span>)</span>
<span id="cb94-3"><a href="strat.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx, <span class="fu">predict</span>(fit1,<span class="fu">list</span>(<span class="at">x=</span>xx)))</span>
<span id="cb94-4"><a href="strat.html#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="strat.html#cb94-5" aria-hidden="true" tabindex="-1"></a>jj<span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1,<span class="fu">list</span>(<span class="at">x=</span>xx))</span>
<span id="cb94-6"><a href="strat.html#cb94-6" aria-hidden="true" tabindex="-1"></a>normalized <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span> (jj<span class="sc">-</span><span class="fu">min</span>(jj))<span class="sc">/</span>(<span class="fu">max</span>(jj)<span class="sc">-</span><span class="fu">min</span>(jj))</span>
<span id="cb94-7"><a href="strat.html#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="strat.html#cb94-8" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span> xx</span>
<span id="cb94-9"><a href="strat.html#cb94-9" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span> normalized</span>
<span id="cb94-10"><a href="strat.html#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="strat.html#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;sample number&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;normalised PIP&quot;</span>, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)          <span class="co"># Initial plot of the data</span></span>
<span id="cb94-12"><a href="strat.html#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="strat.html#cb94-13" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">500</span>)</span>
<span id="cb94-14"><a href="strat.html#cb94-14" aria-hidden="true" tabindex="-1"></a>y1<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.95</span>)</span>
<span id="cb94-15"><a href="strat.html#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x1,y1, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb94-16"><a href="strat.html#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="strat.html#cb94-17" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(xx,normalized) <span class="sc">%&gt;%</span> </span>
<span id="cb94-18"><a href="strat.html#cb94-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(<span class="fu">abs</span>(normalized <span class="sc">-</span> <span class="fl">0.95</span>) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(normalized <span class="sc">-</span> <span class="fl">0.95</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb94-19"><a href="strat.html#cb94-19" aria-hidden="true" tabindex="-1"></a>       dplyr<span class="sc">::</span><span class="fu">select</span>(xx) <span class="sc">%&gt;%</span></span>
<span id="cb94-20"><a href="strat.html#cb94-20" aria-hidden="true" tabindex="-1"></a>       <span class="fu">pull</span>()</span>
<span id="cb94-21"><a href="strat.html#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="strat.html#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;your optimum sample size is: &quot;</span>,num)</span>
<span id="cb94-23"><a href="strat.html#cb94-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-24"><a href="strat.html#cb94-24" aria-hidden="true" tabindex="-1"></a>x2<span class="ot">&lt;-</span> <span class="fu">c</span>(num, num); y2<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb94-25"><a href="strat.html#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x2,y2, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb94-26"><a href="strat.html#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################################################</span></span>
<span id="cb94-27"><a href="strat.html#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="strat.html#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="do">##</span><span class="re">END</span></span></code></pre></div>
<p><img src="img/fitted_num.png" width="484" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="strat.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb95-2"><a href="strat.html#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="strat.html#cb95-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> rast_dt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(x,y,avg,std,cov,p99) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb95-4"><a href="strat.html#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="strat.html#cb95-5" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">clhs</span>(df[,<span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>], <span class="at">size =</span> <span class="dv">143</span>, <span class="at">progress =</span> T, <span class="at">iter =</span> <span class="dv">10</span>) <span class="co"># Do a conditioned latin hypercube sample</span></span></code></pre></div>
<pre><code>## 
  |                                                                                                 
  |                                                                                           |   0%
  |                                                                                                 
  |==========                                                                                 |  11%
  |                                                                                                 
  |====================                                                                       |  22%
  |                                                                                                 
  |==============================                                                             |  33%
  |                                                                                                 
  |========================================                                                   |  44%
  |                                                                                                 
  |===================================================                                        |  56%
  |                                                                                                 
  |=============================================================                              |  67%
  |                                                                                                 
  |=======================================================================                    |  78%
  |                                                                                                 
  |=================================================================================          |  89%
  |                                                                                                 
  |===========================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="strat.html#cb97-1" aria-hidden="true" tabindex="-1"></a>s.df<span class="ot">&lt;-</span> df[ss,]</span>
<span id="cb97-2"><a href="strat.html#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="strat.html#cb97-3" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(s.df, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>))</span>
<span id="cb97-4"><a href="strat.html#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="strat.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wall_poly_roads<span class="sc">$</span>avg)</span>
<span id="cb97-6"><a href="strat.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coords),<span class="at">add=</span>T)</span></code></pre></div>
<p><img src="SGS_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>This may look well and good.. But its important to look at WHERE the samples are being located to see if the algorithm was effective. See the image below showing that that we likely need to introduce a spatial aspect to the sampling. Not really sure how to do this just yet…</p>

<style type="text/css">
pre {
  max-height: 300px;
  overflow-y: auto;
}
pre[class] {
  max-height: 100px;
}
</style>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-NbClust" class="csl-entry">
Charrad, Malika, Nadia Ghazzali, Veronique Boiteau, and Azam Niknafs. 2015. <em>NbClust: Determining the Best Number of Clusters in a Data Set</em>. <a href="https://sites.google.com/site/malikacharrad/research/nbclust-package">https://sites.google.com/site/malikacharrad/research/nbclust-package</a>.
</div>
<div id="ref-R-BalancedSampling" class="csl-entry">
Grafström, Anton, and Jonathan Lisic. 2019. <em>BalancedSampling: Balanced and Spatially Balanced Sampling</em>. <a href="http://www.antongrafstrom.se/balancedsampling">http://www.antongrafstrom.se/balancedsampling</a>.
</div>
<div id="ref-Grafstrom2013" class="csl-entry">
Grafström, Anton, and Anna Hedström Ringvall. 2013. <span>“<span class="nocase">Improving forest field inventories by using remote sensing data in novel sampling designs</span>.”</span> <em>Canadian Journal of Forest Research</em> 43 (11): 1015–22. <a href="https://doi.org/10.1139/cjfr-2013-0123">https://doi.org/10.1139/cjfr-2013-0123</a>.
</div>
<div id="ref-Hawbaker2009" class="csl-entry">
Hawbaker, Todd J., Nicholas S. Keuler, Adrian A. Lesak, Terje Gobakken, Kirk Contrucci, and Volker C. Radeloff. 2009. <span>“<span class="nocase">Improved estimates of forest vegetation structure and biomass with a LiDAR-optimized sampling design</span>.”</span> <em>Journal of Geophysical Research: Biogeosciences</em> 114 (3): 1–11. <a href="https://doi.org/10.1029/2008JG000870">https://doi.org/10.1029/2008JG000870</a>.
</div>
<div id="ref-Malone2019" class="csl-entry">
Malone, Brendan P, Budiman Minansy, and Colby Brungard. 2019. <span>“<span class="nocase">Some methods to improve the utility of conditioned Latin hypercube sampling</span>,”</span> 1–17. <a href="https://doi.org/10.7717/peerj.6451">https://doi.org/10.7717/peerj.6451</a>.
</div>
<div id="ref-Maltamo2011" class="csl-entry">
Maltamo, M., O. M. Bollandsås, E. Næsset, T. Gobakken, and P. Packalén. 2011. <span>“<span class="nocase">Different plot selection strategies for field training data in ALS-assisted forest inventory</span>.”</span> <em>Forestry</em> 84 (1): 23–31. <a href="https://doi.org/10.1093/forestry/cpq039">https://doi.org/10.1093/forestry/cpq039</a>.
</div>
<div id="ref-Papa2020" class="csl-entry">
Papa, Daniel de Almeida, Danilo Roberti Alves de Almeida, Carlos Alberto Silva, Evandro Orfanó Figueiredo, Scott C. Stark, Ruben Valbuena, Luiz Carlos Estraviz Rodriguez, and Marcus Vinício Neves d’Oliveira. 2020. <span>“<span class="nocase">Evaluating tropical forest classification and field sampling stratification from lidar to reduce effort and enable landscape monitoring</span>.”</span> <em>Forest Ecology and Management</em> 457 (September 2019). <a href="https://doi.org/10.1016/j.foreco.2019.117634">https://doi.org/10.1016/j.foreco.2019.117634</a>.
</div>
<div id="ref-R-stratifyR" class="csl-entry">
Reddy, Karuna G., and M. G. M. Khan. 2019. <em>stratifyR: Optimal Stratification of Univariate Populations</em>. <a href="https://CRAN.R-project.org/package=stratifyR">https://CRAN.R-project.org/package=stratifyR</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="princomp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="disc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SGS.pdf", "SGS.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
