[["index.html", "Structurally Guided Sampling Overview", " Structurally Guided Sampling Tristan Goodbody 2021-08-20 Overview This document is a current summary and explaination of the structurally guided sampling (sgsR) project being undertaken by Dr. Tristan R.H. Goodbody and Dr. Nicholas C. Coops at the IRSS Lab at the UBC Faculty of Forestry. Herein we provide a: Literature review about SGS Describe package fundamentals Overview of stratification algorithms Overview of sampling algorithms Overview of calculate algorithms To install the package from the github please run the following. install.packages(&quot;devtools&quot;) devtools::install_github(&quot;https://github.com/tgoodbody/sgsR&quot;, build_vignettes = FALSE) library(sgsR) "],["SGS.html", "Structurally Guided Sampling Review Stratification approaches", " Structurally Guided Sampling Review (McRoberts, Gobakken, and Næsset 2012) outline the essence of structurally guided sampling: Stratified estimation is a statistical technique that can be used to increase the precision of estimates without increasing sample sizes. The essence of stratified estimation is to aggregate observations of the response variable into groups or strata that are more homogeneous than the population as a whole. The population mean and its variance are estimated as weighted means ofwithin-strata means and variances where the weights are based on strata sizes. If the stratification is accomplished prior to sampling and the within-stratum variances are known or can be easily estimated, then greater precision may be achieved by selecting within-strata sampling intensities to be proportional to within-strata variances (Cochran, 1977). Following literature review I present a number of implementations that have been used to guide the stratification of ALS-derived structural variables for locating representative sample plots. Studies including (Leiterer et al. 2015) and (Kane et al. 2010) suggest that the information in the ALS data may be condensed to a few metrics. Many of the studies reviewed seem to adopt this by selecting a low number of metrics which they use to stratify the landscape and consequently sample within.(Fedrigo et al. 2018) further outlined: Lidar metrics may be useful for forest stand classification if they differentiate classes of interest (Wulder et al., 2008). The separation of the data into vertical layers allows metrics to be derived for specific forest strata, which may increase the discrimination of multi-strata stand types. The selection of breaks that define these strata can be based on field knowledge or identified statistically from lidar profiles (Lefsky et al., 1999; Zhang et al., 2011). An additional note of interest is that a great deal of research in the field of digital soil mapping can be applied to structurally guided sampling. Studies including (Carré, McBratney, and Minasny 2007), (Ma et al. 2020), and (Malone, Minansy, and Brungard 2019) were invlauable for understanding how to use auxillary variables to determine effective sampling protocols - especially in the context of Lahin Hypercube Sampling. Stratification approaches (Hawbaker et al. 2009) Used ALS mean and SD to stratify. First they separated forest types then 10 strata were derived suing mean height. Within each stratum, 3 additional sub-strata were created using SD. This produced a total of 30 stratifications where one coniferous forest and two deciduous forest locations randomly selected. They compared samples taken from strata with a random sample finding that: &gt;Prediction errors from models constructed using a random sample were up to 68% larger than those from the models built with a stratified sample. The stratified sample included a greater range of variability than the random sample. (Dalponte et al. 2011) They analyzed 2 aspects of ground reference data collection. The positioning error of the ground plots The optimal number of training plots. They had a large collection of samples &gt;700 and systematically analyzed how the reduction of sample numbers influenced accuracy of attribute estimates. They tested the effect of error in estimate related to distance the center point of the plot was moved. The decrease was at a minimum when the displacement was less than 5 m, while it was considerable over 10 m. They did random downsampling of the sample plot number and stratified downsampling of the sample plot number. They used the methods from (Hawbaker et al. 2009) and (Maltamo et al. 2011) for stratified downsampling. Comparing the results obtained with the proposed stratified sampling method and the other three methods considered (see Table 3), one can see that the proposed stratified sampling method was the one that provided the best results for both sets. The new protocol allowed us to obtain promising results for the considered dataset: using only 53 training plots, instead of 534 in the original dataset, we obtained the same results for the validation set. (Maltamo et al. 2011) Used divided P90 into 12 even parts. A near equal number of sample plots were systematically chosen within each of these 12 parts according to the range of VEG (ratio of vegetation points and ground points). To representatively sample the 12 parts and to cover the extremes, selection intensity was higher in the p90 range range with the lowest number of previously established plots. The use of ALS data as a priori information provided the most accurate results. They also provide the an important statement: One should keep in mind that in real world applications ,some given ALS variables will have to be used for selection of plots regardless of which and how many biophysical properties the inventory aims at estimating. Thus, some ALS variables will work better for certain biophysical properties than for others. An appropriate way of choosing suitable ALS variables could be to select them according to the relative importance of the biophysical properties to be estimated.for volume and number of stems. plots. REduced total sample size incrementally. (Junttila et al. 2013) Used a number of approaches including a space filling design, which attempts to sample uniformly across a feature space. The Maximin design attempts to cover a feature space as uniformly as possible given a fixed number of sample points. It maximizes the minimum distance between plots. The results indicate that choosing the plots in a way that ensures ample coverage of both spatial and feature space variability improves the performance of the corresponding models, and that adequate coverage of the variability in the feature space is the most important condition that should be met by the set of plots collected. (Valbuena et al. 2013) Used the Cover metric to privde a idea of the density of each forest area. The justified that cover influenced the relation between other metrics and the forest response and, therefore, it was included in all the models computed. (Grafström and Ringvall 2013) Presents the (Grafström and Lisic 2019) package. and does comparisons between Simple random sampling (SRS) and: Local pivotal method with x and y coordinates (LPM-xy) to make sure the sample is well spread geographically. The Euclidean distance is used without standardization because the spatial coordinates are on the same scale. Local pivotal method (LPM) XY and four selected ALS variables as auxiliary variables. The samples are well spread geographically and well spread in the four ALS variables. The distance function (eq. (3)) is used. Cube method (CM) The samples are balanced on the four ALS variables. The x and y coordinates are not used for this method, because it does not make sense to balance on geographical coordinates. Local cube method (LCM) The samples are balanced on the four ALS variables and the x and y coordinates are used to make sure the sample is well spread geographically. The Euclidean distance is used in the geographical space. They found that spreading the sample well in geographical space is important. Spreading the sample well in all auxiliary variables (LPM) and using the HT estimator was in all cases a more efficient strategy than SRS followed by a calibration estimator. Spreading the sample well is more efficient than balancing (or SRS followed by calibration) if the relationship between the target and the auxiliary variables is nonlinear, which is why it performs better (see Tables 2 and 3). The final order of the designs combined with the calibration estimator was (from best to worst) LCM, LPM, LPM-xy, CM, and SRS. We get the best results when using the information both in the design and the estimator. Hence, we can conclude that using auxiliary information in the design is very important. \" All three designs, LCM, LPM, and CM, had very good design effects. The reduction of the variance of the HT estimator was for the main target variable volume up to 75% compared with SRS. (Grafström, Saarela, and Ene 2014) Continuation of previous study highlighting value of sampling methods. A possible drawback of the LPM compared with more simple methods such as systematic random sampling is that sample se- lection is computationally intensive for large populations. This is a problem because the population size (number of pixels) tends to be rather large in forest applications with auxiliary data from, e.g., airborne LiDAR, making it practically impossible to apply the LPM as it is. To deal with this problem, we introduce a new rapid suboptimal implementation ofthe LPM that can be applied to large populations. With the LPM, there is no stratification or other difficult design choices; we only need to define distance. Modelling is not really necessary, which means no complicated formulas. Yet this is a very competitive strategy in many cases. It has the advantage of being intuitive and simple, which should not be underrated. It also allows us to keep the traditional design-based approach, while still taking advantage of powerful auxiliary information. With the LPM, there is no stratification or other difficult design choices; we only need to define distance. Modelling is not really necessary, which means no complicated formulas. Yet this is a very competitive strategy in many cases. It has the advantage of being intuitive and simple, which should not be underrated. It also allows us to keep the traditional design-based approach, while still taking advantage of powerful auxiliary information. (Niemi and Vauhkonen 2016) Used ALS textural CHM metrics (HIST,PATCH,GLCM,LBP) for pre-stratification of the inventory area. They tested the strength of the relationship between metrics and central attributes of forest growing stock (Vol,BA,Diam). It was found that the dispersion of the clusters derived in an unsupervised mode could be used as an indicator for prioritizing the plots to be measured as the sample to form the reference data for the wall-to-wall models. (Valbuena et al. 2017) Used a rule based method to stratify forest areas using Lmoments including Lcv and Lskew. (McRoberts, Chen, and Walters 2017) Modeling inventory attributes with ALS metrics. BA was considered as an integrator of all the response variables and was used as the basis for constructing strata using a lonear model. Predictions of BA were then scaled by the largest BA prediction,multiplied by 100, then assigned 1 of 100 potential strata. Strata were then aggregated these into 4,6,8 strata with approximately equal proportion of study area. Stratifications that are most effective with respect to minimizing variances are based on variables that are closely related to the response variable or variables of interest. When multiple response variables are to be estimated simultaneously, the same stratification must be used for all response variables to ensure compatibility. Results showed they were able to: &gt;Reduce sampling intensity by up to 35% without losing accuracy in the estimators. Relative to the simple random sampling estimators that used no stratification, use of four strata decreased SEs by 29.0%38.1%, depending on the response variable; relative to four strata, use of six strata reduced SEs by 2.3%7.3%; and relative to six strata, use of eight strata reduced SEs by no more than 4% and for two response variables actually increased SEs. From an operational perspective, the results of the study suggest that multivariate, airborne laser scanning-assisted inventories could be fairly easily implemented, subject to availability of the airborne laser scanning data. (Malone, Minansy, and Brungard 2019) They provide an indepth description of how to implement and improve the outputs of Latin Hypercube sampling, providing a coded example of how to incorporate already acquired samples accross the landscape. They specify a method to boostrap sample size followed by the application of multiple methods to determine the optimal sample number to use based on auxillary data. (Papa et al. 2020) Compared simple random sampling to stratified sampling within strata groups. Used hierarchical cluster analysis for formation of strata. Clusters were used for sub-sampling. The number of clusters was established by the Elbow method. Clusters were validated with an ANOVA post-hoc Tukey test. Varying size of metric cells (1, 0.5, 0.25 ha) were tested. The stratified sampling was simulated by using weighting distributed by strata, so that each segment was the same sample size, whereas no weighting was used for the simulation in the case of the simple random sampling. For each level of sampling size (number of plots in the inventory), 1000 iterations were performed, and their mean and standard deviation were summarized in order to produce a graph of relative uncertainty (standard error/global mean) as a function of sample intensity (proportion of total area sampled, in %). (Ma et al. 2020) They compare latin hypercube sampling and feature space coverage sampling for predicting soil classes. They detail specific functions to use for latin hypercube sampling and feature space coverage sampling. Sampling pools of varying sizes are compared to simple random sampling in a number of modeling approaches. Final results indicated that: 1)In both study areas the median overall accuracy with FSCS washigher than those with CLHS and SRS over all sample sizes and crossall three prediction methods. The median overall accuracy with CLHS was only marginally larger than with SRS. 2)There was a significant negative correlation betweenMSSSDandoverall accuracy, whereas no such correlation was found betweenO1 + O3and overall accuracy.The coefficient of variation in overall accuracy among samples se-lected using FSCS was smaller than these using CLHS and SRS at thesame sample sizes. 3)With CLHS the variation in overall accuracy among samples waslarge, so that there is a serious risk that a particular sample mightlead to a low overall accuracy. 4)FSCS-RF is the most accurate combination of sampling and predic-tion for both study areas Results indicated that feature space coverage sampling could be a viable method for locating samples. pre { max-height: 500px; overflow-y: auto; } pre[class] { max-height: 500px; } References "],["fund.html", "sgsR fundamentals Algorithm structure Example data Stratified rasters - sraster", " sgsR fundamentals Algorithm structure sgsR has been scripted primarily using the terra package for raster processing and the sf package for vector manipulation. There are 3 primary function verbs that the package currently uses: strat_* - The stratify verb implies that functions are applying stratification algorithms to an input metrics raster (mraster) and output a stratified raster (sraster) sample_* - The sample verb implies that functions are extracting samples from srasters produced from strat_* functions. A few algorithms (e.g. sample_srs, sample_balanced, sample_systematic) are able to take mrasters as inputs as they are not dependent on stratified inputs for sampling. calculate_* - The calculate verb implies that functions are performing calculations to be used in consequent processing. The use of predefined sample analysis algorithms (calculate_ahels, calculate_coobs) are also included. Package Documentation I do not go into detail about the intricacies of each function in this document. Please see the documentation for functions e.g. ?sgsR::strat_kmeans for intended application and use of each function. Example data Worked examples of all functions are provided using data internal to the package. To load internal mraster and road access data we use the following code. Follow along on your own machine to see more outputs and get a better sense of how the package functions. Metrics rasters - mraster library(sgsR) library(terra) library(sf) #--- Load mraster and access files ---# r &lt;- system.file(&quot;extdata&quot;, &quot;wall_metrics_small.tif&quot;, package = &quot;sgsR&quot;) #--- load the mraster using the terra package ---# mraster &lt;- terra::rast(r) Road access data a &lt;- system.file(&quot;extdata&quot;, &quot;roads.shp&quot;, package = &quot;sgsR&quot;) #--- load the access vector using the sf package ---# access &lt;- sf::st_read(a) ## Reading layer `roads&#39; from data source ## `C:\\Users\\tgood.stu\\Documents\\R\\win-library\\4.1\\sgsR\\extdata\\roads.shp&#39; using driver `ESRI Shapefile&#39; ## Simple feature collection with 167 features and 36 fields ## Geometry type: MULTILINESTRING ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337700 xmax: 438560 ymax: 5343240 ## Projected CRS: UTM_Zone_17_Northern_Hemisphere terra::plot(mraster[[1]]) terra::plot(access, add = TRUE, col = &quot;black&quot;) From the plot we see the first band (zmax) of the mraster with the access vector overlaid. Stratified rasters - sraster For the purposes of this tutorial I am also going to show how to produce a basic sraster and existing sample data that we will used in examples below. To make the sraster we will use the strat_kmeans function where the input mraster will be stratified using a kmeans algorithm. #--- apply kmeans algorithm to metrics raster ---# sraster &lt;- strat_kmeans(mraster = mraster, # use mraster as input for sampling nStrata = 4, # algorithm will produce 4 strata plot = TRUE) # algorithm will plot output After the sraster is produced we apply the sample_srs algorithm which randomly samples points within our sraster to produce an existing sample dataset. #--- set seed ---# set.seed(2021) #--- apply kmeans algorithm to metrics raster ---# existing &lt;- sample_srs(raster = mraster, # use mraster as input for sampling nSamp = 200, # request 200 samples be taken mindist = 100, # define that samples must be 100 m apart plot = TRUE) # algorithm will plot output We now have mraster, access, sraster and existing data sets generated. Expect to see these data used in the all examples in this document. pre { max-height: 500px; overflow-y: auto; } pre[class] { max-height: 500px; } ## Reading layer `roads&#39; from data source ## `C:\\Users\\tgood.stu\\Documents\\R\\win-library\\4.1\\sgsR\\extdata\\roads.shp&#39; using driver `ESRI Shapefile&#39; ## Simple feature collection with 167 features and 36 fields ## Geometry type: MULTILINESTRING ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337700 xmax: 438560 ymax: 5343240 ## Projected CRS: UTM_Zone_17_Northern_Hemisphere "],["strat.html", "strat_* functions strat_kmeans strat_pcomp strat_breaks strat_quantiles strat_osb", " strat_* functions Fundamental to many structurally guided sampling approaches is the use of stratification methods that allow for more effective and representative sampling protocols. Below I define the stratification methods that are included thus far in sgsR and provide some worked examples for each. A total of 5 strat functions currently exist in the package: strat_kmeans - kmeans stratification strat_pcomp- principal component stratification strat_breaks - user-defined break stratification strat_quantiles - quantile stratification strat_osb - optimum sample boundary stratification strat_kmeans We provide a preliminary example of the strat_kmeans algorithm to prepare our sraster input data but here are a few more. #--- perform stratification using k-means ---# strat_kmeans(mraster = mraster, # input nStrata = 5) # algorithm will produce 4 strata ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 5 Plot Notice that nothing plotted Thats because plot = FALSE is the default for all functions in sgsR. See examples below where plot = TRUE. strat_kmeans(mraster = mraster, # input nStrata = 10, # algorithm will produce 10 strata iter = 1000, # set minimum number of interations to determine kmeans centers algorithm = &quot;MacQueen&quot;, # use MacQueen algorithm plot = TRUE, # plot output details = TRUE) # output details - kmeans stratification data and output sraster ## $details ## K-means clustering with 10 clusters of sizes 8460, 8175, 14401, 7390, 9868, 10001, 7523, 3621, 12801, 8955 ## ## Cluster means: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 ## 1 -1.61845760 -2.21644419 -1.63846390 -0.99047251 -1.1864738 -1.50396615 -1.6459599 -1.8468352 ## 2 -1.18115418 -0.21578917 -1.08949828 -0.75875943 -0.9150003 -1.13205186 -1.2044319 -1.2349361 ## 3 0.26583212 0.56153588 0.07272645 0.21463824 0.2881727 0.27517550 0.2418837 0.2056615 ## 4 1.39721946 0.62354818 0.34114940 1.80773962 1.7801397 1.35336933 1.1818874 0.9664822 ## 5 0.01721191 0.01098153 0.83805005 -0.56628465 -0.5185618 -0.04843908 0.2166482 0.4737554 ## 6 0.79331356 0.77058735 -0.19524776 1.43253552 1.1557104 0.73536980 0.5871320 0.4388289 ## 7 -0.94287627 -1.41892604 -0.28918661 -0.86547692 -0.9795565 -1.00411311 -0.9013863 -0.6156040 ## 8 1.76150865 0.69261341 1.83496281 0.75707447 1.2237326 1.80930765 1.9196920 1.7151428 ## 9 -0.52954681 0.28400209 -0.29233160 -0.47235346 -0.5335791 -0.54493965 -0.5043006 -0.4021585 ## 10 0.95859014 0.50659987 1.35742129 -0.08826613 0.3952886 1.01793988 1.0976238 1.1301770 ## zq95 l_1 l_2 t_3 t_4 ## 1 -1.9020831 -0.1781397 -1.18860515 -0.3617194 -2.20193918 ## 2 -1.1929623 2.2901169 -1.10283325 -0.3604030 -0.10722060 ## 3 0.2189552 -0.4672981 0.84913943 -0.3165150 0.53656536 ## 4 0.8654981 -0.8835024 0.29909510 0.3395034 0.50972172 ## 5 0.5242885 0.1305378 0.04956952 -0.2194533 0.02085024 ## 6 0.4221690 -0.8717392 1.79501743 -0.2659370 0.72264588 ## 7 -0.5435200 0.1293558 -0.98909181 -0.3531697 -1.39820377 ## 8 1.5461441 -0.5843340 -0.40512452 4.0847632 0.67617048 ## 9 -0.3306150 0.6143076 -0.45100988 -0.3565298 0.34255658 ## 10 1.0744401 -0.3625802 0.09744738 0.5930486 0.47607905 ## ## Clustering vector: ## [1] 9 7 5 3 7 9 5 9 3 3 3 4 10 10 8 8 8 4 6 4 4 10 10 10 3 10 5 5 10 5 4 ## [32] 3 5 10 4 5 1 5 10 4 10 4 10 10 4 4 10 4 4 10 4 4 10 4 10 2 2 5 5 3 3 3 ## [63] 3 5 3 1 7 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 2 2 2 2 2 2 2 2 9 ## [94] 7 5 9 2 9 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 ## [125] 2 2 2 2 7 1 1 2 2 2 2 2 2 2 2 2 2 1 2 2 1 2 2 2 2 2 2 2 2 2 2 ## [156] 2 2 2 2 2 2 2 2 2 7 5 5 5 10 8 8 10 5 10 3 5 9 9 5 9 9 9 9 9 9 2 ## [187] 9 9 9 7 9 9 9 9 9 2 9 9 5 6 6 6 6 6 5 6 6 6 6 6 5 10 3 3 5 3 3 ## [218] 3 3 5 3 10 5 5 2 7 7 6 6 6 6 3 3 3 9 2 2 2 2 7 7 3 5 6 3 4 4 8 ## [249] 4 4 6 3 4 6 4 3 6 6 8 6 4 10 3 8 4 8 8 10 5 10 10 8 8 8 10 2 1 1 1 ## [280] 1 1 2 7 5 5 5 7 1 1 1 1 1 1 1 1 1 1 1 1 1 1 7 7 9 9 9 6 6 6 3 ## [311] 6 6 4 6 6 10 5 3 4 5 5 10 5 8 5 3 7 7 7 9 7 5 9 3 4 10 10 4 4 4 4 ## [342] 4 4 6 6 4 10 10 10 10 10 5 10 10 4 3 10 10 5 3 3 3 3 7 1 4 10 4 10 4 10 4 ## [373] 10 10 4 10 10 4 4 5 9 3 3 5 3 3 3 3 3 7 2 2 2 2 2 2 2 2 2 2 2 2 2 ## [404] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 9 2 2 9 2 2 2 2 2 7 5 5 5 5 2 7 1 ## [435] 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 7 2 1 2 2 2 2 1 2 2 2 9 ## [466] 2 2 2 1 1 2 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 9 5 5 5 10 5 10 ## [497] 10 10 10 3 9 9 5 5 5 5 7 7 9 9 7 7 7 5 9 9 9 9 2 9 3 5 5 4 6 3 3 ## [528] 6 6 6 6 6 3 6 6 5 10 5 3 3 9 3 3 6 10 4 10 5 5 9 3 9 9 9 3 3 5 2 ## [559] 3 3 9 2 2 2 7 5 3 7 4 4 5 4 3 6 6 3 4 4 7 6 6 6 3 10 10 8 8 7 5 ## [590] 8 10 10 4 4 10 8 8 10 5 1 1 1 2 2 2 2 2 5 7 1 1 1 1 1 7 1 1 1 1 1 ## [621] 1 1 1 1 7 9 9 9 3 6 6 4 3 6 4 3 6 6 10 10 5 5 3 5 4 5 8 9 3 3 9 ## [652] 5 9 9 9 5 4 4 4 4 4 4 10 4 6 6 6 6 4 10 10 10 3 10 5 5 6 10 10 5 10 10 ## [683] 4 3 3 9 3 5 7 1 1 1 5 10 10 4 10 10 10 10 8 4 8 5 5 4 4 6 3 3 3 3 7 ## [714] 9 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 ## [745] 2 2 2 2 5 9 2 2 2 9 9 2 1 1 1 1 1 1 1 7 1 1 2 2 2 2 2 2 2 2 2 ## [776] 2 2 2 2 1 1 1 1 1 2 2 2 2 2 2 2 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 ## [807] 2 2 2 2 2 7 5 5 5 10 8 8 10 10 10 10 9 9 9 5 5 5 5 7 1 7 9 9 7 7 7 ## [838] 7 2 9 9 9 9 9 3 3 10 4 8 5 6 6 6 6 6 6 3 10 5 3 3 3 3 5 9 9 5 10 ## [869] 10 4 4 10 5 9 9 9 9 2 9 3 2 7 3 9 9 7 1 1 1 1 7 7 3 3 6 3 6 6 6 ## [900] 6 6 6 6 6 6 6 3 10 10 8 8 9 7 8 8 10 10 10 8 8 8 2 2 1 1 1 1 2 2 2 ## [931] 2 1 1 7 1 1 1 7 1 1 1 1 1 1 1 1 1 1 7 9 9 9 5 3 3 6 3 4 4 4 3 ## [962] 3 3 5 5 5 5 5 5 5 5 5 9 3 10 3 9 3 3 5 6 6 4 4 10 10 4 4 4 6 6 6 ## [993] 6 10 10 4 4 10 10 5 ## [ reached getOption(&quot;max.print&quot;) -- omitted 90195 entries ] ## ## Within cluster sum of squares by cluster: ## [1] 12158.85 17930.08 20050.11 18795.73 21479.44 13944.26 19130.48 25280.81 20918.38 26772.76 ## (between_SS / total_SS = 83.4 %) ## ## Available components: ## ## [1] &quot;cluster&quot; &quot;centers&quot; &quot;totss&quot; &quot;withinss&quot; &quot;tot.withinss&quot; &quot;betweenss&quot; ## [7] &quot;size&quot; &quot;iter&quot; &quot;ifault&quot; ## ## $raster ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 10 strat_kmeans(mraster = mraster, # input nStrata = 5, # algorithm will produce 4 strata center = FALSE, # do not center data scale = FALSE, # do not scale data plot = TRUE, # plot output filename = tempfile(fileext = &quot;.tif&quot;), # write output sraster to file overwrite = TRUE) # overwrite file on disc if it exists ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 5 strat_pcomp The strat_pcomp algorithm calculates principal components on the input mraster then divides data into equal sized strata. Strata can be defined by using the primary (PC1) only (nStrata), or primary &amp; secondary (PC2 - nStata2) principal components. If nStata2 is defined, PC2 is used and the total number of strata will be \\[nStrata * nStrata2\\]. #--- perform stratification using principal components ---# strat_pcomp(mraster = mraster, # input nStrata = 5, # 5 strata with primary PC only plot = TRUE) # plot ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 5 strat_pcomp(mraster = mraster, # input nStrata = 4, # 4 strata with primary nStrata2 = 4, # 4 strata with secondary PC - will produce 16 output strata plot = TRUE, # plot details = TRUE) # produce output details ## $details ## Standard deviations (1, .., p=13): ## [1] 2.93647150 1.26882709 1.15691535 0.86852611 0.53076565 0.42304219 0.35679023 0.21988261 ## [9] 0.14290118 0.09666573 0.07179753 0.05016994 0.02570635 ## ## Rotation (n x k) = (13 x 13): ## PC1 PC2 PC3 PC4 PC5 PC6 PC7 ## zmax 0.3359531 0.01817295 -0.085980156 0.04883369 -0.16446975 0.134888577 -0.15339832 ## zmean 0.2692352 -0.14320556 0.484261417 0.08715503 0.10021008 0.208524587 0.28510651 ## zsd 0.2525172 0.46307645 0.056280928 -0.35189237 -0.05790180 -0.047159024 -0.05015151 ## pzabove2 0.2575694 -0.38512031 -0.153689213 0.33477151 -0.20262484 -0.504470621 0.11141535 ## zq20 0.2957809 -0.25072438 -0.163557453 0.28595035 -0.26718846 -0.008654979 -0.08550919 ## zq50 0.3271212 0.02248762 -0.100221327 0.07934796 -0.16569646 0.420247325 -0.29668394 ## zq70 0.3296060 0.11882609 -0.062083857 -0.02690735 -0.12986291 0.271021251 -0.22963234 ## zq90 0.3192555 0.21122345 0.009465806 -0.18799597 -0.09477864 -0.264930469 0.08153534 ## zq95 0.3091490 0.21445676 0.055153306 -0.23449020 -0.07471056 -0.451270472 0.21011887 ## l_1 -0.1885162 0.18294540 0.614448790 0.27802959 -0.27135857 -0.287232900 -0.56400277 ## l_2 0.2327722 -0.43278499 0.060836142 -0.34982009 0.57978716 -0.188355371 -0.50772612 ## t_3 0.1690462 0.45853939 -0.166263397 0.60467076 0.59765870 -0.091199035 -0.03067072 ## t_4 0.2561467 -0.13145011 0.527861021 0.09849843 0.14573821 0.177036168 0.32336804 ## PC8 PC9 PC10 PC11 PC12 PC13 ## zmax 0.0308922302 -1.886049e-02 0.0560186614 -0.1278804649 -0.0052115172 0.8873685582 ## zmean -0.0021690322 2.826642e-02 0.0270039439 0.0675442390 -0.7236917619 -0.0162558333 ## zsd 0.1340537231 3.445926e-01 -0.0513256272 0.6681251318 0.0295065391 0.0098559868 ## pzabove2 0.5392526124 -2.020873e-02 0.0120286554 0.2179924264 -0.0004334086 -0.0531021769 ## zq20 -0.6885132239 3.627060e-01 -0.1271545992 0.1378591128 0.0390001016 -0.1416169733 ## zq50 0.0329045573 -5.353496e-01 0.4057583148 0.2063460374 0.0609622299 -0.2923086818 ## zq70 0.3370366252 1.490613e-01 -0.5945209546 -0.4103363124 -0.0257022931 -0.2670379822 ## zq90 -0.0006831206 3.087370e-01 0.5970060214 -0.4980350813 -0.0047718481 -0.1800345902 ## zq95 -0.3114508486 -5.847183e-01 -0.3194796103 -0.0758389467 -0.0171556239 -0.0045593830 ## l_1 -0.0188834161 -2.142108e-02 0.0060754571 -0.0313981609 -0.0077753523 0.0029767582 ## l_2 -0.0466621166 2.094108e-02 0.0009527472 0.0201177308 -0.0003045197 -0.0008875782 ## t_3 -0.0310296725 7.516919e-05 -0.0011560670 0.0009191501 -0.0216941448 -0.0022824635 ## t_4 0.0324261270 3.474720e-02 -0.0238296876 -0.0055552525 0.6845626123 0.0117767342 ## ## $raster ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 16 ## ## $plot strat_pcomp(mraster = mraster, # input nStrata = 3, # 3 strata with primary PC nStrata2 = 3, # 4 strata with secondary PC - will produce 9 output strata filename = tempfile(fileext = &quot;.tif&quot;)) # write output sraster to file ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 9 strat_breaks The strat_breaks function stratifies data based on user-defined breaks in covariates. A single metric can be defined or an additional metric2 can be supplied. breaks and breaks2 correspond to the user-defined breaks for metric and metric2 respectively. #--- define vector breaks ---# br.max &lt;- c(3, 5, 11, 18) #zmax breaks br.sd &lt;- c(1, 2, 5) #zsd breaks Once the breaks have been created we can input them into the function using the breaks and breaks2 parameters. #--- perform stratification using breaks ---# strat_breaks(mraster = mraster, # input metric = &quot;zmax&quot;, # covariate of interest - numeric index or character string breaks = br.max, # breaks for primary covariate plot = TRUE, # plot details = TRUE) # output details ## $details ## $details$breaks ## [1] 3 5 11 18 ## ## $details$breaks2 ## NULL ## ## ## $raster ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 5 ## ## $plot strat_breaks(mraster = mraster, # input metric = 1, # primary covariate of interest - numeric index or character string metric2 = &quot;zsd&quot;, # secondary covariate of interest - numeric index or character string breaks = br.max, # breaks for primary covariate breaks2 = br.sd, # breaks for secondary covariate plot = TRUE) # plot ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 16 strat_quantiles The strat_quantiles function stratifies data into the user-defined number of quantiles (nQuant). A single metric can be defined or an additional metric2 can be supplied. nQuant and nQuant2 correspond to the desired number of quantiles for metric and metric2 respectively. If nQuant2 is defined, the total number of strata will be \\[nStrata = nQuant * nQuant2\\] #--- perform stratification using quantiles ---# strat_quantiles(mraster = mraster, # input metric = 4, # primary covariate of interest - numeric index or character string nQuant = 10, # number of quantiles for primary covariate plot = TRUE) # plot ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 10 strat_quantiles(mraster = mraster, # input metric = &quot;zsd&quot;, # primary covariate of interest - numeric index or character string metric2 = &quot;zq95&quot;, # secondary covariate of interest - numeric index or character string nQuant = 3, # number of quantiles for primary covariate nQuant2 = 4, # number of quantiles for secondary covariate plot = TRUE) # plot ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 12 strat_quantiles(mraster = mraster, # input metric = 1, # primary covariate of interest - numeric index or character string metric2 = &quot;zsd&quot;, # secondary covariate of interest - numeric index or character string nQuant = 2, # number of quantiles for primary covariate nQuant2 = 2, # number of quantiles for secondary covariate filename = tempfile(fileext = &quot;.tif&quot;)) # write output sraster to file ## class : SpatRaster ## dimensions : 277, 373, 1 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## source : memory ## name : strata ## min value : 1 ## max value : 4 strat_osb The strat_osb algorithm implements the optimum sample boundaries algorithm implmented in the stratifyR package. For further details about the algorithms used check out their package and also consult ?sgsR::strat_osb for references. The basics of this algorithm are to provide the number of desired strata nStrata and samples nSamp. The algorithm then analyzes the data for the optimal locations to establish breaks in the covariate metric, which are used as stratum boundaries. This function can take a bit longer to run so please be patient! For the purpses of this example I have used a limited number of nStrata and nSamp to ensure they run and render quickly. #--- perform optimum sample boundary stratification ---# strat_osb(mraster = mraster, # input metric = &quot;zsd&quot;, # covariate of interest - numeric index or character string nSamp = 50, # number of desired samples nStrata = 3, # number of desired strata plot = TRUE) # plot strat_osb(mraster = mraster, # input metric = 4, # covariate of interest - numeric index or character string nSamp = 25, # number of desired samples nStrata = 3, # number of desired strata plot = TRUE, # plot details = TRUE) # produce output details strat_osb(mraster = mraster, # input metric = &quot;zmax&quot;, # covariate of interest - numeric index or character string nSamp = 50, # number of desired samples nStrata = 3, # number of desired strata subset = 0.75, # used a subset of covariate data to determine optimum breaks filename = tempfile(fileext = &quot;.tif&quot;)) # write output sraster to file pre { max-height: 500px; overflow-y: auto; } pre[class] { max-height: 500px; } ## Reading layer `roads&#39; from data source ## `C:\\Users\\tgood.stu\\Documents\\R\\win-library\\4.1\\sgsR\\extdata\\roads.shp&#39; using driver `ESRI Shapefile&#39; ## Simple feature collection with 167 features and 36 fields ## Geometry type: MULTILINESTRING ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337700 xmax: 438560 ymax: 5343240 ## Projected CRS: UTM_Zone_17_Northern_Hemisphere "],["sample.html", "sample_* functions Access sample_srs sample_systematic sample_strat sample_clhs sample_balanced", " sample_* functions A total of 5 sample functions currently exist in the package: sample_srs - simple random sampling sample_systematic- grid sampling sample_strat - stratified sampling within a sraster sample_clhs - Latin hypercube sampling algorithm sample_balanced - Balanced sampling (Grafström and Lisic 2019) Access A feature of the sample_* functions that may be of interest is the ability to define access. Users can supply a road access network (must be sf line objects) and define buffers around access where samples should be excluded and included. Important additional parameters when access is provided are: buff_inner - An inner buffer that defines the distance from access where samples cannot be takes (i.e. if you do not want samples within 50 m of your access layer set buff_inner = 50). buff_outer - Maximum distance samples can be located from access (i.e. if you dont want samples more than 200 meters from a road set buff_inner = 200) sample_srs We provided a very simple example of using the sample_srs function when we were preparing our existing data. We provide some additional examples below. Input raster Notice that the input for sample_srs is raster. This means that either an sraster or an mraster can be supplied. #--- perform simple random sampling ---# sample_srs(raster = sraster, # input sraster nSamp = 200, # number of desired samples plot = TRUE) # plot ## Simple feature collection with 200 features and 0 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438410 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## geometry ## 1 POINT (437450 5338550) ## 2 POINT (433670 5341230) ## 3 POINT (433430 5339390) ## 4 POINT (431990 5338590) ## 5 POINT (438370 5341450) ## 6 POINT (432190 5342430) ## 7 POINT (433510 5339250) ## 8 POINT (436250 5342930) ## 9 POINT (436730 5339650) ## 10 POINT (433590 5342070) sample_srs(raster = mraster, # input mraster nSamp = 200, # number of desired samples access = access, # define access road network mindist = 200, # minimum distance samples must be apart from one another buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200, # outer buffer - no samples further than this distance from road plot = TRUE) # plot ## Simple feature collection with 200 features and 0 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337730 xmax: 438510 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## geometry ## 1 POINT (432050 5342810) ## 2 POINT (434270 5338050) ## 3 POINT (437510 5338950) ## 4 POINT (432770 5340250) ## 5 POINT (432870 5340450) ## 6 POINT (433610 5340490) ## 7 POINT (436410 5341550) ## 8 POINT (434110 5338510) ## 9 POINT (433690 5342650) ## 10 POINT (435390 5338550) sample_srs(raster = sraster, # input nSamp = 200, # number of desired samples access = access, # define access road network buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200, # outer buffer - no samples further than this distance from road plot = TRUE, # plot filename = tempfile(fileext = &quot;.shp&quot;)) # write output samples to file ## Writing layer `file25344f185a14&#39; to data source ## `C:\\Users\\tgood.stu\\AppData\\Local\\Temp\\RtmpSOoCgd\\file25344f185a14.shp&#39; using driver `ESRI Shapefile&#39; ## Writing 200 features with 0 fields and geometry type Point. ## Simple feature collection with 200 features and 0 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431230 ymin: 5337710 xmax: 438510 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## geometry ## 1 POINT (435330 5338970) ## 2 POINT (433550 5342670) ## 3 POINT (435030 5340430) ## 4 POINT (435910 5342370) ## 5 POINT (434330 5337930) ## 6 POINT (432470 5340870) ## 7 POINT (436430 5338370) ## 8 POINT (436530 5341710) ## 9 POINT (436470 5338170) ## 10 POINT (438510 5339170) sample_systematic The sample_systematic function applies systematic sampling across an area where the cellsize parameter defines resolution of the tessellation. Tesselation shape options are defined by the square parameter, which is a regular grid when TRUE (default) and hexagonal when FALSE. The location of samples can also be adjusted using the centers parameter, where TRUE takes the center of each tessellation, and FALSE takes all corners. #--- perform grid sampling ---# sample_systematic(raster = sraster, # input sraster cellsize = 200, # grid distance plot = TRUE) # plot ## Simple feature collection with 904 features and 1 field ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431200 ymin: 5337800 xmax: 438400 ymax: 5343200 ## CRS: NA ## First 10 features: ## strata geometry ## 1 4 POINT (431200 5337800) ## 2 1 POINT (431400 5337800) ## 3 1 POINT (431600 5337800) ## 4 1 POINT (431800 5337800) ## 5 3 POINT (432000 5337800) ## 6 1 POINT (432200 5337800) ## 7 4 POINT (432400 5337800) ## 8 4 POINT (432600 5337800) ## 9 1 POINT (432800 5337800) ## 10 3 POINT (433000 5337800) #--- perform grid sampling ---# sample_systematic(raster = sraster, # input sraster cellsize = 200, # grid distance square = FALSE, # hexagonal tessellation centers = FALSE, # take corners instead of centers plot = TRUE) # plot ## Simple feature collection with 7397 features and 1 field ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337758 xmax: 438500 ymax: 5343185 ## CRS: NA ## First 10 features: ## strata geometry ## 1 4 POINT (431100 5337931) ## 2 4 POINT (431100 5337815) ## 3 1 POINT (431100 5338277) ## 4 1 POINT (431100 5338162) ## 5 1 POINT (431100 5338624) ## 6 1 POINT (431100 5338508) ## 7 4 POINT (431100 5338970) ## 8 1 POINT (431100 5338855) ## 9 1 POINT (431100 5339317) ## 10 1 POINT (431100 5339201) sample_systematic(raster = sraster, # input sraster cellsize = 100, # grid distance access = access, # define access road network square = FALSE, # hexagonal tessellation buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200) # outer buffer - no samples further than this distance from road ## Simple feature collection with 1765 features and 1 field ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337700 xmax: 438550 ymax: 5343156 ## CRS: NA ## First 10 features: ## strata geometry ## 49 3 POINT (431100 5340471) ## 50 2 POINT (431100 5340644) ## 51 4 POINT (431100 5340818) ## 61 1 POINT (431100 5342550) ## 62 3 POINT (431100 5342723) ## 81 1 POINT (431150 5340385) ## 83 4 POINT (431150 5340731) ## 84 4 POINT (431150 5340904) ## 94 4 POINT (431150 5342636) ## 114 4 POINT (431200 5340471) sample_systematic(raster = mraster, # input mraster cellsize = 200, # grid distance access = access, # define access road network buff_inner = 100, # inner buffer - no samples within this distance from road buff_outer = 400, # outer buffer - no samples further than this distance from road filename = tempfile(fileext = &quot;.shp&quot;), # write output samples to file plot = TRUE) # plot ## Writing layer `file25341965677b&#39; to data source ## `C:\\Users\\tgood.stu\\AppData\\Local\\Temp\\RtmpSOoCgd\\file25341965677b.shp&#39; using driver `ESRI Shapefile&#39; ## Writing 488 features with 13 fields and geometry type Point. ## Simple feature collection with 488 features and 13 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431200 ymin: 5337800 xmax: 438400 ymax: 5343200 ## CRS: NA ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 ## 3 10.08 89.7 3.90 4.57 6.78 10.27 12.530000 16.02 17.66 7.1 37.9 0.0 86.4 ## 5 18.79 97.9 4.08 12.89 14.72 19.62 21.840000 24.00 24.72 0.0 17.7 44.4 94.9 ## 6 9.13 91.4 3.85 3.84 5.61 9.44 11.170000 15.62 18.78 12.2 34.3 0.4 88.8 ## 17 7.00 84.5 3.96 2.56 3.71 6.36 8.260000 15.59 19.49 25.2 9.1 0.6 82.9 ## 18 6.16 44.1 3.30 1.90 2.73 6.08 8.139999 11.74 13.16 14.0 7.0 0.0 40.2 ## 19 5.85 55.4 2.96 2.14 3.08 5.39 7.340000 11.31 13.02 21.3 6.3 0.0 54.0 ## 23 10.86 91.3 4.37 5.39 7.61 10.84 12.500000 18.66 22.50 5.6 37.0 2.0 86.1 ## 24 13.99 93.4 5.64 4.37 7.14 15.81 17.639999 20.63 22.80 9.8 17.2 7.1 87.7 ## 26 5.72 85.7 2.62 2.49 3.37 5.46 6.850000 10.74 12.83 33.0 6.5 0.0 83.9 ## 27 8.91 80.3 4.46 2.63 4.16 9.30 11.690000 16.00 17.65 16.0 28.5 0.0 76.0 ## geometry ## 3 POINT (431600 5337800) ## 5 POINT (432000 5337800) ## 6 POINT (432200 5337800) ## 17 POINT (434400 5337800) ## 18 POINT (434600 5337800) ## 19 POINT (434800 5337800) ## 23 POINT (435600 5337800) ## 24 POINT (435800 5337800) ## 26 POINT (436200 5337800) ## 27 POINT (436400 5337800) sample_strat The sample_strat function contains a hierarchical sampling algorithm originally developed my Martin Queinnec. The algorithm uses a moving window (wrow and wcol parameters) to filter the input sraster for locations where stratum pixels are spatially grouped rather than dispersed individually across the landscape. The sampling is performed in 2 stages: Rule 1 - Sample within spatially grouped stratum pixels. Rule 2 - If no more samples exist to satisfy desired sampling count, individual stratum pixels are sampled. The rule applied to a select a particular sample is defined in the rule attribute of output samples. We give a few examples below: #--- perform stratified sampling random sampling ---# sample_strat(sraster = sraster, # input sraster nSamp = 200, # desired sample number plot = TRUE) # plot ## Simple feature collection with 199 features and 3 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431130 ymin: 5337770 xmax: 438510 ymax: 5343210 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## strata type rule geometry ## x 1 new rule1 POINT (432550 5340370) ## x1 1 new rule1 POINT (432550 5340370) ## x2 1 new rule1 POINT (436510 5341690) ## x3 1 new rule1 POINT (432110 5339970) ## x4 1 new rule1 POINT (434090 5338010) ## x5 1 new rule1 POINT (431470 5341690) ## x6 1 new rule1 POINT (431450 5341010) ## x7 1 new rule1 POINT (431490 5341530) ## x8 1 new rule1 POINT (432470 5341790) ## x9 1 new rule1 POINT (435510 5341150) In some cases, a user may wish to include an existing sample dataset within the algorithm. In order to adjust the total number of samples needed per stratum to reflect those already present in existing, we can use the utility function extract_strata. This function takes an input sraster and the existing sample dataset and extracts the stratum for each sample. These samples can then be input into the sample_strat function which adjusts total required sample per class based on representation in existing. #--- extract strata values to existing samples ---# e.sr &lt;- extract_strata(sraster = sraster, # input sraster existing = existing) # existing samples to add strata value to e.sr ## Simple feature collection with 200 features and 1 field ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337730 xmax: 438490 ymax: 5343230 ## Projected CRS: UTM Zone 17, Northern Hemisphere ## First 10 features: ## strata geometry ## 1 4 POINT (432070 5340130) ## 2 4 POINT (435010 5342150) ## 3 4 POINT (437390 5338370) ## 4 2 POINT (437850 5342890) ## 5 4 POINT (434710 5342370) ## 6 1 POINT (432870 5340230) ## 7 4 POINT (435150 5340150) ## 8 1 POINT (431850 5338570) ## 9 4 POINT (432770 5342710) ## 10 1 POINT (436190 5341450) Existing strata Notice that e.sr now has an attribute named strata. If that parameter is not there, sample_strat will give an error. sample_strat(sraster = sraster, # input sraster nSamp = 200, # desired sample number access = access, # define access road network existing = e.sr, # existing samples with strata values mindist = 200, # minimum distance samples must be apart from one another buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200, # outer buffer - no samples further than this distance from road plot = TRUE) # plot ## Simple feature collection with 399 features and 3 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337730 xmax: 438530 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## strata type rule geometry ## 6 1 existing existing POINT (432870 5340230) ## 8 1 existing existing POINT (431850 5338570) ## 10 1 existing existing POINT (436190 5341450) ## 11 1 existing existing POINT (438230 5341170) ## 14 1 existing existing POINT (431170 5339890) ## 15 1 existing existing POINT (434450 5340070) ## 17 1 existing existing POINT (434930 5339010) ## 19 1 existing existing POINT (438470 5338890) ## 23 1 existing existing POINT (435290 5337850) ## 27 1 existing existing POINT (431110 5338050) mindist The mindist parameter defined in the above example specifies the minimum euclidian distance that samples must be apat from one another. Notice that the sample outputs have type and rule attributes which outline whether samples are existing or new and whether rule1 or rule2 were used to select individual samples. sample_strat(sraster = sraster, # input nSamp = 200, # desired sample number access = access, # define access road network existing = e.sr, # existing samples with strata values include = TRUE, # include existing plots in nSamp total buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200, # outer buffer - no samples further than this distance from road filename = tempfile(fileext = &quot;.shp&quot;), # write output samples to file plot = TRUE) # plot ## Writing layer `file25342e7855e2&#39; to data source ## `C:\\Users\\tgood.stu\\AppData\\Local\\Temp\\RtmpSOoCgd\\file25342e7855e2.shp&#39; using driver `ESRI Shapefile&#39; ## Writing 199 features with 3 fields and geometry type Point. ## Simple feature collection with 199 features and 3 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337730 xmax: 438490 ymax: 5343190 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## strata type rule geometry ## 6 1 existing existing POINT (432870 5340230) ## 8 1 existing existing POINT (431850 5338570) ## 10 1 existing existing POINT (436190 5341450) ## 11 1 existing existing POINT (438230 5341170) ## 14 1 existing existing POINT (431170 5339890) ## 15 1 existing existing POINT (434450 5340070) ## 17 1 existing existing POINT (434930 5339010) ## 19 1 existing existing POINT (438470 5338890) ## 23 1 existing existing POINT (435290 5337850) ## 27 1 existing existing POINT (431110 5338050) include parameter The include parameter determines whether existing samples should be included in the total count of samples defined by nSamp. By defaults include = FALSE. sample_clhs The sample_clhs function implements conditioned latin hypercube (clhs) sampling functionality. A number of other functions in the sgsR package help to provide guidance on clhs sampling including calculate_lhsPop and calculate_lhsOpt. Be sure to check out those functions for better understanding of how to optimize sample numbers. Syntax for this function is similar to others shown above, though parameters like iter, which define the number of iterations within the Metropolis-Hastings process are important to consider. In these examples we use a low iter value because it takes less time to run. Default values for iter within the clhs package are 10,000. sample_clhs(mraster = mraster, # input nSamp = 200, # desired sample number plot = TRUE, # plot iter = 100) # number of iterations ## | | | 0% | |= | 1% | |== | 2% | |=== | 3% | |==== | 4% | |==== | 5% | |===== | 6% | |====== | 7% | |======= | 8% | |======== | 9% | |========= | 10% | |========== | 11% | |=========== | 12% | |============ | 13% | |============= | 14% | |============= | 15% | |============== | 16% | |=============== | 17% | |================ | 18% | |================= | 19% | |================== | 20% | |=================== | 21% | |==================== | 22% | |===================== | 23% | |====================== | 24% | |====================== | 25% | |======================= | 26% | |======================== | 27% | |========================= | 28% | |========================== | 29% | |=========================== | 30% | |============================ | 31% | |============================= | 32% | |============================== | 33% | |=============================== | 34% | |=============================== | 35% | |================================ | 36% | |================================= | 37% | |================================== | 38% | |=================================== | 39% | |==================================== | 40% | |===================================== | 41% | |====================================== | 42% | |======================================= | 43% | |======================================== | 44% | |======================================== | 45% | |========================================= | 46% | |========================================== | 47% | |=========================================== | 48% | |============================================ | 49% | |============================================= | 51% | |============================================== | 52% | |=============================================== | 53% | |================================================ | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 57% | |=================================================== | 58% | |==================================================== | 59% | |===================================================== | 60% | |====================================================== | 61% | |======================================================= | 62% | |======================================================== | 63% | |========================================================= | 64% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 68% | |============================================================= | 69% | |============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 72% | |================================================================= | 73% | |================================================================== | 74% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 80% | |======================================================================== | 81% | |========================================================================= | 82% | |========================================================================== | 83% | |=========================================================================== | 84% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 87% | |============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 90% | |================================================================================= | 91% | |================================================================================== | 92% | |=================================================================================== | 93% | |==================================================================================== | 94% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 98% | |======================================================================================== | 99% | |=========================================================================================| 100% ## Simple feature collection with 200 features and 14 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431170 ymin: 5337710 xmax: 438550 ymax: 5343210 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 type ## 76082 14.20 95.7 3.14 9.559999 12.47 14.73 15.89 18.09 20.38 1.2 39.200001 1.1 89.5 new ## 15639 3.40 58.9 1.56 1.720000 2.08 3.02 3.93 6.50 8.24 47.5 0.000000 0.0 58.8 new ## 24089 14.40 76.5 4.39 6.600000 12.14 15.88 17.06 18.77 19.71 3.4 14.900001 0.4 66.4 new ## 45965 8.12 90.7 3.05 4.530000 5.90 8.09 9.24 14.12 17.80 8.8 13.800000 0.0 84.3 new ## 61802 2.06 5.5 0.50 1.450000 1.58 2.01 2.26 3.04 3.46 5.5 0.000000 0.0 5.5 new ## 87713 7.55 94.3 5.35 2.750000 3.31 5.07 9.63 18.94 22.33 44.2 16.400000 3.5 92.7 new ## 70945 2.80 5.7 2.18 1.360000 1.47 2.19 2.79 7.26 13.78 4.5 0.200000 0.0 5.7 new ## 14512 3.17 40.6 1.65 1.610000 1.90 2.70 3.48 6.57 9.20 33.7 0.300000 0.0 40.5 new ## 40850 9.34 79.9 3.26 5.180000 6.67 9.48 10.93 14.82 16.79 5.7 28.700001 0.0 75.0 new ## 85666 5.57 79.9 2.96 2.080000 2.86 4.99 6.60 11.34 12.88 34.9 9.400001 0.0 77.5 new ## geometry ## 76082 POINT (434830 5338570) ## 15639 POINT (436070 5342310) ## 24089 POINT (432230 5341830) ## 45965 POINT (434770 5340550) ## 61802 POINT (438050 5339610) ## 87713 POINT (433190 5337890) ## 70945 POINT (435070 5338990) ## 14512 POINT (435030 5342370) ## 40850 POINT (432910 5340850) ## 85666 POINT (436090 5338010) sample_clhs(mraster = mraster, # input nSamp = 300, # desired sample number existing = existing, # existing samples iter = 100, # number of iterations details = TRUE) # clhs details ## | | | 0% | |= | 1% | |== | 2% | |=== | 3% | |==== | 4% | |==== | 5% | |===== | 6% | |====== | 7% | |======= | 8% | |======== | 9% | |========= | 10% | |========== | 11% | |=========== | 12% | |============ | 13% | |============= | 14% | |============= | 15% | |============== | 16% | |=============== | 17% | |================ | 18% | |================= | 19% | |================== | 20% | |=================== | 21% | |==================== | 22% | |===================== | 23% | |====================== | 24% | |====================== | 25% | |======================= | 26% | |======================== | 27% | |========================= | 28% | |========================== | 29% | |=========================== | 30% | |============================ | 31% | |============================= | 32% | |============================== | 33% | |=============================== | 34% | |=============================== | 35% | |================================ | 36% | |================================= | 37% | |================================== | 38% | |=================================== | 39% | |==================================== | 40% | |===================================== | 41% | |====================================== | 42% | |======================================= | 43% | |======================================== | 44% | |======================================== | 45% | |========================================= | 46% | |========================================== | 47% | |=========================================== | 48% | |============================================ | 49% | |============================================= | 51% | |============================================== | 52% | |=============================================== | 53% | |================================================ | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 57% | |=================================================== | 58% | |==================================================== | 59% | |===================================================== | 60% | |====================================================== | 61% | |======================================================= | 62% | |======================================================== | 63% | |========================================================= | 64% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 68% | |============================================================= | 69% | |============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 72% | |================================================================= | 73% | |================================================================== | 74% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 80% | |======================================================================== | 81% | |========================================================================= | 82% | |========================================================================== | 83% | |=========================================================================== | 84% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 87% | |============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 90% | |================================================================================= | 91% | |================================================================================== | 92% | |=================================================================================== | 93% | |==================================================================================== | 94% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 98% | |======================================================================================== | 99% | |=========================================================================================| 100% ## $clhs ## [1] 83053 15446 83165 23519 29948 69057 49638 72993 10093 48173 56251 89039 22905 81929 85814 ## [16] 6909 60627 43620 23102 31221 68677 4534 87166 58988 69092 44839 67424 73668 44853 33594 ## [31] 47484 59803 377 78884 34938 73954 17397 16713 37910 41023 61403 37474 38033 40951 87848 ## [46] 22141 43873 86222 76473 72763 58706 9959 54147 34361 77865 61445 55401 1567 67919 55968 ## [61] 35063 30922 22073 80403 8962 45042 25384 47683 85041 26363 43536 7151 89563 84302 84106 ## [76] 31306 51619 89754 91128 7857 41776 29970 22600 54521 72427 39214 24228 3255 42946 60902 ## [91] 28886 43208 18857 77009 13394 26655 30730 22115 38794 73321 1 2 3 4 5 ## [106] 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ## [121] 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 ## [136] 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 ## [151] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 ## [166] 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 ## [181] 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 ## [196] 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 ## [211] 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 ## [226] 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 ## [241] 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 ## [256] 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 ## [271] 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 ## [286] 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 ## ## $samples ## Simple feature collection with 300 features and 14 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438490 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 type ## 82853 10.90 95.7 5.17 2.79 4.20 12.30 14.61 17.57 18.80 19.2 37.2 0.1 94.1 new ## 15246 4.31 66.1 2.18 1.92 2.42 3.72 5.24 8.57 10.31 41.4 1.0 0.0 65.5 new ## 82965 6.55 66.9 3.44 2.01 3.14 6.23 8.96 12.20 13.12 21.7 15.8 0.0 65.3 new ## 23319 9.66 89.5 5.77 3.51 4.43 7.91 12.73 20.04 20.78 22.3 13.0 4.7 87.6 new ## 29748 14.03 89.7 5.53 4.81 9.30 15.06 17.41 21.96 23.57 7.1 23.2 10.0 85.1 new ## 68857 5.30 11.5 3.05 1.59 2.39 4.96 5.63 11.55 13.02 4.6 1.7 0.0 11.2 new ## 49438 12.10 79.3 5.91 3.05 5.80 13.32 16.24 20.71 22.59 9.5 18.2 5.1 71.7 new ## 72793 15.09 94.8 7.05 6.52 8.55 13.69 19.49 26.21 26.84 3.9 25.7 12.3 90.4 new ## 9893 1.96 5.2 0.49 1.40 1.50 1.86 2.18 2.91 3.43 5.2 0.0 0.0 5.2 new ## 47973 8.57 0.6 2.85 3.68 7.52 9.13 9.94 11.44 11.52 0.0 0.2 0.0 0.6 new ## geometry ## 82853 POINT (431250 5338150) ## 15246 POINT (435450 5342330) ## 82965 POINT (433490 5338150) ## 23319 POINT (438010 5341890) ## 29748 POINT (436490 5341510) ## 68857 POINT (435270 5339150) ## 49438 POINT (437610 5340350) ## 72793 POINT (433310 5338830) ## 9893 POINT (434230 5342650) ## 47973 POINT (435330 5340430) sample_clhs(mraster = mraster, # input nSamp = 300, # desired sample number iter = 100, # number of iterations existing = existing, # existing samples access = access, # define access road network buff_inner = 100, # inner buffer - no samples within this distance from road buff_outer = 300, # outer buffer - no samples further than this distance from road plot = TRUE) # plot ## | | | 0% | |= | 1% | |== | 2% | |=== | 3% | |==== | 4% | |==== | 5% | |===== | 6% | |====== | 7% | |======= | 8% | |======== | 9% | |========= | 10% | |========== | 11% | |=========== | 12% | |============ | 13% | |============= | 14% | |============= | 15% | |============== | 16% | |=============== | 17% | |================ | 18% | |================= | 19% | |================== | 20% | |=================== | 21% | |==================== | 22% | |===================== | 23% | |====================== | 24% | |====================== | 25% | |======================= | 26% | |======================== | 27% | |========================= | 28% | |========================== | 29% | |=========================== | 30% | |============================ | 31% | |============================= | 32% | |============================== | 33% | |=============================== | 34% | |=============================== | 35% | |================================ | 36% | |================================= | 37% | |================================== | 38% | |=================================== | 39% | |==================================== | 40% | |===================================== | 41% | |====================================== | 42% | |======================================= | 43% | |======================================== | 44% | |======================================== | 45% | |========================================= | 46% | |========================================== | 47% | |=========================================== | 48% | |============================================ | 49% | |============================================= | 51% | |============================================== | 52% | |=============================================== | 53% | |================================================ | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 57% | |=================================================== | 58% | |==================================================== | 59% | |===================================================== | 60% | |====================================================== | 61% | |======================================================= | 62% | |======================================================== | 63% | |========================================================= | 64% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 68% | |============================================================= | 69% | |============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 72% | |================================================================= | 73% | |================================================================== | 74% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 80% | |======================================================================== | 81% | |========================================================================= | 82% | |========================================================================== | 83% | |=========================================================================== | 84% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 87% | |============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 90% | |================================================================================= | 91% | |================================================================================== | 92% | |=================================================================================== | 93% | |==================================================================================== | 94% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 98% | |======================================================================================== | 99% | |=========================================================================================| 100% ## Simple feature collection with 300 features and 14 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438530 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 type ## 20959 7.86 62.9 4.80 1.98 2.96 6.83 11.26 15.65 17.96 17.6 18.8 0.2 59.2 new ## 22954 12.64 91.0 5.05 5.42 7.74 13.37 16.28 19.59 21.25 6.0 21.9 2.9 83.9 new ## 16641 2.03 9.6 0.62 1.40 1.50 1.89 2.24 3.15 4.15 9.6 0.0 0.0 9.6 new ## 35824 9.22 82.5 3.10 5.21 6.66 9.30 10.92 14.23 16.07 5.7 29.1 0.0 74.2 new ## 16064 9.45 74.4 4.40 3.02 5.09 9.90 12.46 16.07 17.62 10.1 27.5 0.0 67.0 new ## 8948 12.16 96.0 3.42 6.74 9.59 13.15 14.17 16.31 17.86 4.2 57.6 0.0 91.7 new ## 21274 9.66 73.8 5.02 2.41 3.84 10.43 13.75 16.34 17.47 14.0 25.6 0.0 67.2 new ## 1445 13.18 94.8 5.99 3.20 6.76 14.55 17.14 21.21 22.05 12.7 24.1 11.2 90.7 new ## 38699 13.48 91.5 4.35 7.37 11.02 14.03 15.88 19.33 20.76 4.0 39.1 2.3 85.2 new ## 36854 11.81 87.7 4.88 3.65 6.65 13.37 15.47 17.32 18.10 8.0 29.4 0.0 83.7 new ## geometry ## 20959 POINT (431290 5340470) ## 22954 POINT (435730 5340250) ## 16641 POINT (434630 5341070) ## 35824 POINT (435470 5338190) ## 16064 POINT (432810 5341150) ## 8948 POINT (437470 5342050) ## 21274 POINT (438050 5340450) ## 1445 POINT (436750 5342950) ## 38699 POINT (435670 5337770) ## 36854 POINT (431610 5338050) cost parameter The cost parameter defines an mraster covariate to be used to constrain the clhs sampling. This could be any number of variables. An example could be the distance a pixel is from road access (see example below), terrain slope, the output from calculate_coobs, or many others. #--- cost constrained examples ---# #--- calculate distance to access layer for each pixel in mr ---# mr.c &lt;- calculate_distance(raster = mraster, # input access = access, plot = TRUE) # define access road network sample_clhs(mraster = mr.c, # input nSamp = 250, # desired sample number iter = 100, # number of iterations cost = &quot;dist2access&quot;, # cost parameter - name defined in calculate_distance() plot = TRUE) # plot ## | | | 0% | |= | 1% | |== | 2% | |=== | 3% | |==== | 4% | |==== | 5% | |===== | 6% | |====== | 7% | |======= | 8% | |======== | 9% | |========= | 10% | |========== | 11% | |=========== | 12% | |============ | 13% | |============= | 14% | |============= | 15% | |============== | 16% | |=============== | 17% | |================ | 18% | |================= | 19% | |================== | 20% | |=================== | 21% | |==================== | 22% | |===================== | 23% | |====================== | 24% | |====================== | 25% | |======================= | 26% | |======================== | 27% | |========================= | 28% | |========================== | 29% | |=========================== | 30% | |============================ | 31% | |============================= | 32% | |============================== | 33% | |=============================== | 34% | |=============================== | 35% | |================================ | 36% | |================================= | 37% | |================================== | 38% | |=================================== | 39% | |==================================== | 40% | |===================================== | 41% | |====================================== | 42% | |======================================= | 43% | |======================================== | 44% | |======================================== | 45% | |========================================= | 46% | |========================================== | 47% | |=========================================== | 48% | |============================================ | 49% | |============================================= | 51% | |============================================== | 52% | |=============================================== | 53% | |================================================ | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 57% | |=================================================== | 58% | |==================================================== | 59% | |===================================================== | 60% | |====================================================== | 61% | |======================================================= | 62% | |======================================================== | 63% | |========================================================= | 64% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 68% | |============================================================= | 69% | |============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 72% | |================================================================= | 73% | |================================================================== | 74% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 80% | |======================================================================== | 81% | |========================================================================= | 82% | |========================================================================== | 83% | |=========================================================================== | 84% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 87% | |============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 90% | |================================================================================= | 91% | |================================================================================== | 92% | |=================================================================================== | 93% | |==================================================================================== | 94% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 98% | |======================================================================================== | 99% | |=========================================================================================| 100% ## Simple feature collection with 250 features and 15 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431130 ymin: 5337710 xmax: 438550 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 ## 18125 3.350000 45.7 1.82 1.59 1.88 2.840000 3.69 7.22 9.40 36.1 0.3 0.0 45.4 ## 84501 9.340000 77.4 5.18 2.48 4.06 8.809999 12.94 17.63 19.63 14.5 19.5 0.6 72.6 ## 72491 14.790000 95.4 3.61 10.51 13.24 15.880000 16.79 18.37 19.00 3.2 25.5 0.1 92.5 ## 3248 4.540000 16.7 2.07 2.05 2.64 4.360000 5.40 8.83 10.26 10.0 0.3 0.0 16.7 ## 14252 4.560000 5.0 2.54 1.51 1.90 4.020000 6.18 8.69 9.37 2.4 0.0 0.0 5.0 ## 64154 7.100000 82.7 3.28 2.66 3.44 7.440000 9.19 12.34 13.61 23.5 18.4 0.0 81.0 ## 86342 9.389999 94.1 4.33 4.38 5.75 8.620000 11.43 18.05 21.19 11.8 26.4 2.4 91.3 ## 40415 3.530000 61.6 1.18 2.09 2.52 3.450000 4.04 5.60 7.27 55.3 0.0 0.0 61.4 ## 77604 11.030000 97.4 2.62 7.75 9.13 11.200000 12.33 14.65 17.66 2.1 61.9 0.5 93.0 ## 76210 16.129999 97.4 3.85 11.48 13.14 16.639999 18.82 21.07 21.83 0.9 30.7 16.0 93.4 ## dist2access type geometry ## 18125 101.98039 new POINT (434890 5342170) ## 84501 282.84271 new POINT (434810 5338070) ## 72491 156.20499 new POINT (432050 5338850) ## 3248 20.00000 new POINT (436270 5343030) ## 14252 481.66378 new POINT (436930 5342390) ## 64154 80.00000 new POINT (437990 5339470) ## 86342 89.44272 new POINT (435010 5337970) ## 40415 60.00000 new POINT (438190 5340890) ## 77604 340.58773 new POINT (433930 5338470) ## 76210 640.00000 new POINT (431130 5338550) sample_clhs(mraster = mr.c, # input nSamp = 250, # desired sample number existing = existing, # existing samples iter = 100, # number of iterations cost = &quot;dist2access&quot;, # cost parameter - name defined in calculate_distance() plot = TRUE) # plot ## | | | 0% | |= | 1% | |== | 2% | |=== | 3% | |==== | 4% | |==== | 5% | |===== | 6% | |====== | 7% | |======= | 8% | |======== | 9% | |========= | 10% | |========== | 11% | |=========== | 12% | |============ | 13% | |============= | 14% | |============= | 15% | |============== | 16% | |=============== | 17% | |================ | 18% | |================= | 19% | |================== | 20% | |=================== | 21% | |==================== | 22% | |===================== | 23% | |====================== | 24% | |====================== | 25% | |======================= | 26% | |======================== | 27% | |========================= | 28% | |========================== | 29% | |=========================== | 30% | |============================ | 31% | |============================= | 32% | |============================== | 33% | |=============================== | 34% | |=============================== | 35% | |================================ | 36% | |================================= | 37% | |================================== | 38% | |=================================== | 39% | |==================================== | 40% | |===================================== | 41% | |====================================== | 42% | |======================================= | 43% | |======================================== | 44% | |======================================== | 45% | |========================================= | 46% | |========================================== | 47% | |=========================================== | 48% | |============================================ | 49% | |============================================= | 51% | |============================================== | 52% | |=============================================== | 53% | |================================================ | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 57% | |=================================================== | 58% | |==================================================== | 59% | |===================================================== | 60% | |====================================================== | 61% | |======================================================= | 62% | |======================================================== | 63% | |========================================================= | 64% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 68% | |============================================================= | 69% | |============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 72% | |================================================================= | 73% | |================================================================== | 74% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 80% | |======================================================================== | 81% | |========================================================================= | 82% | |========================================================================== | 83% | |=========================================================================== | 84% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 87% | |============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 90% | |================================================================================= | 91% | |================================================================================== | 92% | |=================================================================================== | 93% | |==================================================================================== | 94% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 98% | |======================================================================================== | 99% | |=========================================================================================| 100% ## Simple feature collection with 250 features and 15 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337730 xmax: 438490 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## zmax zmean zsd pzabove2 zq20 zq50 zq70 zq90 zq95 l_1 l_2 t_3 t_4 dist2access ## 51377 8.52 94.7 2.45 5.40 6.70 8.74 9.849999 11.93 13.73 6.6 24.8 0.0 90.6 322.4903 ## 85287 9.76 69.4 4.98 2.84 4.40 10.33 13.150000 17.27 19.56 12.7 23.4 0.5 64.0 451.2206 ## 85643 12.70 91.3 3.85 6.53 9.83 13.54 14.920000 17.81 18.88 4.3 42.7 0.0 84.2 272.0294 ## 13727 6.97 47.7 3.34 2.53 3.80 6.64 8.710000 12.86 14.62 12.4 10.0 0.0 45.1 180.0000 ## 75957 17.72 94.7 3.85 14.22 17.01 18.84 19.570000 20.63 21.63 2.4 6.3 16.3 90.1 145.6022 ## 14786 7.11 72.0 3.99 2.40 3.41 6.36 8.860000 14.64 17.24 21.8 14.3 0.0 68.9 80.0000 ## 15676 10.44 87.3 5.60 2.81 4.71 10.35 13.150000 19.67 22.54 15.0 25.8 3.2 85.0 518.8449 ## 40526 7.09 66.4 4.18 2.01 2.99 6.41 9.080000 14.60 17.60 19.3 14.6 0.0 62.7 280.7134 ## 85442 9.99 90.8 4.03 2.91 6.99 10.88 11.900000 16.37 17.32 11.5 47.2 0.0 85.9 392.9377 ## 28919 1.95 1.0 0.82 1.36 1.42 1.69 2.020000 3.51 5.44 1.0 0.0 0.0 1.0 40.0000 ## type geometry ## 51377 new POINT (434930 5340230) ## 85287 new POINT (435810 5338030) ## 85643 new POINT (435630 5338010) ## 13727 new POINT (433130 5342410) ## 75957 new POINT (431930 5338570) ## 14786 new POINT (433450 5342350) ## 15676 new POINT (436830 5342310) ## 40526 new POINT (432990 5340870) ## 85442 new POINT (431470 5338010) ## 28919 new POINT (433410 5341550) sample_balanced The sample_balanced algorithm performs the balanced sampling methodology from the stratifyR and SamplingBigData packages. These functions can take a bit longer to run so be patient! sample_balanced(mraster = mraster, # input nSamp = 200, # desired sample number plot = TRUE) # plot ## Simple feature collection with 200 features and 0 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438450 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## geometry ## 1 POINT (438250 5343230) ## 2 POINT (433390 5343170) ## 3 POINT (435670 5343170) ## 4 POINT (436050 5343110) ## 5 POINT (431570 5343070) ## 6 POINT (431930 5343010) ## 7 POINT (437350 5343010) ## 8 POINT (438290 5342930) ## 9 POINT (433670 5342910) ## 10 POINT (437170 5342910) sample_balanced(mraster = mraster, # input nSamp = 100, # desired sample number algorithm = &quot;lcube&quot;, # algorithm type access = access, # define access road network buff_inner = 50, # inner buffer - no samples within this distance from road buff_outer = 200) # outer buffer - no samples further than this distance from road ## Simple feature collection with 100 features and 0 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431670 ymin: 5337790 xmax: 438370 ymax: 5343170 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## geometry ## 1 POINT (435010 5337990) ## 2 POINT (432830 5340030) ## 3 POINT (435170 5339350) ## 4 POINT (432490 5341810) ## 5 POINT (437590 5342330) ## 6 POINT (435090 5342090) ## 7 POINT (432930 5339050) ## 8 POINT (433990 5341010) ## 9 POINT (433150 5341690) ## 10 POINT (437750 5342750) pre { max-height: 500px; overflow-y: auto; } pre[class] { max-height: 500px; } ## Reading layer `roads&#39; from data source ## `C:\\Users\\tgood.stu\\Documents\\R\\win-library\\4.1\\sgsR\\extdata\\roads.shp&#39; using driver `ESRI Shapefile&#39; ## Simple feature collection with 167 features and 36 fields ## Geometry type: MULTILINESTRING ## Dimension: XY ## Bounding box: xmin: 431100 ymin: 5337700 xmax: 438560 ymax: 5343240 ## Projected CRS: UTM_Zone_17_Northern_Hemisphere References "],["calc.html", "calculate_* functions calculate_distance calculate_pcomp calculate_allocation Sample evaluation algorithms Latin hypercube sampling evaluation algorithms", " calculate_* functions A total of 7 calculate functions currently exist in the package: calculate_distance - per pixel distance to closest access vector calculate_pcomp- calculate principal components on input mraster calculate_allocation - calculate the number of samples needed for samples within an sraster - proportional / optimal sampling calculate_ahels - apply the adapted Hypercube Evaluation of a Legacy Sample (ahels) algorithm to existing samples calculate_coobs - apply count of observations algorithm to existing samples calculate_lhsPop - calculate population covariate statistics for latin hypercube sampling calculate_lhsOpt - calculate optimal latin hypercube sampling paramters including sample number As mentioned in a few locations throughout this sgsR tutorial, the calculate_* functions serve as helper functions. In this section we outline how these functions can be used. calculate_distance The calculate_distance function take input raster and access data and outputs a per pixel distance to the nearest access point. This function has particular value for constraining sampling protocols such the sample_clhs function where the output raster layer can be used as a cost constraint. calculate_distance(raster = sraster, # input access = access, # define access road network plot = TRUE) # plot ## class : SpatRaster ## dimensions : 277, 373, 2 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## sources : memory ## memory ## names : strata, dist2access ## min values : 1, 0 ## max values : 4, 1060 The output raster is the input with the calculated dist2access layer appended. calculate_distance(raster = mraster, # input access = access, # define access road network filename = tempfile(fileext = &quot;.tif&quot;)) # write file to disc ## class : SpatRaster ## dimensions : 277, 373, 14 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## sources : wall_metrics_small.tif (13 layers) ## memory ## names : zmax, zmean, zsd, pzabove2, zq20, zq50, ... ## min values : 0, 0, 0, 0, 0, 0, ... ## max values : 23.82, 100.00, 25.71, 18.08, 21.02, 27.60, ... calculate_pcomp The calculate_pcomp function take a mraster as input and perform principal component analysis. The number of components defined by the nComp parameter specify the number of components that should be rasterized to output. calculate_pcomp(mraster = mraster, # input nComp = 5, # number of components to output plot = TRUE ) # plot ## class : SpatRaster ## dimensions : 277, 373, 5 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## sources : memory ## memory ## memory ## ... and 2 more source(s) ## names : PC1, PC2, PC3, PC4, PC5 ## min values : -6.853635, -4.529725, -4.215024, -10.636345, -4.394728 ## max values : 11.719434, 12.657038, 5.233462, 8.600372, 4.304005 calculate_pcomp(mraster = mraster, # input nComp = 3, # number of components to output plot = TRUE, # plot details = TRUE) # details about the principal component analysis appended ## $pca ## Standard deviations (1, .., p=13): ## [1] 2.93647150 1.26882709 1.15691535 0.86852611 0.53076565 0.42304219 0.35679023 0.21988261 ## [9] 0.14290118 0.09666573 0.07179753 0.05016994 0.02570635 ## ## Rotation (n x k) = (13 x 13): ## PC1 PC2 PC3 PC4 PC5 PC6 PC7 ## zmax 0.3359531 0.01817295 -0.085980156 0.04883369 -0.16446975 0.134888577 -0.15339832 ## zmean 0.2692352 -0.14320556 0.484261417 0.08715503 0.10021008 0.208524587 0.28510651 ## zsd 0.2525172 0.46307645 0.056280928 -0.35189237 -0.05790180 -0.047159024 -0.05015151 ## pzabove2 0.2575694 -0.38512031 -0.153689213 0.33477151 -0.20262484 -0.504470621 0.11141535 ## zq20 0.2957809 -0.25072438 -0.163557453 0.28595035 -0.26718846 -0.008654979 -0.08550919 ## zq50 0.3271212 0.02248762 -0.100221327 0.07934796 -0.16569646 0.420247325 -0.29668394 ## zq70 0.3296060 0.11882609 -0.062083857 -0.02690735 -0.12986291 0.271021251 -0.22963234 ## zq90 0.3192555 0.21122345 0.009465806 -0.18799597 -0.09477864 -0.264930469 0.08153534 ## zq95 0.3091490 0.21445676 0.055153306 -0.23449020 -0.07471056 -0.451270472 0.21011887 ## l_1 -0.1885162 0.18294540 0.614448790 0.27802959 -0.27135857 -0.287232900 -0.56400277 ## l_2 0.2327722 -0.43278499 0.060836142 -0.34982009 0.57978716 -0.188355371 -0.50772612 ## t_3 0.1690462 0.45853939 -0.166263397 0.60467076 0.59765870 -0.091199035 -0.03067072 ## t_4 0.2561467 -0.13145011 0.527861021 0.09849843 0.14573821 0.177036168 0.32336804 ## PC8 PC9 PC10 PC11 PC12 PC13 ## zmax 0.0308922302 -1.886049e-02 0.0560186614 -0.1278804649 -0.0052115172 0.8873685582 ## zmean -0.0021690322 2.826642e-02 0.0270039439 0.0675442390 -0.7236917619 -0.0162558333 ## zsd 0.1340537231 3.445926e-01 -0.0513256272 0.6681251318 0.0295065391 0.0098559868 ## pzabove2 0.5392526124 -2.020873e-02 0.0120286554 0.2179924264 -0.0004334086 -0.0531021769 ## zq20 -0.6885132239 3.627060e-01 -0.1271545992 0.1378591128 0.0390001016 -0.1416169733 ## zq50 0.0329045573 -5.353496e-01 0.4057583148 0.2063460374 0.0609622299 -0.2923086818 ## zq70 0.3370366252 1.490613e-01 -0.5945209546 -0.4103363124 -0.0257022931 -0.2670379822 ## zq90 -0.0006831206 3.087370e-01 0.5970060214 -0.4980350813 -0.0047718481 -0.1800345902 ## zq95 -0.3114508486 -5.847183e-01 -0.3194796103 -0.0758389467 -0.0171556239 -0.0045593830 ## l_1 -0.0188834161 -2.142108e-02 0.0060754571 -0.0313981609 -0.0077753523 0.0029767582 ## l_2 -0.0466621166 2.094108e-02 0.0009527472 0.0201177308 -0.0003045197 -0.0008875782 ## t_3 -0.0310296725 7.516919e-05 -0.0011560670 0.0009191501 -0.0216941448 -0.0022824635 ## t_4 0.0324261270 3.474720e-02 -0.0238296876 -0.0055552525 0.6845626123 0.0117767342 ## ## $raster ## class : SpatRaster ## dimensions : 277, 373, 3 (nrow, ncol, nlyr) ## resolution : 20, 20 (x, y) ## extent : 431100, 438560, 5337700, 5343240 (xmin, xmax, ymin, ymax) ## coord. ref. : +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## sources : memory ## memory ## memory ## names : PC1, PC2, PC3 ## min values : -6.853635, -4.529725, -4.215024 ## max values : 11.719434, 12.657038, 5.233462 calculate_allocation The calculate_allocation function calculates the total number of samples that should be allocated based on a total sample value (nSamp) and an input sraster. This function is utilized in a number of functions including sample_strat. Two methods for allocation are currently included: proportional (prop), and optimal (optim) allocation. Proportional - Samples are allocated based on the area coverage of strata. This is the default method. Optimal - Samples are allocated based on the within strata variation. Proportional Allocation #--- perform grid sampling ---# calculate_allocation(sraster = sraster, nSamp = 200) ## strata total ## 1 1 65 ## 2 2 80 ## 3 3 18 ## 4 4 36 #--- calculate existing samples to include ---# e.sr &lt;- extract_strata(sraster = sraster, existing = existing) calculate_allocation(sraster = sraster, nSamp = 200, existing = e.sr) ## strata total need ## 1 1 7 65 ## 2 2 -6 80 ## 3 3 3 18 ## 4 4 -5 36 Notice that some of the results above are negative. This indicates that the existing samples over represent those strata and that some sample should likely be removed to avoid over representation. Optimal Allocation Proportional allocation determine the number of samples based on the weights of strata. Optimal allocation utilizes within strata variation to allocate samples. This means that in addition to providing and sraster, that an mraster and a specific metric must be provided to calculate variation and appropriately allocate samples. calculate_allocation(sraster = sraster, # stratified raster nSamp = 200, # desired sample number existing = e.sr, #existing samples allocation = &quot;optim&quot;, # optimal allocation mraster = mraster, # metrics raster metric = 1, # metric to describe strata variance force = TRUE) # force nSamp number ## strata total need ## 1 1 5 63 ## 2 2 1 87 ## 3 3 7 22 ## 4 4 -13 28 Sample evaluation algorithms The following algorithms were initially developed by Dr. Brendan Malone from the University of Sydney. In their work they graciously provided an in depth description of the functionality of these algorithms that were originally developed to improve soil sampling strategies. I have taken the initial scripts Dr. Malone provided to the community and implemented functions so they can be used for structurally guided sampling approaches. Many thanks to Dr. Malone for being an excellent collaborator and proponent of open source algorithms. Please consult the original reference for these ideas and scripts as they are extremely valuable and helpful for understanding their sampling rationale. Malone BP, Minansy B, Brungard C. 2019. Some methods to improve the utility of conditioned Latin hypercube sampling. PeerJ 7:e6451 DOI 10.7717/peerj.6451 calculate_ahels The calculate_ahels function performs the adapted Hypercube Evaluation of a Legacy Sample (ahels) algorithm using existing sample data and an mraster. New samples are allocated based on quantile ratios between the existing sample and mraster covariate dataset. This algorithm: Determines the quantile distributions of existing samples and mraster covariates. Determines quantiles where there is a disparity between samples and covariates. Prioritizes sampling within those quantile to improve representation. To use the function, the user will first specify the number of quantiles (nQuant) followed by either the nSamp (total number of desired samples to be added) or threshold (proportional represenation between sample and covariate quantiles - default is 0.9) parameters. Its recommended to use threshold values at or below 0.9 as higher values can currently cause the algorithm to add samples repeatedly. sample_ahels(mraster = mraster[[1:3]], # input mraster - first 3 layers only existing = existing, # existing samples plot = TRUE) # plot ## | | | 0% | | | 1% | |= | 1% | |= | 2% | |== | 2% | |== | 3% | |=== | 3% | |=== | 4% | |==== | 4% | |==== | 5% | |===== | 5% | |===== | 6% | |====== | 6% | |====== | 7% | |======= | 7% | |======= | 8% | |======== | 8% | |======== | 9% | |======== | 10% | |========= | 10% | |========= | 11% | |========== | 11% | |========== | 12% | |=========== | 12% | |=========== | 13% | |============ | 13% | |============ | 14% | |============= | 14% | |============= | 15% | |============== | 15% | |============== | 16% | |=============== | 16% | |=============== | 17% | |================ | 17% | |================ | 18% | |================ | 19% | |================= | 19% | |================= | 20% | |================== | 20% | |================== | 21% | |=================== | 21% | |=================== | 22% | |==================== | 22% | |==================== | 23% | |===================== | 23% | |===================== | 24% | |====================== | 24% | |====================== | 25% | |======================= | 25% | |======================= | 26% | |======================== | 26% | |======================== | 27% | |======================== | 28% | |========================= | 28% | |========================= | 29% | |========================== | 29% | |========================== | 30% | |=========================== | 30% | |=========================== | 31% | |============================ | 31% | |============================ | 32% | |============================= | 32% | |============================= | 33% | |============================== | 33% | |============================== | 34% | |=============================== | 34% | |=============================== | 35% | |================================ | 35% | |================================ | 36% | |================================ | 37% | |================================= | 37% | |================================= | 38% | |================================== | 38% | |================================== | 39% | |=================================== | 39% | |=================================== | 40% | |==================================== | 40% | |==================================== | 41% | |===================================== | 41% | |===================================== | 42% | |====================================== | 42% | |====================================== | 43% | |======================================= | 43% | |======================================= | 44% | |======================================== | 44% | |======================================== | 45% | |======================================== | 46% | |========================================= | 46% | |========================================= | 47% | |========================================== | 47% | |========================================== | 48% | |=========================================== | 48% | |=========================================== | 49% | |============================================ | 49% | |============================================ | 50% | |============================================= | 50% | |============================================= | 51% | |============================================== | 51% | |============================================== | 52% | |=============================================== | 52% | |=============================================== | 53% | |================================================ | 53% | |================================================ | 54% | |================================================= | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 56% | |================================================== | 57% | |=================================================== | 57% | |=================================================== | 58% | |==================================================== | 58% | |==================================================== | 59% | |===================================================== | 59% | |===================================================== | 60% | |====================================================== | 60% | |====================================================== | 61% | |======================================================= | 61% | |======================================================= | 62% | |======================================================== | 62% | |======================================================== | 63% | |========================================================= | 63% | |========================================================= | 64% | |========================================================= | 65% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 67% | |============================================================ | 68% | |============================================================= | 68% | |============================================================= | 69% | |============================================================== | 69% | |============================================================== | 70% | |=============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 71% | |================================================================ | 72% | |================================================================= | 72% | |================================================================= | 73% | |================================================================= | 74% | |================================================================== | 74% | |================================================================== | 75% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 79% | |======================================================================= | 80% | |======================================================================== | 80% | |======================================================================== | 81% | |========================================================================= | 81% | |========================================================================= | 82% | |========================================================================= | 83% | |========================================================================== | 83% | |========================================================================== | 84% | |=========================================================================== | 84% | |=========================================================================== | 85% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 86% | |============================================================================= | 87% | |============================================================================== | 87% | |============================================================================== | 88% | |=============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 89% | |================================================================================ | 90% | |================================================================================= | 90% | |================================================================================= | 91% | |================================================================================= | 92% | |================================================================================== | 92% | |================================================================================== | 93% | |=================================================================================== | 93% | |=================================================================================== | 94% | |==================================================================================== | 94% | |==================================================================================== | 95% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 97% | |======================================================================================= | 98% | |======================================================================================== | 98% | |======================================================================================== | 99% | |=========================================================================================| 99% | |=========================================================================================| 100% ## [,1] [,2] [,3] ## [1,] 0.9630291 1.0001188 1.0569329 ## [2,] 0.9878931 1.0500868 0.9805157 ## [3,] 1.0244465 1.0009096 0.9484624 ## [4,] 0.9196324 1.1422808 1.5845945 ## [5,] 0.9837800 1.2611803 NA ## [6,] 1.0418558 1.3251163 NA ## [7,] 1.0261549 1.0083369 NA ## [8,] 1.6668647 1.0039715 NA ## [9,] NA 0.9212081 NA ## [10,] NA 0.9406802 NA ## Simple feature collection with 247 features and 4 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438550 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## type zmax zmean zsd geometry ## 1 existing 13.55 91.5 4.04 POINT (434170 5337990) ## 2 existing 5.65 54.5 2.18 POINT (436130 5339130) ## 3 existing 12.25 93.2 5.35 POINT (432630 5340190) ## 4 existing 8.55 78.2 5.47 POINT (433150 5340990) ## 5 existing 10.87 79.2 4.18 POINT (433050 5340390) ## 6 existing 15.41 91.3 4.42 POINT (435790 5339890) ## 7 existing 11.17 95.8 2.30 POINT (432530 5337950) ## 8 existing 14.33 89.4 3.90 POINT (438470 5339910) ## 9 existing 16.34 78.2 5.80 POINT (436110 5341350) ## 10 existing 6.29 91.0 2.57 POINT (432010 5340310) Defaults Notice that no threshold, nSamp, or nQuant were defined. Thats because defaults are threshold = 0.9 and nQuant = 10. The first matrix output shows the quantile ratios between sample and covariates. A value of 1.0 means that samples and covariates are equally represented. Values above 1.0 are over represented in the sample, less than 1 under represented in the sample. sample_ahels(mraster = mraster[[1:3]], # input mraster - first 3 layers only existing = existing, # existing samples nQuant = 20, # define 20 quantiles nSamp = 300, # total samples desired filename = tempfile(fileext = &quot;.shp&quot;)) # write samples to disc ## | | | 0% | | | 1% | |= | 1% | |= | 2% | |== | 2% | |== | 3% | |=== | 3% | |=== | 4% | |==== | 4% | |==== | 5% | |===== | 5% | |===== | 6% | |====== | 6% | |====== | 7% | |======= | 7% | |======= | 8% | |======== | 8% | |======== | 9% | |======== | 10% | |========= | 10% | |========= | 11% | |========== | 11% | |========== | 12% | |=========== | 12% | |=========== | 13% | |============ | 13% | |============ | 14% | |============= | 14% | |============= | 15% | |============== | 15% | |============== | 16% | |=============== | 16% | |=============== | 17% | |================ | 17% | |================ | 18% | |================ | 19% | |================= | 19% | |================= | 20% | |================== | 20% | |================== | 21% | |=================== | 21% | |=================== | 22% | |==================== | 22% | |==================== | 23% | |===================== | 23% | |===================== | 24% | |====================== | 24% | |====================== | 25% | |======================= | 25% | |======================= | 26% | |======================== | 26% | |======================== | 27% | |======================== | 28% | |========================= | 28% | |========================= | 29% | |========================== | 29% | |========================== | 30% | |=========================== | 30% | |=========================== | 31% | |============================ | 31% | |============================ | 32% | |============================= | 32% | |============================= | 33% | |============================== | 33% | |============================== | 34% | |=============================== | 34% | |=============================== | 35% | |================================ | 35% | |================================ | 36% | |================================ | 37% | |================================= | 37% | |================================= | 38% | |================================== | 38% | |================================== | 39% | |=================================== | 39% | |=================================== | 40% | |==================================== | 40% | |==================================== | 41% | |===================================== | 41% | |===================================== | 42% | |====================================== | 42% | |====================================== | 43% | |======================================= | 43% | |======================================= | 44% | |======================================== | 44% | |======================================== | 45% | |======================================== | 46% | |========================================= | 46% | |========================================= | 47% | |========================================== | 47% | |========================================== | 48% | |=========================================== | 48% | |=========================================== | 49% | |============================================ | 49% | |============================================ | 50% | |============================================= | 50% | |============================================= | 51% | |============================================== | 51% | |============================================== | 52% | |=============================================== | 52% | |=============================================== | 53% | |================================================ | 53% | |================================================ | 54% | |================================================= | 54% | |================================================= | 55% | |================================================= | 56% | |================================================== | 56% | |================================================== | 57% | |=================================================== | 57% | |=================================================== | 58% | |==================================================== | 58% | |==================================================== | 59% | |===================================================== | 59% | |===================================================== | 60% | |====================================================== | 60% | |====================================================== | 61% | |======================================================= | 61% | |======================================================= | 62% | |======================================================== | 62% | |======================================================== | 63% | |========================================================= | 63% | |========================================================= | 64% | |========================================================= | 65% | |========================================================== | 65% | |========================================================== | 66% | |=========================================================== | 66% | |=========================================================== | 67% | |============================================================ | 67% | |============================================================ | 68% | |============================================================= | 68% | |============================================================= | 69% | |============================================================== | 69% | |============================================================== | 70% | |=============================================================== | 70% | |=============================================================== | 71% | |================================================================ | 71% | |================================================================ | 72% | |================================================================= | 72% | |================================================================= | 73% | |================================================================= | 74% | |================================================================== | 74% | |================================================================== | 75% | |=================================================================== | 75% | |=================================================================== | 76% | |==================================================================== | 76% | |==================================================================== | 77% | |===================================================================== | 77% | |===================================================================== | 78% | |====================================================================== | 78% | |====================================================================== | 79% | |======================================================================= | 79% | |======================================================================= | 80% | |======================================================================== | 80% | |======================================================================== | 81% | |========================================================================= | 81% | |========================================================================= | 82% | |========================================================================= | 83% | |========================================================================== | 83% | |========================================================================== | 84% | |=========================================================================== | 84% | |=========================================================================== | 85% | |============================================================================ | 85% | |============================================================================ | 86% | |============================================================================= | 86% | |============================================================================= | 87% | |============================================================================== | 87% | |============================================================================== | 88% | |=============================================================================== | 88% | |=============================================================================== | 89% | |================================================================================ | 89% | |================================================================================ | 90% | |================================================================================= | 90% | |================================================================================= | 91% | |================================================================================= | 92% | |================================================================================== | 92% | |================================================================================== | 93% | |=================================================================================== | 93% | |=================================================================================== | 94% | |==================================================================================== | 94% | |==================================================================================== | 95% | |===================================================================================== | 95% | |===================================================================================== | 96% | |====================================================================================== | 96% | |====================================================================================== | 97% | |======================================================================================= | 97% | |======================================================================================= | 98% | |======================================================================================== | 98% | |======================================================================================== | 99% | |=========================================================================================| 99% | |=========================================================================================| 100% ## [,1] [,2] [,3] ## [1,] NA 1.0987349 1.1502523 ## [2,] 0.9805914 1.0071737 1.0158173 ## [3,] 0.9887213 1.1798814 0.9863679 ## [4,] 1.0203636 0.9718828 0.9687435 ## [5,] 0.9923563 0.9779625 1.0347596 ## [6,] 1.0065673 1.2232730 1.0426009 ## [7,] 0.9959245 1.0363068 NA ## [8,] 0.9736858 1.1920915 NA ## [9,] 0.9590695 1.0697361 NA ## [10,] 0.9641581 0.9874932 NA ## [11,] 1.0456943 1.0432221 NA ## [12,] 0.9591503 1.0652733 NA ## [13,] 1.1237831 0.9653457 NA ## [14,] 1.0973184 1.0033958 NA ## [15,] 1.3094667 0.9705420 NA ## [16,] NA 0.9903772 NA ## [17,] NA 1.0073585 NA ## [18,] NA 0.9742058 NA ## [19,] NA 0.9793525 NA ## [20,] NA 0.9612838 NA ## Writing layer `file25341d915f91&#39; to data source ## `C:\\Users\\tgood.stu\\AppData\\Local\\Temp\\RtmpSOoCgd\\file25341d915f91.shp&#39; using driver `ESRI Shapefile&#39; ## Writing 500 features with 4 fields and geometry type Point. ## Simple feature collection with 500 features and 4 fields ## Geometry type: POINT ## Dimension: XY ## Bounding box: xmin: 431110 ymin: 5337710 xmax: 438550 ymax: 5343230 ## CRS: +proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ## First 10 features: ## type zmax zmean zsd geometry ## 1 existing 13.55 91.5 4.04 POINT (434170 5337990) ## 2 existing 5.65 54.5 2.18 POINT (436130 5339130) ## 3 existing 12.25 93.2 5.35 POINT (432630 5340190) ## 4 existing 8.55 78.2 5.47 POINT (433150 5340990) ## 5 existing 10.87 79.2 4.18 POINT (433050 5340390) ## 6 existing 15.41 91.3 4.42 POINT (435790 5339890) ## 7 existing 11.17 95.8 2.30 POINT (432530 5337950) ## 8 existing 14.33 89.4 3.90 POINT (438470 5339910) ## 9 existing 16.34 78.2 5.80 POINT (436110 5341350) ## 10 existing 6.29 91.0 2.57 POINT (432010 5340310) calculate_coobs The calculate_coobs function perform the COunt of OBServations (coobs) algorithm using existing sample data and mraster covariates. This algorithm aids the user in determining where additional samples could be located by comparing existing samples to each pixel and associated mraster covariates. The output coobs raster could be used to constrain clhs sampling using the sample_clhs to areas that are underreprented. The coobs raster determines how many observations are similar in terms of the covariate space at every pixel. Given that this is fairly computationally intensive, I have implemented parallel processing for this function, but users should be patient to allow processing to complete. calculate_coobs(mraster = mraster, # input existing = existing, # existing samples cores = 4, # parallel cores to use details = TRUE, # provide details from algorithm output plot = TRUE, # plot filename = tempfile(fileext = &quot;.tif&quot;)) # write output raster to tif Latin hypercube sampling evaluation algorithms The following 2 algorithms provide a means to maximize the effectiveness of latin hypercube sampling protocols. calculate_lhsPop The calculate_lhsPop function calculates population level statistics about the mraster covariates being used including calculating principal components, quantile distributions, and KullbackLeibler divergence testing. The outputs from this function are mandatory for use of the calculate_lhsOpt function described in the next section. #--- by default all statistical data are calculated ---# calculate_lhsPop(mraster = mraster) # input The output details the following: $values - Pixel values from mraster $pcaLoad - PCA loadings $matQ - Quantile matrix $matCov - Covariate matrix #--- statistical analyses can be chose by setting their parameter to `FALSE` ---# calculate_lhsPop(mraster = mraster, # input nQuant = 10, # desired number of quantiles PCA = FALSE) # choose not to calculate PCA&#39;s calculate_lhsOpt The calculate_lhsOpt function performs an bootsrapped latin hypercube sampling approach where a population level analysis of mraster data is performed to determine the optimal Latin hypercube sample size. Using statistical data calculated using the calculate_lhsPop and varying sample sizes defined by minSamp, maxSamp, step and rep. Sampling protocols are conducted and statistical effectiveness of those sampling outcomes are evaluated to determine where sample size is minimized and statistical representation is maximized. This function is currently fairly slow to run as parallel is still being implemented. #--- calculate lhsPop details ---# poplhs &lt;- calculate_lhsPop(mraster = mr) calculate_lhsOpt(popLHS = poplhs) calculate_lhsOpt(popLHS = poplhs, PCA = FALSE, iter = 200) "],["references.html", "References", " References "]]
